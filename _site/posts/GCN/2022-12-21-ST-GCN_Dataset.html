<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.315">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="SEOYEON CHOI">
<meta name="dcterms.date" content="2022-12-21">

<title>Seoyeon‚Äôs Blog for study - PyTorch ST-GCN Dataset</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Seoyeon‚Äôs Blog for study</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../../about.html" aria-current="page"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/seoyeonc/blog/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Posts</li><li class="breadcrumb-item"><a href="../../posts/GCN/index.html">GCN</a></li><li class="breadcrumb-item"><a href="../../posts/GCN/2022-12-21-ST-GCN_Dataset.html">PyTorch ST-GCN Dataset</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Posts</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">FRAUD</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/FRAUD/2023-07-10-fraud_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fraud data</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../posts/GCN/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GCN</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2022-12-07-torchgcn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TORCH_GEOMETRIC.NN</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2022-12-21-ST-GCN_Dataset.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">PyTorch ST-GCN Dataset</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2022-12-28-gcn_simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simulation of geometric-temporal</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2022-12-29-STGCN-tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>[IT-STGCN]</strong> STGCN ÌäúÌÜ†Î¶¨Ïñº</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-01-05-GNAR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GNAR data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-01-11-Algorithm_EX_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GCN Algorithm Example 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-01-18-Algorithm_traintest_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2nd ST-GCN Example dividing train and test</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-01-20-Algorithm_traintest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1st ST-GCN Example dividing train and test</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-01-21-Class.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Class of Method</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-01-26-ESTGCN_GNAR_DATA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Class of Method(GNAR) lag 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-01-26-ESTGCN_WIKI_DATA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Class of Method(WikiMath) lag 4</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-01-26-guebin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Class of Method</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-02-06-ESTGCN_GNAR_DATA_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Class of Method(GNAR) lag 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-02-06-ESTGCN_GNAR_DATA_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Class of Method(GNAR) lag 1 80% Missing repeat</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-02-07-ESTGCN_WIKI_DATA_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Class of Method(WikiMath) lag 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-02-20-ESTGCN_GNAR_edit_guebin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1st ITSTGCN</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-02-20-ESTGCN_GNAR_edit_guebin2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2nd ITSTGCN</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-03-03-ESTGCN_GNAR_edit_guebin2_seoyeon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SY 1st ITSTGCN</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-03-17-ITSTGCN-Tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ITSTGCN-Tutorial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-03-20-data load, data save as pickle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">data load, data save as pickle</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-04-05-Simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simulation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-04-05-Simulation_boxplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simulation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-04-06-METRLADatasetLoader.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">METRLADatasetLoader-Tutorial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-04-25-note_matrix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Note_weight amatrix</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-04-27-simulation_table.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simulation Tables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-04-27-toy_example_notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Toy Example Note</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-04-29-pedalme_GSO_st.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Padalme GSO_st</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-05-04-questions of pytorch geometric temporal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Questions of PyTorch Geometric Temporal</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-05-06-article_refer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ITSTGCN Article Refernece</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-05-11-CPUvsGPU.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PyG Geometric Temporal CPU vs GPU</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-05-11-PyGGeometricTemporalEx.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PyG Geometric Temporal Examples</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-05-17-itstgcntry)fail_version__Simulation_boxplot_reshape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simulation_reshape</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-05-17-xx_GCONVGRU_simulation_table_reshape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GConvGRU_Simulation Tables_reshape</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-05-25-GCONVGRU_simulation_table_reshape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GConvGRU and GNAR_Simulation Tables_reshape</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-05-25-GCONVGRU_snd_Simulation_boxplot_reshape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GConvGRU_Simulation Boxplot_reshape</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-05-27-AddingtheRecurrentGCNmodels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Adding the RecurrentGCN models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-05-30-GConvLSTM_Simulation_boxplot_reshape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GConvLSTM_Simulation_reshape</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-05-30-GConvLSTM_simulation_table_reshape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GConvLSTM_Simulation Tables_reshape</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-06-06-GCLSTM_Simulation_boxplot_reshape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GCLSTM_Simulation_reshape</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-06-06-GCLSTM_simulation_table_reshape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GCLSTM_Simulation Tables_reshape</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-06-13-DCRNN_Simulation_boxplot_reshape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DCRNN_Simulation_reshape</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-06-13-DCRNN_simulation_table_reshape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DCRNN_Simulation Tables_reshape</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-06-19-LRGCN_Simulation_boxplot_reshape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">LRGCN_Simulation_reshape</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-06-19-LRGCN_simulation_table_reshape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">LRGCN_Simulation Tables_reshape</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-06-20-TGCN_Simulation_boxplot_reshape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TGCN_Simulation_reshape</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-06-20-TGCN_simulation_table_reshape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TGCN_Simulation Tables_reshape</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-06-25-EvolveGCNO_Simulation_boxplot_reshape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">EvolveGCNO_Simulation_reshape</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-06-25-EvolveGCNO_simulation_table_reshape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">EvolveGCNO_Simulation Tables_reshape</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-06-28-DYGRENCODER_Simulation_boxplot_reshape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DYGRENCODER_Simulation_reshape</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-06-28-DYGRENCODER_Simulation_boxplot_reshape (SEOYEON CHOI's conflicted copy 2023-09-27).html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DYGRENCODER_Simulation_reshape</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-06-28-DYGRENCODER_simulation_table_reshape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DYGRENCODER_Simulation Tables_reshape</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-07-01-EvolveGCNH_Simulation_boxplot_reshape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">EvolveGCNH_Simulation_reshape</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-07-01-EvolveGCNH_simulation_table_reshape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">EvolveGCNH_Simulation Tables_reshape</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-07-04-toy_example_figure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Toy Example Figure(Intro)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-07-08-toy_example_using_gnar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Toy example using GNAR</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-07-17-toy_example_guebin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Toy example using GNAR</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-07-18-EbayesThresh toy ex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">EbayesThresh Toy ex</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-07-18-Self Consistency toy ex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Self Consistency Toy ex</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-08-25-batch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Batch</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2099-03-18-SimulationPlanner-Tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SimualtionPlanner-Tutorial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2099-03-22-Baseline_SimulationPlanner-Tutorial_test_test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SimualtionPlanner-Tutorial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2099-05-31-Other Method.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ITSTGCN add Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2099-07-05-ITSTGCN_data_management.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data management for ITSTGCN</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2099-07-20-ITSTGCN_data_magement_figure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data management Figure for ITSTGCN</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../posts/GODE/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GODE</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GODE/2022-09-02-paper_simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simulation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GODE/2022-10-02-Earthquake_real.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Earthquake</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GODE/2022-11-19-class_code_for_paper.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Class code for Comparison Study</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GODE/2022-12-01-graph_code_guebin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Graph code</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GODE/2022-12-16-linspace.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">linspace</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GODE/2022-12-27-DFT_study.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Discrete Fourier Transform</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GODE/2023-06-22-comparison_earthquake.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Comparison Results on Real Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GODE/2023-06-27-Linear_graph_code_for_paper.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Graph code for Paper</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GODE/2023-07-03-other_outlier_detection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Other Outlier Detection</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GODE/2023-08-05-semifinal_simulation_code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Semifinal_Other Outlier Detection</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GODE/2023-08-16-final GODE code(paper).html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">final GODE code(paper)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GODE/2023-08-16-options.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The options of Outlier Detection method</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GODE/2023-10-12-GODE_AUC.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>[GODE]</strong>AUC</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../posts/RESEARCHES/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RESEARCHES</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/RESEARCHES/2023-07-07-Stock_Crawling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Stock Crawling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/RESEARCHES/2023-07-08-stock_on_graph.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Stock on Graph</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/RESEARCHES/2023-07-22-ls2.out.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PyG lesson2: Î≤§ÏπòÎßàÌÅ¨ Îç∞Ïù¥ÌÑ∞ÏÖã (train/testÎ∂ÑÎ¶¨)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/RESEARCHES/2023-08-26-zero-shot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>[LLM]</strong>Zeroshot</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/RESEARCHES/2023-08-28-HCAM_random_old.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>[CAM]</strong>HCAM random</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/RESEARCHES/2023-09-07-ANOMALOUS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>[ANOMALOUS]</strong>Graph</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/RESEARCHES/2023-09-08-llama2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>[LLM]</strong>LLAMA2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/RESEARCHES/2023-09-15-CAM-Original_rst.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Original CAM</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/RESEARCHES/2023-09-16-Grad_CAM_rst.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Original CAM</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/RESEARCHES/2023-09-19-HCAM_original.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>[CAM]</strong>HCAM original</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/RESEARCHES/2023-09-21-CAM_chest_xray.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>[CAM]</strong>chest xray</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/RESEARCHES/2023-09-23-HCAM_hy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>[CAM]</strong>HCAM HY</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#chickenpoxdatasetloader" id="toc-chickenpoxdatasetloader" class="nav-link active" data-scroll-target="#chickenpoxdatasetloader">ChickenpoxDatasetLoader</a></li>
  <li><a href="#pedalmedatasetloader" id="toc-pedalmedatasetloader" class="nav-link" data-scroll-target="#pedalmedatasetloader">PedalMeDatasetLoader</a></li>
  <li><a href="#wikimathsdatasetloader" id="toc-wikimathsdatasetloader" class="nav-link" data-scroll-target="#wikimathsdatasetloader">WikiMathsDatasetLoader</a></li>
  <li><a href="#windmill-output-datasets" id="toc-windmill-output-datasets" class="nav-link" data-scroll-target="#windmill-output-datasets">Windmill Output Datasets</a>
  <ul class="collapse">
  <li><a href="#windmilloutputlargedatasetloader" id="toc-windmilloutputlargedatasetloader" class="nav-link" data-scroll-target="#windmilloutputlargedatasetloader">WindmillOutputLargeDatasetLoader</a></li>
  <li><a href="#windmilloutputmediumdatasetloader" id="toc-windmilloutputmediumdatasetloader" class="nav-link" data-scroll-target="#windmilloutputmediumdatasetloader">WindmillOutputMediumDatasetLoader</a></li>
  <li><a href="#windmilloutputsmalldatasetloader" id="toc-windmilloutputsmalldatasetloader" class="nav-link" data-scroll-target="#windmilloutputsmalldatasetloader">WindmillOutputSmallDatasetLoader</a></li>
  <li><a href="#metrladatasetloader_real-world-traffic-dataset" id="toc-metrladatasetloader_real-world-traffic-dataset" class="nav-link" data-scroll-target="#metrladatasetloader_real-world-traffic-dataset">METRLADatasetLoader_real world traffic dataset</a></li>
  <li><a href="#pemsbaydatasetloader" id="toc-pemsbaydatasetloader" class="nav-link" data-scroll-target="#pemsbaydatasetloader">PemsBayDatasetLoader</a></li>
  <li><a href="#englandcoviddatasetloader" id="toc-englandcoviddatasetloader" class="nav-link" data-scroll-target="#englandcoviddatasetloader">EnglandCovidDatasetLoader</a></li>
  <li><a href="#montevideobusdatasetloader" id="toc-montevideobusdatasetloader" class="nav-link" data-scroll-target="#montevideobusdatasetloader">MontevideoBusDatasetLoader</a></li>
  <li><a href="#twittertennisdatasetloader" id="toc-twittertennisdatasetloader" class="nav-link" data-scroll-target="#twittertennisdatasetloader">TwitterTennisDatasetLoader</a></li>
  <li><a href="#mtmdatasetloader" id="toc-mtmdatasetloader" class="nav-link" data-scroll-target="#mtmdatasetloader">MTMDatasetLoader</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="2022-12-21-ST-GCN_Dataset.out.ipynb" download="2022-12-21-ST-GCN_Dataset.out.ipynb"><i class="bi bi-journal-code"></i>Jupyter</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Posts</li><li class="breadcrumb-item"><a href="../../posts/GCN/index.html">GCN</a></li><li class="breadcrumb-item"><a href="../../posts/GCN/2022-12-21-ST-GCN_Dataset.html">PyTorch ST-GCN Dataset</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">PyTorch ST-GCN Dataset</h1>
  <div class="quarto-categories">
    <div class="quarto-category">ST-GCN</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>SEOYEON CHOI </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 21, 2022</p>
    </div>
  </div>
  
    
  </div>
  


</header>

<blockquote class="blockquote">
<p>PyTorch Geometric Temporal Dataset</p>
</blockquote>
<p>https://pytorch-geometric-temporal.readthedocs.io/en/latest/modules/dataset.html#module-torch_geometric_temporal.dataset.chickenpox</p>
<p><a href="https://arxiv.org/pdf/2104.07788.pdf">ÎÖºÎ¨∏</a></p>
<p>|Dataset|Signal|Graph|Frequency|ùëá|„Ö£ùëâ„Ö£ | |:‚Äì:|:‚Äì:||:‚Äì:||:‚Äì:| |Chickenpox Hungary|Temporal|Static|Weekly|522|20| |Windmill Large|Temporal|Static|Hourly|17,472|319| |Windmill Medium|Temporal|Static|Hourly|17,472|26| |Windmill Small|Temporal|Static|Hourly|17,472|11| |Pedal Me Deliveries|Temporal|Static|Weekly|36|15| |Wikipedia Math|Temporal|Static|Daily|731|1,068| |Twitter Tennis RG|Static|Dynamic|Hourly|120|1000| |Twitter Tennis UO|Static|Dynamic|Hourly|112|1000| |Covid19 England|Temporal|Dynamic|Daily|61|129| |Montevideo Buses|Temporal|Static|Hourly|744|675| |MTM-1 Hand Motions|Temporal|Static|1/24 Seconds|14,469|21|</p>
<div id="19babf03-eb6e-41cf-bf6b-44f956cfb446" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.signal <span class="im">import</span> temporal_signal_split</span></code></pre></div>
</div>
<section id="recurrentgcn" class="level4">
<h4 class="anchored" data-anchor-id="recurrentgcn">RecurrentGCN</h4>
<div id="a107ea3e-d9f1-42f7-a03c-7f93e2ae46ed" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn.functional <span class="im">as</span> F</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.nn.recurrent <span class="im">import</span> GConvGRU</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> RecurrentGCN(torch.nn.Module):</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, node_features, filters):</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>(RecurrentGCN, <span class="va">self</span>).<span class="fu">__init__</span>()</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.recurrent <span class="op">=</span> GConvGRU(node_features, filters, <span class="dv">2</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.linear <span class="op">=</span> torch.nn.Linear(filters, <span class="dv">1</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x, edge_index, edge_weight):</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        h <span class="op">=</span> <span class="va">self</span>.recurrent(x, edge_index, edge_weight)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        h <span class="op">=</span> F.relu(h)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        h <span class="op">=</span> <span class="va">self</span>.linear(h)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> h</span></code></pre></div>
</div>
</section>
<section id="chickenpoxdatasetloader" class="level2">
<h2 class="anchored" data-anchor-id="chickenpoxdatasetloader">ChickenpoxDatasetLoader</h2>
<p>Chickenpox Hungary</p>
<ul>
<li>A spatiotemporal dataset about the officially reported cases of chickenpox in Hungary. The nodes are counties and edges describe direct neighbourhood relationships. The dataset covers the weeks between 2005 and 2015 without missingness.</li>
</ul>
<p>Îç∞Ïù¥ÌÑ∞Ï†ïÎ¶¨</p>
<ul>
<li>T = 519</li>
<li>N = 20 # number of nodes</li>
<li>E = 102 # edges</li>
<li><span class="math inline">\(f(v,t)\)</span>Ïùò Ï∞®Ïõê? (1,)</li>
<li>ÏãúÍ∞ÑÏóê Îî∞ÎùºÏÑú Number of nodesÍ∞Ä Î≥ÄÌïòÎäîÏßÄ? False</li>
<li>ÏãúÍ∞ÑÏóê Îî∞ÎùºÏÑú Number of nodesÍ∞Ä Î≥ÄÌïòÎäîÏßÄ? False</li>
<li>X: (20,4) (N,4), <span class="math inline">\(f(v,t_0),f(v,t_1),f(v,t_2),f(v,t_3)\)</span></li>
<li>y: (20,) (N,), <span class="math inline">\(f(v,t_4)\)</span></li>
<li>ÏòàÏ†úÏΩîÎìúÏ†ÅÏö©Í∞ÄÎä•Ïó¨Î∂Ä: Yes</li>
</ul>
<p><code>-</code> Nodes : <code>20</code></p>
<ul>
<li>vertices are counties</li>
</ul>
<p><code>-</code>Edges : <code>102</code></p>
<ul>
<li>edges are neighbourhoods</li>
</ul>
<p><code>-</code> Time : <code>519</code></p>
<ul>
<li>between 2004 and 2014</li>
<li>per weeks</li>
</ul>
<div id="e88abd86-3127-4a4d-af71-64fad9dc6fa4" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.dataset <span class="im">import</span>  ChickenpoxDatasetLoader</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.signal <span class="im">import</span> temporal_signal_split</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> ChickenpoxDatasetLoader()</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> loader.get_dataset(lags<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>train_dataset, test_dataset <span class="op">=</span> temporal_signal_split(dataset, train_ratio<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="ee5d8b83-6ff5-432c-92bb-3bb971cddc7f" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>[]</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    data.append([time,snapshot])</span></code></pre></div>
</div>
<div id="2f091f24-4b16-4d89-8c11-380a4ea1e79f" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>time</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>519</code></pre>
</div>
</div>
<div id="5176434c-f470-41ae-9ae5-9ab2ef3d3342" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">0</span>][<span class="dv">1</span>]).x.<span class="bu">type</span>,(data[<span class="dv">0</span>][<span class="dv">1</span>]).edge_index.<span class="bu">type</span>,(data[<span class="dv">0</span>][<span class="dv">1</span>]).edge_attr.<span class="bu">type</span>,(data[<span class="dv">0</span>][<span class="dv">1</span>]).y.<span class="bu">type</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>(&lt;function Tensor.type&gt;,
 &lt;function Tensor.type&gt;,
 &lt;function Tensor.type&gt;,
 &lt;function Tensor.type&gt;)</code></pre>
</div>
</div>
<div id="0e968c6a-04c5-408c-a03f-238c5c0d274f" class="cell" data-execution_count="1697">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">max</span>((data[<span class="dv">4</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>])</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1697">
<pre><code>tensor(2.1339)</code></pre>
</div>
</div>
<div id="2b8d1032-bc32-462c-b672-60b5998090eb" class="cell" data-execution_count="1668">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> nx.Graph()</span></code></pre></div>
</div>
<div id="91a73e9b-0e4f-466e-af35-78dd576dd6b5" class="cell" data-execution_count="1669">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>node_list <span class="op">=</span> torch.tensor(<span class="bu">range</span>(<span class="dv">20</span>)).tolist()</span></code></pre></div>
</div>
<div id="b936bae5-5669-4b85-aec8-7933452a9f32" class="cell" data-execution_count="1670">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>G.add_nodes_from(node_list)</span></code></pre></div>
</div>
<div id="79cdc30c-38c0-4153-9c7e-482c504c1ef0" class="cell" data-execution_count="1671">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>data[<span class="op">-</span><span class="dv">1</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1671">
<pre><code>[519, Data(x=[20, 1], edge_index=[2, 102], edge_attr=[102], y=[20])]</code></pre>
</div>
</div>
<div id="6e963d8e-c680-4806-bdd7-bf5998ce58b3" class="cell" data-execution_count="1672">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(data[<span class="dv">0</span>][<span class="dv">1</span>].edge_index[<span class="dv">0</span>])</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1672">
<pre><code>102</code></pre>
</div>
</div>
<div id="5443c9bb-b63f-4ed1-825a-6ff29b359b96" class="cell" data-execution_count="1673">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>edge_list<span class="op">=</span>[]</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">519</span>):</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data[<span class="dv">0</span>][<span class="dv">1</span>].edge_index[<span class="dv">0</span>])):</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        edge_list.append([data[i][<span class="dv">1</span>].edge_index[<span class="dv">0</span>][j].tolist(),data[i][<span class="dv">1</span>].edge_index[<span class="dv">1</span>][j].tolist()])</span></code></pre></div>
</div>
<div id="84870fcc-d873-40cf-ae3f-16910e2a5a22" class="cell" data-execution_count="1674">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>G.add_edges_from(edge_list)</span></code></pre></div>
</div>
<div id="f5e44108-4c8a-47ac-9665-cab6a279cc46" class="cell" data-execution_count="1675">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>G.number_of_nodes(),G.number_of_edges()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1675">
<pre><code>(20, 61)</code></pre>
</div>
</div>
<div id="bc8fc947-c8f5-4f7c-a168-b16f40f3496a" class="cell" data-execution_count="1677">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>nx.draw(G,with_labels<span class="op">=</span><span class="va">True</span>,font_weight<span class="op">=</span><span class="st">'bold'</span>,node_color<span class="op">=</span><span class="st">'green'</span>,node_size<span class="op">=</span><span class="dv">350</span>,font_color<span class="op">=</span><span class="st">'white'</span>,width<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2022-12-21-ST-GCN_Dataset_files/figure-html/cell-17-output-1.png" class="img-fluid"></p>
</div>
</div>
<hr>
<p>timeÎ≥Ñ Í∞ôÏùÄ edge Ï†ïÎ≥¥Î•º Í∞ÄÏßÄÍ≥† ÏûàÎÇò ÌôïÏù∏</p>
<div id="a7c87a34-b784-4886-a871-f486d5aad34b" class="cell" data-execution_count="1559">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>np.where(data[<span class="dv">0</span>][<span class="dv">1</span>].edge_index <span class="op">!=</span> data[<span class="dv">10</span>][<span class="dv">1</span>].edge_index)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1559">
<pre><code>(array([], dtype=int64), array([], dtype=int64))</code></pre>
</div>
</div>
<hr>
<div id="9e69a6c5-a990-46eb-896a-2464ba469f8d" class="cell" data-execution_count="216">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.dataset <span class="im">import</span>  ChickenpoxDatasetLoader</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> ChickenpoxDatasetLoader()</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> loader.get_dataset(lags<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>train_dataset, test_dataset <span class="op">=</span> temporal_signal_split(dataset, train_ratio<span class="op">=</span><span class="fl">0.5</span>)</span></code></pre></div>
</div>
<div id="ba7b3495-c1cb-4e93-8e8c-29038cee9960" class="cell" data-tags="[]" data-execution_count="21">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>[]</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    data.append([time,snapshot])</span></code></pre></div>
</div>
<div id="73c814a9-99b0-4ed1-9dd3-a593c99b6a50" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">0</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>], (data[<span class="dv">0</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>(tensor([-0.0011,  0.0286,  0.3547,  0.2954]), tensor(0.7106))</code></pre>
</div>
</div>
<p><span class="math inline">\(t=0\)</span>ÏóêÏÑú <span class="math inline">\(X\)</span>ÏôÄ <span class="math inline">\(y\)</span>Î•º Ï†ïÎ¶¨ÌïòÎ©¥ ÏïÑÎûòÏôÄ Í∞ôÏùå.</p>
<ul>
<li>X:= <span class="math inline">\(x_0,x_1,x_2,x_3\)</span></li>
<li>y:= <span class="math inline">\(x_4\)</span></li>
</ul>
<div id="9a71d231-9e99-4e05-ad1c-ef4efcde9d14" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">1</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>tensor([0.0286, 0.3547, 0.2954, 0.7106])</code></pre>
</div>
</div>
<ul>
<li>X:= <span class="math inline">\(x_1,x_2,x_3,x_4\)</span></li>
<li>y:= <span class="math inline">\(x_5\)</span></li>
</ul>
<div id="e9b58e09-e39f-4f2e-b4cc-8dd3c8b652e2" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">2</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>tensor([ 0.3547,  0.2954,  0.7106, -0.6831])</code></pre>
</div>
</div>
<ul>
<li>X:=<span class="math inline">\(x_2,x_3,x_4,x_5\)</span></li>
<li>y:=<span class="math inline">\(x_6\)</span></li>
</ul>
<p>ÌïòÎÇòÏùò ÎÖ∏ÎìúÏóê Í∏∏Ïù¥Í∞Ä <span class="math inline">\(T\)</span>Ïù∏ ÏãúÍ≥ÑÏó¥Ïù¥ ÎßµÌïëÎêòÏñ¥ ÏûàÏùå. (ÎÖ∏ÎìúÎäî Ï¥ù 20Í∞ú)</p>
<p>Í∞Å ÎÖ∏ÎìúÎßàÎã§ ÏïÑÎûòÏôÄ Í∞ôÏùÄ Í≥ºÏ†ïÏúºÎ°ú ÏòàÏ∏°Ïù¥ Îê®</p>
<ul>
<li><span class="math inline">\((x_0,x_1,x_2,x_3) \to (x_4)\)</span></li>
<li><span class="math inline">\((x_1,x_2,x_3,x_4) \to (x_5)\)</span></li>
</ul>
<p><span class="math inline">\(f(v,t), v \in \{v_1,\dots,v_{20}\}, t=1,2,\dots,519\)</span></p>
<p><span class="math display">\[{\bf X}_{t=1} = \begin{bmatrix}
f(v_1,t=1) &amp; f(v_1,t=2) &amp; f(v_1,t=3)&amp;  f(v_1,t=4) \\
f(v_2,t=1) &amp; f(v_2,t=2) &amp; f(v_2,t=3)&amp;  f(v_2,t=4) \\
\dots &amp; \dots  &amp; \dots &amp; \dots  \\
f(v_{20},t=1) &amp; f(v_{20},t=2) &amp; f(v_{20},t=3)&amp;  f(v_{20},t=4)
\end{bmatrix}\]</span></p>
<p><span class="math display">\[{\bf y}_{t=1} = \begin{bmatrix}
f(v_1,t=5) \\
f(v_2,t=5) \\
\dots  \\
f(v_{20},t=5)
\end{bmatrix}\]</span></p>
<section id="learn" class="level4">
<h4 class="anchored" data-anchor-id="learn">Learn</h4>
<div id="000e919f-f3d3-408c-8932-cef2c829b226" class="cell" data-execution_count="217">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> RecurrentGCN(node_features<span class="op">=</span><span class="dv">4</span>, filters<span class="op">=</span><span class="dv">32</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> torch.optim.Adam(model.parameters(), lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>model.train()</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> tqdm(<span class="bu">range</span>(<span class="dv">50</span>)):</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>        y_hat <span class="op">=</span> model(snapshot.x, snapshot.edge_index, snapshot.edge_attr)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>        cost <span class="op">=</span> torch.mean((y_hat<span class="op">-</span>snapshot.y)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>        cost.backward()</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 50/50 [00:52&lt;00:00,  1.05s/it]</code></pre>
</div>
</div>
<div id="b871b973-66c8-4221-87cd-2ca818c8aa5c" class="cell" data-execution_count="218">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    _x <span class="op">=</span> snapshot.x </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    _edge_index <span class="op">=</span> snapshot.edge_index </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    _edge_attr <span class="op">=</span> snapshot.edge_attr</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    _y <span class="op">=</span> snapshot.y</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span></code></pre></div>
</div>
<div id="f4be5954-e3dd-474c-9911-f54f12668857" class="cell" data-execution_count="219">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>_x.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="219">
<pre><code>torch.Size([20, 4])</code></pre>
</div>
</div>
<div id="5310a24c-1ab9-4ccb-9635-b14573228fc3" class="cell" data-execution_count="220">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>_edge_index.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="220">
<pre><code>torch.Size([2, 102])</code></pre>
</div>
</div>
<div id="8bf580cd-9997-487c-a0bf-eaba23ac10ff" class="cell" data-execution_count="221">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>_edge_attr.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="221">
<pre><code>torch.Size([102])</code></pre>
</div>
</div>
<div id="ed07fcfb-d1a0-48c9-a8d7-254a948a198d" class="cell" data-execution_count="222">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>_y.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="222">
<pre><code>torch.Size([20])</code></pre>
</div>
</div>
<div id="828f4037-bdc0-47ef-a558-945a83bfed2b" class="cell" data-execution_count="223">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>_x.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="223">
<pre><code>torch.Size([20, 4])</code></pre>
</div>
</div>
<p>x</p>
<ul>
<li><p>Vertex features are lagged weekly counts of the chickenpox cases (we included 4 lags). y</p></li>
<li><p>The target is the weekly number of cases for the upcoming week</p></li>
</ul>
<div id="fe247eda-2129-416f-9679-b13bcf5d4aa5" class="cell" data-execution_count="224">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>_x</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="224">
<pre><code>tensor([[-1.0814e-03,  2.8571e-02,  3.5474e-01,  2.9544e-01],
        [-7.1114e-01, -5.9843e-01,  1.9051e-01,  1.0922e+00],
        [-3.2281e+00, -2.2910e-01,  1.6103e+00, -1.5487e+00],
        [ 6.4750e-01, -2.2117e+00, -9.6858e-01,  1.1862e+00],
        [-1.7302e-01, -9.4717e-01,  1.0347e+00, -6.3751e-01],
        [ 3.6345e-01, -7.5468e-01,  2.9768e-01, -1.6273e-01],
        [-3.4174e+00,  1.7031e+00, -1.6434e+00,  1.7434e+00],
        [-1.9641e+00,  5.5208e-01,  1.1811e+00,  6.7002e-01],
        [-2.2133e+00,  3.0492e+00, -2.3839e+00,  1.8545e+00],
        [-3.3141e-01,  9.5218e-01, -3.7281e-01, -8.2971e-02],
        [-1.8380e+00, -5.8728e-01, -3.5514e-02, -7.2298e-02],
        [-3.4669e-01, -1.9827e-01,  3.9540e-01, -2.4774e-01],
        [ 1.4219e+00, -1.3266e+00,  5.2338e-01, -1.6374e-01],
        [-7.7044e-01,  3.2872e-01, -1.0400e+00,  3.4945e-01],
        [-7.8061e-01, -6.5022e-01,  1.4361e+00, -1.2864e-01],
        [-1.0993e+00,  1.2732e-01,  5.3621e-01,  1.9023e-01],
        [ 2.4583e+00, -1.7811e+00,  5.0732e-02, -9.4371e-01],
        [ 1.0945e+00, -1.5922e+00,  1.3818e-01,  1.1855e+00],
        [-7.0875e-01, -2.2460e-01, -7.0875e-01,  1.5630e+00],
        [-1.8228e+00,  7.8633e-01, -5.6172e-01,  1.2647e+00]])</code></pre>
</div>
</div>
<div id="be9a1935-276b-4744-bc6f-53d83c83112b" class="cell" data-execution_count="225">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>_y</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="225">
<pre><code>tensor([ 0.7106, -0.0725,  2.6099,  1.7870,  0.8024, -0.2614, -0.8370,  1.9674,
        -0.4212,  0.1655,  1.2519,  2.3743,  0.7877,  0.4531, -0.1721, -0.0614,
         1.0452,  0.3203, -1.3791,  0.0036])</code></pre>
</div>
</div>
</section>
</section>
<section id="pedalmedatasetloader" class="level2">
<h2 class="anchored" data-anchor-id="pedalmedatasetloader">PedalMeDatasetLoader</h2>
<p>Pedal Me Deliveries</p>
<ul>
<li>A dataset about the number of weekly bicycle package deliveries by Pedal Me in London during 2020 and 2021. Nodes in the graph represent geographical units and edges are proximity based mutual adjacency relationships.</li>
</ul>
<p>Îç∞Ïù¥ÌÑ∞Ï†ïÎ¶¨</p>
<ul>
<li>T = 33</li>
<li>V = ÏßÄÏó≠Ïùò ÏßëÌï©</li>
<li>N = 15 # number of nodes</li>
<li>E = 225 # edges</li>
<li><span class="math inline">\(f(v,t)\)</span>Ïùò Ï∞®Ïõê? (1,) # number of deliveries</li>
<li>ÏãúÍ∞ÑÏóê Îî∞ÎùºÏÑú NÏù¥ Î≥ÄÌïòÎäîÏßÄ? False</li>
<li>ÏãúÍ∞ÑÏóê Îî∞ÎùºÏÑú EÍ∞Ä Î≥ÄÌïòÎäîÏßÄ? False</li>
<li>X: (15,4) (N,4), <span class="math inline">\(f(v,t_0),f(v,t_1),f(v,t_2),f(v,t_3)\)</span></li>
<li>y: (15,) (N,), <span class="math inline">\(f(v,t_4)\)</span></li>
<li>ÏòàÏ†úÏΩîÎìúÏ†ÅÏö©Í∞ÄÎä•Ïó¨Î∂Ä: Yes</li>
</ul>
<p><code>-</code> Nodes : <code>15</code></p>
<ul>
<li>vertices are localities</li>
</ul>
<p><code>-</code>Edges : <code>225</code></p>
<ul>
<li>edges are spatial_connections</li>
</ul>
<p><code>-</code> Time : <code>33</code></p>
<ul>
<li>between 2020 and 2021</li>
<li>per weeks</li>
</ul>
<div id="f389acf5-bbcd-4961-a40d-198f4baaaab8" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.dataset <span class="im">import</span>  PedalMeDatasetLoader</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.signal <span class="im">import</span> temporal_signal_split</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> PedalMeDatasetLoader()</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> loader.get_dataset(lags<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>train_dataset, test_dataset <span class="op">=</span> temporal_signal_split(dataset, train_ratio<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="36f66aca-1835-4a1a-92e8-79226afc539b" class="cell" data-execution_count="1561">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>[]</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    data.append([time,snapshot])</span></code></pre></div>
</div>
<div id="af966f67-cea9-4056-a8fa-525d6348410e" class="cell" data-execution_count="1541">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>time</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1541">
<pre><code>33</code></pre>
</div>
</div>
<div id="cdda9b11-304d-4c74-849a-14e41a148225" class="cell" data-execution_count="1542">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">0</span>][<span class="dv">1</span>]).x.shape,(data[<span class="dv">0</span>][<span class="dv">1</span>]).edge_index.shape,(data[<span class="dv">0</span>][<span class="dv">1</span>]).edge_attr.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1542">
<pre><code>(torch.Size([15, 1]), torch.Size([2, 225]), torch.Size([225]))</code></pre>
</div>
</div>
<div id="1d8e3bf5-d5b8-443e-9feb-5acb775c7401" class="cell" data-execution_count="1232">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> nx.Graph()</span></code></pre></div>
</div>
<div id="a479c9a9-05c8-4f6e-bef3-185cf0b39cb7" class="cell" data-execution_count="1233">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>node_list <span class="op">=</span> torch.tensor(<span class="bu">range</span>(<span class="dv">15</span>)).tolist()</span></code></pre></div>
</div>
<div id="4fa78aad-250e-4e32-a975-fc08acdad79e" class="cell" data-execution_count="1234">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>G.add_nodes_from(node_list)</span></code></pre></div>
</div>
<div id="df396989-4947-47b1-8c71-041ec509ba6c" class="cell" data-execution_count="1235">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>data[<span class="op">-</span><span class="dv">1</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1235">
<pre><code>[33, Data(x=[15, 1], edge_index=[2, 225], edge_attr=[225], y=[15])]</code></pre>
</div>
</div>
<div id="abbd6071-4a1d-48ed-ad03-7cb8e1dc2099" class="cell" data-execution_count="1236">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>edge_list<span class="op">=</span>[]</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">33</span>):</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data[<span class="dv">0</span>][<span class="dv">1</span>].edge_index[<span class="dv">0</span>])):</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>        edge_list.append([data[i][<span class="dv">1</span>].edge_index[<span class="dv">0</span>][j].tolist(),data[i][<span class="dv">1</span>].edge_index[<span class="dv">1</span>][j].tolist()])</span></code></pre></div>
</div>
<div id="eaef0ff8-5b87-47d3-b64a-de272478c872" class="cell" data-execution_count="1237">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>G.add_edges_from(edge_list)</span></code></pre></div>
</div>
<div id="c14e17c6-9943-43c6-b26b-4fc53e6e93e6" class="cell" data-execution_count="1238">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>G.number_of_nodes(),G.number_of_edges()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1238">
<pre><code>(15, 120)</code></pre>
</div>
</div>
<div id="43bcbd6b-ab0d-4596-9188-8c9a449dea11" class="cell" data-execution_count="1239">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>nx.draw(G,with_labels<span class="op">=</span><span class="va">True</span>,font_weight<span class="op">=</span><span class="st">'bold'</span>,node_color<span class="op">=</span><span class="st">'green'</span>,node_size<span class="op">=</span><span class="dv">350</span>,font_color<span class="op">=</span><span class="st">'white'</span>,width<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2022-12-21-ST-GCN_Dataset_files/figure-html/cell-44-output-1.png" class="img-fluid"></p>
</div>
</div>
<hr>
<p>timeÎ≥Ñ Í∞ôÏùÄ edge Ï†ïÎ≥¥Î•º Í∞ÄÏßÄÍ≥† ÏûàÎÇò ÌôïÏù∏</p>
<div id="faee1dc1-0470-4396-8533-67bdd4a0c6fc" class="cell" data-execution_count="1562">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>np.where(data[<span class="dv">0</span>][<span class="dv">1</span>].edge_index <span class="op">!=</span> data[<span class="dv">10</span>][<span class="dv">1</span>].edge_index)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1562">
<pre><code>(array([], dtype=int64), array([], dtype=int64))</code></pre>
</div>
</div>
<hr>
<div id="39bbf66a-da5f-4b60-98df-346bfcb25ea1" class="cell" data-execution_count="226">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.dataset <span class="im">import</span>  PedalMeDatasetLoader</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> PedalMeDatasetLoader()</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> loader.get_dataset(lags<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>train_dataset, test_dataset <span class="op">=</span> temporal_signal_split(dataset, train_ratio<span class="op">=</span><span class="fl">0.5</span>)</span></code></pre></div>
</div>
<div id="1d5014c1-50e4-4e5e-a81c-bcb1e1c9b5c6" class="cell" data-tags="[]" data-execution_count="227">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>[]</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    data.append([time,snapshot])</span></code></pre></div>
</div>
<div id="a44aba42-41e6-4fa5-b33b-fcc4ac6b5fd7" class="cell" data-execution_count="231">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">0</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>], (data[<span class="dv">0</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="231">
<pre><code>(tensor([ 3.0574, -0.0477, -0.3076,  0.2437]), tensor(-0.2710))</code></pre>
</div>
</div>
<p><span class="math inline">\(t=0\)</span>ÏóêÏÑú <span class="math inline">\(X\)</span>ÏôÄ <span class="math inline">\(y\)</span>Î•º Ï†ïÎ¶¨ÌïòÎ©¥ ÏïÑÎûòÏôÄ Í∞ôÏùå.</p>
<ul>
<li>X:= <span class="math inline">\(x_0,x_1,x_2,x_3\)</span></li>
<li>y:= <span class="math inline">\(x_4\)</span></li>
</ul>
<div id="9b88a132-ce3f-4fcc-be16-e6c8362dc509" class="cell" data-execution_count="234">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">1</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>], (data[<span class="dv">1</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="234">
<pre><code>(tensor([-0.0477, -0.3076,  0.2437, -0.2710]), tensor(0.2490))</code></pre>
</div>
</div>
<ul>
<li>X:= <span class="math inline">\(x_1,x_2,x_3,x_4\)</span></li>
<li>y:= <span class="math inline">\(x_5\)</span></li>
</ul>
<div id="3f61ce41-25e1-4a40-85fc-29425b15cdf1" class="cell" data-execution_count="236">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">2</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>], (data[<span class="dv">2</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="236">
<pre><code>(tensor([-0.3076,  0.2437, -0.2710,  0.2490]), tensor(-0.0357))</code></pre>
</div>
</div>
<ul>
<li>X:=<span class="math inline">\(x_2,x_3,x_4,x_5\)</span></li>
<li>y:=<span class="math inline">\(x_6\)</span></li>
</ul>
<p>ÌïòÎÇòÏùò ÎÖ∏ÎìúÏóê Í∏∏Ïù¥Í∞Ä <span class="math inline">\(T\)</span>Ïù∏ ÏãúÍ≥ÑÏó¥Ïù¥ ÎßµÌïëÎêòÏñ¥ ÏûàÏùå. (ÎÖ∏ÎìúÎäî Ï¥ù 15Í∞ú)</p>
<p>Í∞Å ÎÖ∏ÎìúÎßàÎã§ ÏïÑÎûòÏôÄ Í∞ôÏùÄ Í≥ºÏ†ïÏúºÎ°ú ÏòàÏ∏°Ïù¥ Îê®</p>
<ul>
<li><span class="math inline">\((x_0,x_1,x_2,x_3) \to (x_4)\)</span></li>
<li><span class="math inline">\((x_1,x_2,x_3,x_4) \to (x_5)\)</span></li>
</ul>
<p><span class="math inline">\(f(v,t), v \in \{v_1,\dots,v_{15}\}, t=1,2,\dots,33\)</span></p>
<p><span class="math display">\[{\bf X}_{t=1} = \begin{bmatrix}
f(v_1,t=1) &amp; f(v_1,t=2) &amp; f(v_1,t=3)&amp;  f(v_1,t=4) \\
f(v_2,t=1) &amp; f(v_2,t=2) &amp; f(v_2,t=3)&amp;  f(v_2,t=4) \\
\dots &amp; \dots  &amp; \dots &amp; \dots  \\
f(v_{20},t=1) &amp; f(v_{20},t=2) &amp; f(v_{20},t=3)&amp;  f(v_{20},t=4)
\end{bmatrix}\]</span></p>
<p><span class="math display">\[{\bf y}_{t=1} = \begin{bmatrix}
f(v_1,t=5) \\
f(v_2,t=5) \\
\dots  \\
f(v_{20},t=5)
\end{bmatrix}\]</span></p>
<section id="learn-1" class="level4">
<h4 class="anchored" data-anchor-id="learn-1">Learn</h4>
<div id="493fe1ce-56b1-437c-9ee2-94fefd41773c" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> RecurrentGCN(node_features<span class="op">=</span><span class="dv">4</span>, filters<span class="op">=</span><span class="dv">32</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> torch.optim.Adam(model.parameters(), lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>model.train()</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> tqdm(<span class="bu">range</span>(<span class="dv">50</span>)):</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>        y_hat <span class="op">=</span> model(snapshot.x, snapshot.edge_index, snapshot.edge_attr)</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>        cost <span class="op">=</span> torch.mean((y_hat<span class="op">-</span>snapshot.y)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>        cost.backward()</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 50/50 [00:03&lt;00:00, 16.04it/s]</code></pre>
</div>
</div>
<div id="b3ca826f-9961-40cf-a9bb-208181a7b1c4" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>    _x <span class="op">=</span> snapshot.x </span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    _edge_index <span class="op">=</span> snapshot.edge_index </span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    _edge_attr <span class="op">=</span> snapshot.edge_attr</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    _y <span class="op">=</span> snapshot.y</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span></code></pre></div>
</div>
<div id="ca86109d-4a24-4e38-9e06-776d2fd33786" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>_x.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>torch.Size([15, 4])</code></pre>
</div>
</div>
<div id="77ef7729-dbba-4b69-8f49-09c5b416608d" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>_edge_index.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>torch.Size([2, 225])</code></pre>
</div>
</div>
<div id="1098e838-cc0d-464a-b768-8583c11cd361" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>_edge_attr.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>torch.Size([225])</code></pre>
</div>
</div>
<div id="b5ea78d0-b6d3-4868-9e2b-7b96488f8c09" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>_y.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>torch.Size([15])</code></pre>
</div>
</div>
<div id="1865b2f4-f7cf-42e6-9205-bdbbef51f726" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>_x.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>torch.Size([15, 4])</code></pre>
</div>
</div>
<p>x</p>
<ul>
<li>Vertex features are lagged weekly counts of the delivery demands (we included 4 lags).</li>
<li>Ï£ºÎßàÎã§ Î∞∞Îã¨ ÏàòÏöîÏùò ÏàòÍ∞Ä ÏñºÎßàÎÇò Îê†ÏßÄ percentageÎ°ú, t-4ÏãúÏ†êÍπåÏßÄ?</li>
</ul>
<p>y</p>
<ul>
<li>The target is the weekly number of deliveries the <code>upcoming</code> week. Our dataset consist of more than 30 snapshots (weeks).</li>
<li>Í∑∏ Îã§ÏùåÏ£ºÏóê Î∞∞Îã¨Ïùò ÏàòÍ∞Ä Î™á ÌçºÏÑºÌä∏Î°ú Î∞úÏÉùÌï†ÏßÄ?</li>
</ul>
<div id="7debdff5-8750-488b-b611-e53d2cfd9c67" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>_x[<span class="dv">0</span>:<span class="dv">3</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>tensor([[ 3.0574, -0.0477, -0.3076,  0.2437],
        [ 3.2126,  0.1240,  0.0764,  0.5582],
        [ 1.9071, -0.8883,  1.5280, -0.7184]])</code></pre>
</div>
</div>
<div id="68f5f1f2-e3df-4745-b1d5-ebfe2481e4de" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>_y</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>tensor([-0.2710,  0.0888,  0.4733,  0.0907, -0.3129,  0.1184,  0.5886, -0.6571,
         0.2647,  0.2338,  0.1720,  0.5720, -0.9568, -0.4138, -0.5271])</code></pre>
</div>
</div>
</section>
</section>
<section id="wikimathsdatasetloader" class="level2">
<h2 class="anchored" data-anchor-id="wikimathsdatasetloader">WikiMathsDatasetLoader</h2>
<p>Wikipedia Math</p>
<ul>
<li>Contains Wikipedia pages about popular mathematics topics and edges describe the links from one page to another. Features describe the number of daily visits between 2019 and 2021 March.</li>
</ul>
<p>Îç∞Ïù¥ÌÑ∞Ï†ïÎ¶¨</p>
<ul>
<li>T = 722</li>
<li>V = ÏúÑÌÇ§ÌîºÎîîÏïÑ ÌéòÏù¥ÏßÄ</li>
<li>N = 1068 # number of nodes</li>
<li>E = 27079 # edges</li>
<li><span class="math inline">\(f(v,t)\)</span>Ïùò Ï∞®Ïõê? (1,) # Ìï¥ÎãπÌéòÏù¥ÏßÄÎ•º Ïú†Ï†ÄÍ∞Ä Î∞©Î¨∏Ìïú ÌöüÏàò</li>
<li>ÏãúÍ∞ÑÏóê Îî∞ÎùºÏÑú NÏù¥ Î≥ÄÌïòÎäîÏßÄ? False</li>
<li>ÏãúÍ∞ÑÏóê Îî∞ÎùºÏÑú EÍ∞Ä Î≥ÄÌïòÎäîÏßÄ? False</li>
<li>X: (1068,8) (N,8), <span class="math inline">\(f(v,t_0),f(v,t_1),f(v,t_2),f(v,t_3),f(v,t_4),f(v,t_5),f(v,t_6),f(v,t_7)\)</span></li>
<li>y: (1068,) (N,), <span class="math inline">\(f(v,t_8)\)</span></li>
<li>ÏòàÏ†úÏΩîÎìúÏ†ÅÏö©Í∞ÄÎä•Ïó¨Î∂Ä: Yes</li>
</ul>
<p><code>-</code> Nodes : <code>1068</code></p>
<ul>
<li>vertices are Wikipedia pages</li>
</ul>
<p><code>-</code>Edges : <code>27079</code></p>
<ul>
<li>edges are links between them</li>
</ul>
<p><code>-</code> Time : <code>722</code></p>
<ul>
<li>Wikipedia pages between March 16th 2019 and March 15th 2021</li>
<li>per weeks</li>
</ul>
<div id="c7b8580c-e459-4fdb-a3b7-25ba9ca2d9ed" class="cell" data-execution_count="1640">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.dataset <span class="im">import</span>  WikiMathsDatasetLoader</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.signal <span class="im">import</span> temporal_signal_split</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> WikiMathsDatasetLoader()</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> loader.get_dataset()</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>train_dataset, test_dataset <span class="op">=</span> temporal_signal_split(dataset, train_ratio<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="7ac7b8d7-39e2-4c1f-8485-11e6d7f9f45e" class="cell" data-execution_count="1641">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>[]</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>    data.append([time,snapshot])</span></code></pre></div>
</div>
<div id="53cb459c-17d6-4ca7-800c-cf3c133aea7a" class="cell" data-execution_count="1642">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>time</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1642">
<pre><code>722</code></pre>
</div>
</div>
<div id="74673272-4bcf-4f58-993c-c37d8eca9d6c" class="cell" data-execution_count="1643">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">0</span>][<span class="dv">1</span>]).x.shape,(data[<span class="dv">0</span>][<span class="dv">1</span>]).edge_index.shape,(data[<span class="dv">0</span>][<span class="dv">1</span>]).edge_attr.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1643">
<pre><code>(torch.Size([1068, 8]), torch.Size([2, 27079]), torch.Size([27079]))</code></pre>
</div>
</div>
<div id="e087a80a-cd44-4c50-985a-9c07c24b6412" class="cell" data-execution_count="1646">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">10</span>][<span class="dv">1</span>]).x</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1646">
<pre><code>tensor([[ 0.4972,  0.6838,  0.7211,  ..., -0.8513,  0.1881,  1.3820],
        [ 0.5457,  0.6016,  0.7071,  ..., -0.4599, -0.6089, -0.0626],
        [ 0.6305,  1.1404,  0.8779,  ..., -0.5370,  0.7422,  0.3862],
        ...,
        [ 0.8699,  0.5451,  1.9254,  ..., -0.8351,  0.3828,  0.3828],
        [ 0.2451,  0.9629,  1.0526,  ..., -0.9213,  0.8731, -0.1138],
        [ 0.0200, -0.0871,  0.2342,  ..., -0.4712,  0.0717,  0.2859]])</code></pre>
</div>
</div>
<div id="96b962c4-db9e-45e2-9296-ad329449f643" class="cell" data-execution_count="1616">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> nx.Graph()</span></code></pre></div>
</div>
<div id="f70e0118-0aa5-4986-8278-4defa8cb5e81" class="cell" data-execution_count="1617">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>node_list <span class="op">=</span> torch.tensor(<span class="bu">range</span>(<span class="dv">1068</span>)).tolist()</span></code></pre></div>
</div>
<div id="9b80ac13-97a4-4f96-8290-5b278f26f2c4" class="cell" data-execution_count="1618">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>G.add_nodes_from(node_list)</span></code></pre></div>
</div>
<div id="1ab53e62-dede-4ef3-969c-9644f64d3bd4" class="cell" data-execution_count="1247">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>edge_list<span class="op">=</span>[]</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">722</span>):</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data[<span class="dv">0</span>][<span class="dv">1</span>].edge_index[<span class="dv">0</span>])):</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>        edge_list.append([data[i][<span class="dv">1</span>].edge_index[<span class="dv">0</span>][j].tolist(),data[i][<span class="dv">1</span>].edge_index[<span class="dv">1</span>][j].tolist()])</span></code></pre></div>
</div>
<div id="12392889-3fae-4bbd-a770-8826b0808504" class="cell" data-execution_count="1248">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>G.add_edges_from(edge_list)</span></code></pre></div>
</div>
<div id="c22f959c-09f0-478f-95b2-2ac3b98715fc" class="cell" data-execution_count="1249">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>G.number_of_nodes(),G.number_of_edges()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1249">
<pre><code>(1068, 27079)</code></pre>
</div>
</div>
<div id="929932d3-380d-4489-adbe-27c0c59dd0f7" class="cell" data-execution_count="1250">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>nx.draw(G,node_color<span class="op">=</span><span class="st">'green'</span>,node_size<span class="op">=</span><span class="dv">100</span>,width<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2022-12-21-ST-GCN_Dataset_files/figure-html/cell-71-output-1.png" class="img-fluid"></p>
</div>
</div>
<hr>
<p>timeÎ≥Ñ Í∞ôÏùÄ edge Ï†ïÎ≥¥Î•º Í∞ÄÏßÄÍ≥† ÏûàÎÇò ÌôïÏù∏</p>
<div id="3f9a1fb7-8075-4319-bd91-ac9bdb8d4789" class="cell" data-execution_count="1565">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>np.where(data[<span class="dv">0</span>][<span class="dv">1</span>].edge_index <span class="op">!=</span> data[<span class="dv">10</span>][<span class="dv">1</span>].edge_index)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1565">
<pre><code>(array([], dtype=int64), array([], dtype=int64))</code></pre>
</div>
</div>
<div id="abf86dbc-22b7-43c1-83d4-83df5bb67564" class="cell" data-execution_count="1619">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>np.where(data[<span class="dv">11</span>][<span class="dv">1</span>].edge_index <span class="op">!=</span> data[<span class="dv">10</span>][<span class="dv">1</span>].edge_index)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1619">
<pre><code>(array([], dtype=int64), array([], dtype=int64))</code></pre>
</div>
</div>
<div id="dd65b06e-b1ef-47f3-968a-636565c5de39" class="cell" data-execution_count="1620">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>np.where(data[<span class="dv">11</span>][<span class="dv">1</span>].edge_index <span class="op">!=</span> data[<span class="dv">20</span>][<span class="dv">1</span>].edge_index)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1620">
<pre><code>(array([], dtype=int64), array([], dtype=int64))</code></pre>
</div>
</div>
<hr>
<p>https://www.kaggle.com/code/mapologo/loading-wikipedia-math-essentials</p>
<div id="5c3a1837-953b-4977-a9e9-e1782123eb36" class="cell" data-execution_count="239">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.dataset <span class="im">import</span>  WikiMathsDatasetLoader</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> WikiMathsDatasetLoader()</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> loader.get_dataset(lags<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>train_dataset, test_dataset <span class="op">=</span> temporal_signal_split(dataset, train_ratio<span class="op">=</span><span class="fl">0.5</span>)</span></code></pre></div>
</div>
<div id="0505e330-b407-4295-b6d1-e9848333b852" class="cell" data-tags="[]" data-execution_count="240">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>[]</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>    data.append([time,snapshot])</span></code></pre></div>
</div>
<div id="641ef841-6811-48cd-99f1-7ff6a14a6fc5" class="cell" data-execution_count="241">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">0</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>], (data[<span class="dv">0</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="241">
<pre><code>(tensor([-0.4323, -0.4739,  0.2659,  0.4844,  0.5367,  0.6412,  0.2179, -0.7617]),
 tensor(-0.4067))</code></pre>
</div>
</div>
<p><span class="math inline">\(t=0\)</span>ÏóêÏÑú <span class="math inline">\(X\)</span>ÏôÄ <span class="math inline">\(y\)</span>Î•º Ï†ïÎ¶¨ÌïòÎ©¥ ÏïÑÎûòÏôÄ Í∞ôÏùå.</p>
<ul>
<li>X:= <span class="math inline">\(x_0,x_1,x_2,x_3,,x_4,x_5,x_6,x_7\)</span></li>
<li>y:= <span class="math inline">\(x_9\)</span></li>
</ul>
<div id="2aa752ff-6910-4587-ac93-f29e31237b5a" class="cell" data-execution_count="243">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">1</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>],(data[<span class="dv">1</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="243">
<pre><code>(tensor([-0.4739,  0.2659,  0.4844,  0.5367,  0.6412,  0.2179, -0.7617, -0.4067]),
 tensor(0.3064))</code></pre>
</div>
</div>
<ul>
<li>X:= <span class="math inline">\(x_1,x_2,x_3,x_4,x_5,x_6,x_7,x_8\)</span></li>
<li>y:= <span class="math inline">\(x_9\)</span></li>
</ul>
<div id="6a1901e1-5fe7-45d4-9073-c16ace7f98ee" class="cell" data-execution_count="245">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">2</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>],(data[<span class="dv">2</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="245">
<pre><code>(tensor([ 0.2659,  0.4844,  0.5367,  0.6412,  0.2179, -0.7617, -0.4067,  0.3064]),
 tensor(0.4972))</code></pre>
</div>
</div>
<ul>
<li>X:=<span class="math inline">\(x_2,x_3,x_4,x_5,x_6,x_7,x_8,x_9\)</span></li>
<li>y:=<span class="math inline">\(x_{10}\)</span></li>
</ul>
<p>ÌïòÎÇòÏùò ÎÖ∏ÎìúÏóê Í∏∏Ïù¥Í∞Ä <span class="math inline">\(T\)</span>Ïù∏ ÏãúÍ≥ÑÏó¥Ïù¥ ÎßµÌïëÎêòÏñ¥ ÏûàÏùå. (ÎÖ∏ÎìúÎäî Ï¥ù 1068Í∞ú)</p>
<p>Í∞Å ÎÖ∏ÎìúÎßàÎã§ ÏïÑÎûòÏôÄ Í∞ôÏùÄ Í≥ºÏ†ïÏúºÎ°ú ÏòàÏ∏°Ïù¥ Îê®</p>
<ul>
<li><span class="math inline">\((x_0,x_1,x_2,x_3,x_4,x_5,x_6,x_7) \to (x_8)\)</span></li>
<li><span class="math inline">\((x_1,x_2,x_3,x_4,x_5,x_6,x_7,x_8) \to (x_9)\)</span></li>
</ul>
<p><span class="math inline">\(f(v,t), v \in \{v_1,\dots,v_{1068}\}, t=1,2,\dots,722\)</span></p>
<p><span class="math display">\[{\bf X}_{t=1} = \begin{bmatrix}
f(v_1,t=1) &amp; f(v_1,t=2) &amp; f(v_1,t=3)&amp;  f(v_1,t=4) \\
f(v_2,t=1) &amp; f(v_2,t=2) &amp; f(v_2,t=3)&amp;  f(v_2,t=4) \\
\dots &amp; \dots  &amp; \dots &amp; \dots  \\
f(v_{20},t=1) &amp; f(v_{20},t=2) &amp; f(v_{20},t=3)&amp;  f(v_{20},t=4)
\end{bmatrix}\]</span></p>
<p><span class="math display">\[{\bf y}_{t=1} = \begin{bmatrix}
f(v_1,t=5) \\
f(v_2,t=5) \\
\dots  \\
f(v_{20},t=5)
\end{bmatrix}\]</span></p>
<section id="learn-2" class="level4">
<h4 class="anchored" data-anchor-id="learn-2">Learn</h4>
<div id="c1983c1a-8b6d-4c5b-91fa-c3190a96481d" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> RecurrentGCN(node_features<span class="op">=</span><span class="dv">8</span>, filters<span class="op">=</span><span class="dv">32</span>)</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> torch.optim.Adam(model.parameters(), lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>model.train()</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> tqdm(<span class="bu">range</span>(<span class="dv">50</span>)):</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>        y_hat <span class="op">=</span> model(snapshot.x, snapshot.edge_index, snapshot.edge_attr)</span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a>        cost <span class="op">=</span> torch.mean((y_hat<span class="op">-</span>snapshot.y)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a>        cost.backward()</span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 50/50 [09:28&lt;00:00, 11.37s/it]</code></pre>
</div>
</div>
<div id="8ca67ec3-47f1-44d0-9207-a845fc594a37" class="cell" data-execution_count="167">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>    _x <span class="op">=</span> snapshot.x </span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>    _edge_index <span class="op">=</span> snapshot.edge_index </span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>    _edge_attr <span class="op">=</span> snapshot.edge_attr</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>    _y <span class="op">=</span> snapshot.y</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span></code></pre></div>
</div>
<div id="c1b0351e-6f48-4268-8a8d-7c337f39cb7f" class="cell" data-execution_count="168">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>_x.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="168">
<pre><code>torch.Size([1068, 8])</code></pre>
</div>
</div>
<div id="5bce9da9-ced6-4c38-9d06-e8894a149752" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>_edge_index.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<pre><code>torch.Size([2, 27079])</code></pre>
</div>
</div>
<p>Ïñ¥Îñ§ ÌéòÏù¥ÏßÄÏóê referÍ∞Ä ÎêòÏóàÎäîÏßÄ</p>
<div id="63b1113c-0253-443f-9bd3-0dd481134ad7" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>_edge_index[<span class="dv">0</span>][:<span class="dv">5</span>],_edge_index[<span class="dv">1</span>][:<span class="dv">5</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="73">
<pre><code>(tensor([0, 0, 0, 0, 0]), tensor([1, 2, 3, 4, 5]))</code></pre>
</div>
</div>
<div id="6c2fcf60-8bc6-4b13-b890-6919e52b9a07" class="cell" data-execution_count="116">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>_edge_attr.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="116">
<pre><code>torch.Size([27079])</code></pre>
</div>
</div>
<div id="45def7ce-bbce-4a02-be25-503c02e45e20" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>_edge_attr[:<span class="dv">5</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="77">
<pre><code>tensor([1., 4., 2., 2., 5.])</code></pre>
</div>
</div>
<ul>
<li>Weights represent the number of links found at the source Wikipedia page linking to the target Wikipedia page.</li>
</ul>
<p>Í∞ÄÏ§ëÏπòÎäî Ïó£ÏßÄÎ≥Ñ Ìïú ÌéòÏù¥ÏßÄÏóê referÎêòÏóàÎäîÏßÄ, Î™á Î≤à ÎêòÏóàÎÇò Ïàò ÎÇòÏò¥</p>
<div id="0880884f-84ef-4c0d-8add-39f748b3e8e7" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>_y.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<pre><code>torch.Size([1068])</code></pre>
</div>
</div>
<div id="c8a5844f-02db-471b-83e8-d0aa84eb37a8" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>_x.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<pre><code>torch.Size([1068, 8])</code></pre>
</div>
</div>
<p>x</p>
<ul>
<li>lag Î•º Î™áÏúºÎ°ú ÏßÄÏ†ïÌïòÎäêÎÉêÏóê Îî∞Îùº Îã§Î•¥Í≤å Ï∂îÏ∂ú</li>
</ul>
<p>y</p>
<ul>
<li>The target is the daily user visits to the Wikipedia pages between March 16th 2019 and March 15th 2021 which results in 731 periods.</li>
<li>Îß§Ïùº ÏúÑÌÇ§ÌîºÎîîÏïÑ Ìï¥Îãπ ÌéòÏù¥ÏßÄÏóê Î™á Î™ÖÏùò Ïú†Ï†ÄÍ∞Ä Î∞©Î¨∏ÌïòÎäîÏßÄ!</li>
<li>ÏùåÏàòÍ∞Ä Ïôú ÎÇòÏò§ÏßÄ..</li>
</ul>
<div id="37917124-3acf-4d1a-befd-11c93e1c22c9" class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>_x[<span class="dv">0</span>:<span class="dv">3</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="84">
<pre><code>tensor([[-0.4323, -0.4739,  0.2659,  0.4844,  0.5367,  0.6412,  0.2179, -0.7617],
        [-0.4041, -0.4165, -0.0751,  0.1484,  0.4153,  0.4464, -0.3916, -0.8137],
        [-0.3892,  0.0634,  0.5913,  0.5370,  0.4646,  0.2776, -0.0724, -0.8116]])</code></pre>
</div>
</div>
<div id="96331831-8e40-49fd-afd3-fe04ea680694" class="cell" data-execution_count="117">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>_y[:<span class="dv">3</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="117">
<pre><code>tensor([-0.4067, -0.1620, -0.4043])</code></pre>
</div>
</div>
<div id="9d358f39-8b1c-4404-b36b-e7c3c2125aff" class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>y_hat[:<span class="dv">3</span>].data</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="147">
<pre><code>tensor([[-0.0648],
        [ 0.0314],
        [-1.0724]])</code></pre>
</div>
</div>
</section>
</section>
<section id="windmill-output-datasets" class="level1 page-columns page-full">
<h1>Windmill Output Datasets</h1>
<ul>
<li>An hourly windfarm energy output dataset covering 2 years from a European country. Edge weights are calculated from the proximity of the windmills ‚Äì high weights imply that two windmill stations are in close vicinity. The size of the dataset relates to the groupping of windfarms considered; the smaller datasets are more localized to a single region.</li>
</ul>
<section id="windmilloutputlargedatasetloader" class="level2">
<h2 class="anchored" data-anchor-id="windmilloutputlargedatasetloader">WindmillOutputLargeDatasetLoader</h2>
<p>Hourly energy output of windmills from a European country for more than 2 years. Vertices represent 319 windmills and weighted edges describe the strength of relationships. The target variable allows for regression tasks.</p>
<p>Îç∞Ïù¥ÌÑ∞Ï†ïÎ¶¨</p>
<ul>
<li>T = 17470</li>
<li>V = ÌíçÎ†•Î∞úÏ†ÑÏÜå</li>
<li>N = 319 # number of nodes</li>
<li>E = 101761 = N^2 # edges</li>
<li><span class="math inline">\(f(v,t)\)</span>Ïùò Ï∞®Ïõê? (1,) # Hourly energy output</li>
<li>ÏãúÍ∞ÑÏóê Îî∞ÎùºÏÑú NÏù¥ Î≥ÄÌïòÎäîÏßÄ? False</li>
<li>ÏãúÍ∞ÑÏóê Îî∞ÎùºÏÑú EÍ∞Ä Î≥ÄÌïòÎäîÏßÄ? False</li>
<li>X: (319,4) (N,4), <span class="math inline">\(f(v,t_0),f(v,t_1),f(v,t_2),f(v,t_3)\)</span></li>
<li>y: (319,) (N,), <span class="math inline">\(f(v,t_4)\)</span></li>
<li>ÏòàÏ†úÏΩîÎìúÏ†ÅÏö©Í∞ÄÎä•Ïó¨Î∂Ä: Yes</li>
</ul>
<p><code>-</code> Nodes : <code>319</code></p>
<ul>
<li>vertices represent 319 windmills</li>
</ul>
<p><code>-</code>Edges : <code>101761</code></p>
<ul>
<li>weighted edges describe the strength of relationships.</li>
</ul>
<p><code>-</code> Time : <code>17470</code></p>
<ul>
<li>more than 2 years</li>
</ul>
<div id="24ab9414-eca2-4e9d-b33f-5b3cba2cd347" class="cell" data-execution_count="1566">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.dataset <span class="im">import</span>  WindmillOutputLargeDatasetLoader</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.signal <span class="im">import</span> temporal_signal_split</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> WindmillOutputLargeDatasetLoader()</span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> loader.get_dataset(lags<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>train_dataset, test_dataset <span class="op">=</span> temporal_signal_split(dataset, train_ratio<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="860d47fc-6119-4401-af8b-4d802a112c0d" class="cell" data-execution_count="1567">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>[]</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>    data.append([time,snapshot])</span></code></pre></div>
</div>
<div id="7bfde377-388d-41c2-b10d-0dfdcef61776" class="cell" data-execution_count="1279">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>time</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1279">
<pre><code>17470</code></pre>
</div>
</div>
<div id="f08c4f10-376f-4113-9125-9c5c371da0fb" class="cell" data-execution_count="1280">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">0</span>][<span class="dv">1</span>]).x.shape,(data[<span class="dv">0</span>][<span class="dv">1</span>]).edge_index.shape,(data[<span class="dv">0</span>][<span class="dv">1</span>]).edge_attr.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1280">
<pre><code>(torch.Size([319, 1]), torch.Size([2, 101761]), torch.Size([101761]))</code></pre>
</div>
</div>
<div id="c5ed55a4-4c44-4ba0-96a1-021b45524ef8" class="cell" data-execution_count="1281">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> nx.Graph()</span></code></pre></div>
</div>
<div id="7547534b-c230-4ca2-82f2-4c5e0d497b4e" class="cell" data-execution_count="1282">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>node_list <span class="op">=</span> torch.tensor(<span class="bu">range</span>(<span class="dv">319</span>)).tolist()</span></code></pre></div>
</div>
<div id="3f5ba624-8d74-499f-9279-6446034da57e" class="cell" data-execution_count="1283">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>G.add_nodes_from(node_list)</span></code></pre></div>
</div>
<div id="f66ada63-2e42-4f92-94d5-06e2930e31ef" class="cell" data-execution_count="1284">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>data[<span class="op">-</span><span class="dv">1</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1284">
<pre><code>[17470, Data(x=[319, 1], edge_index=[2, 101761], edge_attr=[101761], y=[319])]</code></pre>
</div>
</div>
<p>timeÏù¥ ÎÑàÎ¨¥ ÎßéÏïÑÏÑú ÏùºÎ∂ÄÎßå ÏãúÍ∞ÅÌôîÌï®!!</p>
<div id="a1f226c6-50ad-4f45-ac46-d4238754b0b2" class="cell" data-execution_count="1285">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>edge_list<span class="op">=</span>[]</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data[<span class="dv">0</span>][<span class="dv">1</span>].edge_index[<span class="dv">0</span>])):</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>        edge_list.append([data[i][<span class="dv">1</span>].edge_index[<span class="dv">0</span>][j].tolist(),data[i][<span class="dv">1</span>].edge_index[<span class="dv">1</span>][j].tolist()])</span></code></pre></div>
</div>
<div id="b93d8aff-ad50-415e-9c33-f5c569dfc9ec" class="cell" data-execution_count="1286">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>G.add_edges_from(edge_list)</span></code></pre></div>
</div>
<div id="66b822c6-7745-4277-913a-79014304e159" class="cell" data-execution_count="1287">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>G.number_of_nodes(),G.number_of_edges()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1287">
<pre><code>(319, 51040)</code></pre>
</div>
</div>
<div id="bdb16bef-be7d-446d-a425-80cdda6a95f4" class="cell" data-execution_count="1288">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>nx.draw(G,with_labels<span class="op">=</span><span class="va">True</span>,font_weight<span class="op">=</span><span class="st">'bold'</span>,node_color<span class="op">=</span><span class="st">'green'</span>,node_size<span class="op">=</span><span class="dv">350</span>,font_color<span class="op">=</span><span class="st">'white'</span>,width<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2022-12-21-ST-GCN_Dataset_files/figure-html/cell-103-output-1.png" class="img-fluid"></p>
</div>
</div>
<hr>
<p>timeÎ≥Ñ Í∞ôÏùÄ edge Ï†ïÎ≥¥Î•º Í∞ÄÏßÄÍ≥† ÏûàÎÇò ÌôïÏù∏</p>
<div id="45339833-2463-441e-bec6-491b9d39cdc3" class="cell" data-execution_count="1568">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>np.where(data[<span class="dv">0</span>][<span class="dv">1</span>].edge_index <span class="op">!=</span> data[<span class="dv">10</span>][<span class="dv">1</span>].edge_index)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1568">
<pre><code>(array([], dtype=int64), array([], dtype=int64))</code></pre>
</div>
</div>
<hr>
<div id="503cf76a-1928-45ae-a6f6-fa94d36bc133" class="cell" data-execution_count="246">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.dataset <span class="im">import</span>  WindmillOutputLargeDatasetLoader</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> WindmillOutputLargeDatasetLoader()</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> loader.get_dataset(lags<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>train_dataset, test_dataset <span class="op">=</span> temporal_signal_split(dataset, train_ratio<span class="op">=</span><span class="fl">0.5</span>)</span></code></pre></div>
</div>
<div id="76436e57-8bd0-4848-81d4-2e41447d2ef9" class="cell" data-tags="[]" data-execution_count="247">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>[]</span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>    data.append([time,snapshot])</span></code></pre></div>
</div>
<div id="71315c10-2070-4b15-9f96-0ed39533ad41" class="cell" data-execution_count="248">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">0</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>], (data[<span class="dv">0</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="248">
<pre><code>(tensor([-0.5711, -0.7560,  2.6278, -0.8674]), tensor(-0.9877))</code></pre>
</div>
</div>
<p><span class="math inline">\(t=0\)</span>ÏóêÏÑú <span class="math inline">\(X\)</span>ÏôÄ <span class="math inline">\(y\)</span>Î•º Ï†ïÎ¶¨ÌïòÎ©¥ ÏïÑÎûòÏôÄ Í∞ôÏùå.</p>
<ul>
<li>X:= <span class="math inline">\(x_0,x_1,x_2,x_3\)</span></li>
<li>y:= <span class="math inline">\(x_4\)</span></li>
</ul>
<div id="91890912-8591-4252-93eb-726a0f55f70f" class="cell" data-execution_count="249">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">1</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>], (data[<span class="dv">1</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="249">
<pre><code>(tensor([-0.7560,  2.6278, -0.8674, -0.9877]), tensor(-0.8583))</code></pre>
</div>
</div>
<ul>
<li>X:= <span class="math inline">\(x_1,x_2,x_3,x_4\)</span></li>
<li>y:= <span class="math inline">\(x_5\)</span></li>
</ul>
<div id="7d2477a9-3e25-42f4-94cd-a99165bd7c41" class="cell" data-execution_count="250">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">2</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>],(data[<span class="dv">2</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="250">
<pre><code>(tensor([ 2.6278, -0.8674, -0.9877, -0.8583]), tensor(0.4282))</code></pre>
</div>
</div>
<ul>
<li>X:=<span class="math inline">\(x_2,x_3,x_4,x_5\)</span></li>
<li>y:=<span class="math inline">\(x_6\)</span></li>
</ul>
<p>ÌïòÎÇòÏùò ÎÖ∏ÎìúÏóê Í∏∏Ïù¥Í∞Ä <span class="math inline">\(T\)</span>Ïù∏ ÏãúÍ≥ÑÏó¥Ïù¥ ÎßµÌïëÎêòÏñ¥ ÏûàÏùå. (ÎÖ∏ÎìúÎäî Ï¥ù 319Í∞ú)</p>
<p>Í∞Å ÎÖ∏ÎìúÎßàÎã§ ÏïÑÎûòÏôÄ Í∞ôÏùÄ Í≥ºÏ†ïÏúºÎ°ú ÏòàÏ∏°Ïù¥ Îê®</p>
<ul>
<li><span class="math inline">\((x_0,x_1,x_2,x_3) \to (x_4)\)</span></li>
<li><span class="math inline">\((x_1,x_2,x_3,x_4) \to (x_5)\)</span></li>
</ul>
<p><span class="math inline">\(f(v,t), v \in \{v_1,\dots,v_{319}\}, t=1,2,\dots,17470\)</span></p>
<p><span class="math display">\[{\bf X}_{t=1} = \begin{bmatrix}
f(v_1,t=1) &amp; f(v_1,t=2) &amp; f(v_1,t=3)&amp;  f(v_1,t=4) \\
f(v_2,t=1) &amp; f(v_2,t=2) &amp; f(v_2,t=3)&amp;  f(v_2,t=4) \\
\dots &amp; \dots  &amp; \dots &amp; \dots  \\
f(v_{20},t=1) &amp; f(v_{20},t=2) &amp; f(v_{20},t=3)&amp;  f(v_{20},t=4)
\end{bmatrix}\]</span></p>
<p><span class="math display">\[{\bf y}_{t=1} = \begin{bmatrix}
f(v_1,t=5) \\
f(v_2,t=5) \\
\dots  \\
f(v_{20},t=5)
\end{bmatrix}\]</span></p>
<section id="learn-3" class="level4">
<h4 class="anchored" data-anchor-id="learn-3">Learn</h4>
<div id="c14e79eb-3f9d-4a10-a3d5-2919ff5b9092" class="cell" data-execution_count="145">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> RecurrentGCN(node_features<span class="op">=</span><span class="dv">4</span>, filters<span class="op">=</span><span class="dv">32</span>)</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> torch.optim.Adam(model.parameters(), lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>model.train()</span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> tqdm(<span class="bu">range</span>(<span class="dv">5</span>)):</span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a>        y_hat <span class="op">=</span> model(snapshot.x, snapshot.edge_index, snapshot.edge_attr)</span>
<span id="cb172-10"><a href="#cb172-10" aria-hidden="true" tabindex="-1"></a>        cost <span class="op">=</span> torch.mean((y_hat<span class="op">-</span>snapshot.y)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb172-11"><a href="#cb172-11" aria-hidden="true" tabindex="-1"></a>        cost.backward()</span>
<span id="cb172-12"><a href="#cb172-12" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb172-13"><a href="#cb172-13" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 5/5 [1:06:03&lt;00:00, 792.70s/it]</code></pre>
</div>
</div>
<div id="6d16845f-dda9-4107-90ff-aea49696acf4" class="cell" data-execution_count="146">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>    _x <span class="op">=</span> snapshot.x </span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>    _edge_index <span class="op">=</span> snapshot.edge_index </span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>    _edge_attr <span class="op">=</span> snapshot.edge_attr</span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>    _y <span class="op">=</span> snapshot.y</span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span></code></pre></div>
</div>
<div id="c53bed14-6848-4099-a501-e912f9764272" class="cell" data-execution_count="147">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>_x.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="147">
<pre><code>torch.Size([319, 4])</code></pre>
</div>
</div>
<div id="c4d5ab02-0aeb-422c-af9c-6d740fd440fd" class="cell" data-execution_count="148">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>_edge_index.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="148">
<pre><code>torch.Size([2, 101761])</code></pre>
</div>
</div>
<div id="5236c958-54f7-4d16-80bb-ad5085ae97f8" class="cell" data-execution_count="149">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>_edge_attr.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="149">
<pre><code>torch.Size([101761])</code></pre>
</div>
</div>
<div id="e6387e39-fcaa-4f52-8bfe-91f7599b4868" class="cell" data-execution_count="150">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>_y.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="150">
<pre><code>torch.Size([319])</code></pre>
</div>
</div>
<div id="80c152f6-0a9d-4e4a-9f7d-0a6e079ef51c" class="cell" data-execution_count="151">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>_x.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="151">
<pre><code>torch.Size([319, 4])</code></pre>
</div>
</div>
<p>x</p>
<ul>
<li></li>
</ul>
<p>y</p>
<ul>
<li>The target variable allows for regression tasks.</li>
</ul>
<div id="7e956bdd-13f5-4234-9b78-b0fb0606b85d" class="cell" data-execution_count="152">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>_x[<span class="dv">0</span>:<span class="dv">3</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="152">
<pre><code>tensor([[-0.5711, -0.7560,  2.6278, -0.8674],
        [-0.6936, -0.7264,  2.4113, -0.6052],
        [-0.8666, -0.7785,  2.2759, -0.6759]])</code></pre>
</div>
</div>
<div id="718585dc-9051-4618-aee0-1d58ea6e6fc3" class="cell" data-execution_count="154">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>_y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="154">
<pre><code>tensor(-0.9877)</code></pre>
</div>
</div>
</section>
</section>
<section id="windmilloutputmediumdatasetloader" class="level2">
<h2 class="anchored" data-anchor-id="windmilloutputmediumdatasetloader">WindmillOutputMediumDatasetLoader</h2>
<p>Hourly energy output of windmills from a European country for more than 2 years. Vertices represent 26 windmills and weighted edges describe the strength of relationships. The target variable allows for regression tasks.</p>
<p>Îç∞Ïù¥ÌÑ∞Ï†ïÎ¶¨</p>
<ul>
<li>T = 17470</li>
<li>V = ÌíçÎ†•Î∞úÏ†ÑÏÜå</li>
<li>N = 319 # number of nodes</li>
<li>E = 101761 = N^2 # edges</li>
<li><span class="math inline">\(f(v,t)\)</span>Ïùò Ï∞®Ïõê? (1,) # Hourly energy output</li>
<li>ÏãúÍ∞ÑÏóê Îî∞ÎùºÏÑú NÏù¥ Î≥ÄÌïòÎäîÏßÄ? False</li>
<li>ÏãúÍ∞ÑÏóê Îî∞ÎùºÏÑú EÍ∞Ä Î≥ÄÌïòÎäîÏßÄ? False</li>
<li>X: (319,4) (N,4), <span class="math inline">\(f(v,t_0),f(v,t_1),f(v,t_2),f(v,t_3)\)</span></li>
<li>y: (319,) (N,), <span class="math inline">\(f(v,t_4)\)</span></li>
<li>ÏòàÏ†úÏΩîÎìúÏ†ÅÏö©Í∞ÄÎä•Ïó¨Î∂Ä: Yes</li>
</ul>
<p><code>-</code> Nodes : <code>26</code></p>
<ul>
<li>vertices represent 26 windmills</li>
</ul>
<p><code>-</code>Edges : <code>225</code></p>
<ul>
<li>weighted edges describe the strength of relationships</li>
</ul>
<p><code>-</code> Time : <code>676</code></p>
<ul>
<li>more than 2 years</li>
</ul>
<div id="bdca14f1-4cb9-46c8-b216-6ac98cc58021" class="cell" data-execution_count="1569">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.dataset <span class="im">import</span>  WindmillOutputMediumDatasetLoader</span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.signal <span class="im">import</span> temporal_signal_split</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> WindmillOutputMediumDatasetLoader()</span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> loader.get_dataset(lags<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a>train_dataset, test_dataset <span class="op">=</span> temporal_signal_split(dataset, train_ratio<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="a265dd2b-acb2-480a-940e-1d50d7c8e5da" class="cell" data-execution_count="1570">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>[]</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>    data.append([time,snapshot])</span></code></pre></div>
</div>
<div id="a7d1e75e-564e-4306-98af-0c0a4a5945d4" class="cell" data-execution_count="1319">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>time</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1319">
<pre><code>17470</code></pre>
</div>
</div>
<div id="196cdd44-eb97-4a61-9dfd-7eb89dac1511" class="cell" data-execution_count="1320">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">0</span>][<span class="dv">1</span>]).x.shape,(data[<span class="dv">0</span>][<span class="dv">1</span>]).edge_index.shape,(data[<span class="dv">0</span>][<span class="dv">1</span>]).edge_attr.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1320">
<pre><code>(torch.Size([26, 1]), torch.Size([2, 676]), torch.Size([676]))</code></pre>
</div>
</div>
<div id="76c6867e-f4c1-40b4-a653-e2fcc453425d" class="cell" data-execution_count="1321">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> nx.Graph()</span></code></pre></div>
</div>
<div id="1c95d66e-247a-4570-86a8-7c0ba50350d7" class="cell" data-execution_count="1322">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>node_list <span class="op">=</span> torch.tensor(<span class="bu">range</span>(<span class="dv">26</span>)).tolist()</span></code></pre></div>
</div>
<div id="6da49250-6075-4200-9fe4-d592efd983bc" class="cell" data-execution_count="1323">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>G.add_nodes_from(node_list)</span></code></pre></div>
</div>
<div id="a0542752-1e8d-45cc-99ed-23a45110c837" class="cell" data-execution_count="1324">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>data[<span class="op">-</span><span class="dv">1</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1324">
<pre><code>[17470, Data(x=[26, 1], edge_index=[2, 676], edge_attr=[676], y=[26])]</code></pre>
</div>
</div>
<div id="edcdce5f-a540-4fd1-ae46-fd9e0e76ba49" class="cell" data-execution_count="1325">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>edge_list<span class="op">=</span>[]</span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">17463</span>):</span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data[<span class="dv">0</span>][<span class="dv">1</span>].edge_index[<span class="dv">0</span>])):</span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>        edge_list.append([data[i][<span class="dv">1</span>].edge_index[<span class="dv">0</span>][j].tolist(),data[i][<span class="dv">1</span>].edge_index[<span class="dv">1</span>][j].tolist()])</span></code></pre></div>
</div>
<div id="acca99f1-0f06-4535-8825-58ce212630dc" class="cell" data-execution_count="1326">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>G.add_edges_from(edge_list)</span></code></pre></div>
</div>
<div id="cb2fb7e5-f287-4cb0-98d2-e049f4ccf783" class="cell" data-execution_count="1327">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>G.number_of_nodes(),G.number_of_edges()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1327">
<pre><code>(26, 351)</code></pre>
</div>
</div>
<div id="79858b20-10c0-40c6-91e7-4e215c3654de" class="cell" data-execution_count="1328">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>nx.draw(G,with_labels<span class="op">=</span><span class="va">True</span>,font_weight<span class="op">=</span><span class="st">'bold'</span>,node_color<span class="op">=</span><span class="st">'green'</span>,node_size<span class="op">=</span><span class="dv">350</span>,font_color<span class="op">=</span><span class="st">'white'</span>,width<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2022-12-21-ST-GCN_Dataset_files/figure-html/cell-130-output-1.png" class="img-fluid"></p>
</div>
</div>
<hr>
<p>timeÎ≥Ñ Í∞ôÏùÄ edge Ï†ïÎ≥¥Î•º Í∞ÄÏßÄÍ≥† ÏûàÎÇò ÌôïÏù∏</p>
<div id="07d63efb-bc85-4b91-9a08-03e268d3aa75" class="cell" data-execution_count="1571">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>np.where(data[<span class="dv">0</span>][<span class="dv">1</span>].edge_index <span class="op">!=</span> data[<span class="dv">10</span>][<span class="dv">1</span>].edge_index)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1571">
<pre><code>(array([], dtype=int64), array([], dtype=int64))</code></pre>
</div>
</div>
<hr>
<div id="c3d8a3d1-8cde-45d8-9f88-a1c1cbd4196d" class="cell" data-execution_count="251">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.dataset <span class="im">import</span>  WindmillOutputMediumDatasetLoader</span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> WindmillOutputMediumDatasetLoader()</span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> loader.get_dataset(lags<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-6"><a href="#cb207-6" aria-hidden="true" tabindex="-1"></a>train_dataset, test_dataset <span class="op">=</span> temporal_signal_split(dataset, train_ratio<span class="op">=</span><span class="fl">0.5</span>)</span></code></pre></div>
</div>
<div id="c8e6bd8c-7965-4504-b20e-9eef766324e3" class="cell" data-tags="[]" data-execution_count="252">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>[]</span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>    data.append([time,snapshot])</span></code></pre></div>
</div>
<div id="a17cf5e5-67c5-4f69-9b26-945c554a90f9" class="cell" data-execution_count="253">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">0</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>], (data[<span class="dv">0</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="253">
<pre><code>(tensor([-0.2170, -0.2055, -0.1587, -0.1930]), tensor(-0.2149))</code></pre>
</div>
</div>
<p><span class="math inline">\(t=0\)</span>ÏóêÏÑú <span class="math inline">\(X\)</span>ÏôÄ <span class="math inline">\(y\)</span>Î•º Ï†ïÎ¶¨ÌïòÎ©¥ ÏïÑÎûòÏôÄ Í∞ôÏùå.</p>
<ul>
<li>X:= <span class="math inline">\(x_0,x_1,x_2,x_3\)</span></li>
<li>y:= <span class="math inline">\(x_4\)</span></li>
</ul>
<div id="f65256a6-39a7-4e50-8d9b-2a9e9c5b619e" class="cell" data-execution_count="254">
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">1</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>],(data[<span class="dv">1</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="254">
<pre><code>(tensor([-0.2055, -0.1587, -0.1930, -0.2149]), tensor(-0.2336))</code></pre>
</div>
</div>
<ul>
<li>X:= <span class="math inline">\(x_1,x_2,x_3,x_4\)</span></li>
<li>y:= <span class="math inline">\(x_5\)</span></li>
</ul>
<div id="0c0ab108-15e4-48bf-9b93-9b0a520fb91b" class="cell" data-execution_count="255">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">2</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>],(data[<span class="dv">2</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="255">
<pre><code>(tensor([-0.1587, -0.1930, -0.2149, -0.2336]), tensor(-0.1785))</code></pre>
</div>
</div>
<ul>
<li>X:=<span class="math inline">\(x_2,x_3,x_4,x_5\)</span></li>
<li>y:=<span class="math inline">\(x_6\)</span></li>
</ul>
<p>ÌïòÎÇòÏùò ÎÖ∏ÎìúÏóê Í∏∏Ïù¥Í∞Ä <span class="math inline">\(T\)</span>Ïù∏ ÏãúÍ≥ÑÏó¥Ïù¥ ÎßµÌïëÎêòÏñ¥ ÏûàÏùå. (ÎÖ∏ÎìúÎäî Ï¥ù 26Í∞ú)</p>
<p>Í∞Å ÎÖ∏ÎìúÎßàÎã§ ÏïÑÎûòÏôÄ Í∞ôÏùÄ Í≥ºÏ†ïÏúºÎ°ú ÏòàÏ∏°Ïù¥ Îê®</p>
<ul>
<li><span class="math inline">\((x_0,x_1,x_2,x_3) \to (x_4)\)</span></li>
<li><span class="math inline">\((x_1,x_2,x_3,x_4) \to (x_5)\)</span></li>
</ul>
<p><span class="math inline">\(f(v,t), v \in \{v_1,\dots,v_{26}\}, t=1,2,\dots,177470\)</span></p>
<p><span class="math display">\[{\bf X}_{t=1} = \begin{bmatrix}
f(v_1,t=1) &amp; f(v_1,t=2) &amp; f(v_1,t=3)&amp;  f(v_1,t=4) \\
f(v_2,t=1) &amp; f(v_2,t=2) &amp; f(v_2,t=3)&amp;  f(v_2,t=4) \\
\dots &amp; \dots  &amp; \dots &amp; \dots  \\
f(v_{20},t=1) &amp; f(v_{20},t=2) &amp; f(v_{20},t=3)&amp;  f(v_{20},t=4)
\end{bmatrix}\]</span></p>
<p><span class="math display">\[{\bf y}_{t=1} = \begin{bmatrix}
f(v_1,t=5) \\
f(v_2,t=5) \\
\dots  \\
f(v_{20},t=5)
\end{bmatrix}\]</span></p>
<section id="learn-4" class="level4">
<h4 class="anchored" data-anchor-id="learn-4">Learn</h4>
<div id="6d52d210-7868-42e2-8d84-0177b5020e27" class="cell" data-execution_count="161">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> RecurrentGCN(node_features<span class="op">=</span><span class="dv">4</span>, filters<span class="op">=</span><span class="dv">32</span>)</span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> torch.optim.Adam(model.parameters(), lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a>model.train()</span>
<span id="cb215-6"><a href="#cb215-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-7"><a href="#cb215-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> tqdm(<span class="bu">range</span>(<span class="dv">5</span>)):</span>
<span id="cb215-8"><a href="#cb215-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb215-9"><a href="#cb215-9" aria-hidden="true" tabindex="-1"></a>        y_hat <span class="op">=</span> model(snapshot.x, snapshot.edge_index, snapshot.edge_attr)</span>
<span id="cb215-10"><a href="#cb215-10" aria-hidden="true" tabindex="-1"></a>        cost <span class="op">=</span> torch.mean((y_hat<span class="op">-</span>snapshot.y)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb215-11"><a href="#cb215-11" aria-hidden="true" tabindex="-1"></a>        cost.backward()</span>
<span id="cb215-12"><a href="#cb215-12" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb215-13"><a href="#cb215-13" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 5/5 [03:23&lt;00:00, 40.73s/it]</code></pre>
</div>
</div>
<div id="59f0d87d-46c3-4db8-8245-5291cd2afc58" class="cell" data-execution_count="162">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>    _x <span class="op">=</span> snapshot.x </span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a>    _edge_index <span class="op">=</span> snapshot.edge_index </span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a>    _edge_attr <span class="op">=</span> snapshot.edge_attr</span>
<span id="cb217-5"><a href="#cb217-5" aria-hidden="true" tabindex="-1"></a>    _y <span class="op">=</span> snapshot.y</span>
<span id="cb217-6"><a href="#cb217-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span></code></pre></div>
</div>
<div id="05726933-1fee-418b-b276-61b0b22940c7" class="cell" data-execution_count="163">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>_x.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="163">
<pre><code>torch.Size([26, 4])</code></pre>
</div>
</div>
<div id="efdc6e81-92be-430e-8ceb-57ca7e75a9a7" class="cell" data-execution_count="164">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>_edge_index.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="164">
<pre><code>torch.Size([2, 676])</code></pre>
</div>
</div>
<div id="5cfff3ab-ac31-4a89-93a3-62e307c091db" class="cell" data-execution_count="165">
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>_edge_attr.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="165">
<pre><code>torch.Size([676])</code></pre>
</div>
</div>
<div id="355a8d5c-c5c0-4d5a-85b6-20d150c58f9c" class="cell" data-execution_count="166">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>_y.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="166">
<pre><code>torch.Size([26])</code></pre>
</div>
</div>
<div id="d202d76b-5b2d-49e7-ad8f-f9fb36e649ff" class="cell" data-execution_count="167">
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>_x.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="167">
<pre><code>torch.Size([26, 4])</code></pre>
</div>
</div>
<p>x</p>
<ul>
<li></li>
</ul>
<p>y</p>
<ul>
<li>The target variable allows for regression tasks.</li>
</ul>
<div id="66bc6d3d-7bfb-4fa2-b466-d216a71d7d16" class="cell" data-execution_count="168">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>_x[<span class="dv">0</span>:<span class="dv">3</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="168">
<pre><code>tensor([[-0.2170, -0.2055, -0.1587, -0.1930],
        [-0.1682, -0.2708, -0.1051,  1.1786],
        [ 1.1540, -0.6707, -0.8291, -0.6823]])</code></pre>
</div>
</div>
<div id="5939da59-d3c3-4a1b-a249-ac2517a2390d" class="cell" data-execution_count="169">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>_y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="169">
<pre><code>tensor(-0.2149)</code></pre>
</div>
</div>
</section>
</section>
<section id="windmilloutputsmalldatasetloader" class="level2">
<h2 class="anchored" data-anchor-id="windmilloutputsmalldatasetloader">WindmillOutputSmallDatasetLoader</h2>
<p>Hourly energy output of windmills from a European country for more than 2 years. Vertices represent 11 windmills and weighted edges describe the strength of relationships. The target variable allows for regression tasks.</p>
<p>Îç∞Ïù¥ÌÑ∞Ï†ïÎ¶¨</p>
<ul>
<li>T = 17470</li>
<li>V = ÌíçÎ†•Î∞úÏ†ÑÏÜå</li>
<li>N = 11 # number of nodes</li>
<li>E = 121 = N^2 # edges</li>
<li><span class="math inline">\(f(v,t)\)</span>Ïùò Ï∞®Ïõê? (1,) # Hourly energy output</li>
<li>ÏãúÍ∞ÑÏóê Îî∞ÎùºÏÑú NÏù¥ Î≥ÄÌïòÎäîÏßÄ? False</li>
<li>ÏãúÍ∞ÑÏóê Îî∞ÎùºÏÑú EÍ∞Ä Î≥ÄÌïòÎäîÏßÄ? False</li>
<li>X: (11,4) (N,4), <span class="math inline">\(f(v,t_0),f(v,t_1),f(v,t_2),f(v,t_3)\)</span></li>
<li>y: (11,) (N,), <span class="math inline">\(f(v,t_4)\)</span></li>
<li>ÏòàÏ†úÏΩîÎìúÏ†ÅÏö©Í∞ÄÎä•Ïó¨Î∂Ä: Yes</li>
</ul>
<p><code>-</code> Nodes : <code>11</code></p>
<ul>
<li>vertices represent 11 windmills</li>
</ul>
<p><code>-</code>Edges : <code>121</code></p>
<ul>
<li>weighted edges describe the strength of relationships</li>
</ul>
<p><code>-</code> Time : <code>17470</code></p>
<ul>
<li>more than 2 years</li>
</ul>
<div id="7ab01cf4-1056-4121-81fc-f7823aaddd85" class="cell" data-execution_count="1572">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.dataset <span class="im">import</span> WindmillOutputSmallDatasetLoader</span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.signal <span class="im">import</span> temporal_signal_split</span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> WindmillOutputSmallDatasetLoader()</span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-6"><a href="#cb232-6" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> loader.get_dataset()</span>
<span id="cb232-7"><a href="#cb232-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-8"><a href="#cb232-8" aria-hidden="true" tabindex="-1"></a>train_dataset, test_dataset <span class="op">=</span> temporal_signal_split(dataset, train_ratio<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="2da45d1a-1add-4060-82b0-cad391101ca5" class="cell" data-execution_count="1573">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>[]</span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>    data.append([time,snapshot])</span></code></pre></div>
</div>
<div id="2a7c65d7-0d0a-4879-8baf-5252c79cf179" class="cell" data-execution_count="1303">
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a>time</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1303">
<pre><code>17463</code></pre>
</div>
</div>
<div id="6e010267-90c8-4bd3-9fe1-b62c57359fe1" class="cell" data-execution_count="1304">
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">0</span>][<span class="dv">1</span>]).x.shape,(data[<span class="dv">0</span>][<span class="dv">1</span>]).edge_index.shape,(data[<span class="dv">0</span>][<span class="dv">1</span>]).edge_attr.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1304">
<pre><code>(torch.Size([11, 8]), torch.Size([2, 121]), torch.Size([121]))</code></pre>
</div>
</div>
<div id="306955b2-d279-4c6e-8922-fa51aa7844af" class="cell" data-execution_count="1305">
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a>data[<span class="op">-</span><span class="dv">1</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1305">
<pre><code>[17463, Data(x=[11, 8], edge_index=[2, 121], edge_attr=[121], y=[11])]</code></pre>
</div>
</div>
<div id="2c281aad-7f59-45f1-95cc-436130843347" class="cell" data-execution_count="1306">
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> nx.Graph()</span></code></pre></div>
</div>
<div id="a19803de-63c1-426d-a2bb-a0c0c3cac2c9" class="cell" data-execution_count="1307">
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a>node_list <span class="op">=</span> torch.tensor(<span class="bu">range</span>(<span class="dv">11</span>)).tolist()</span></code></pre></div>
</div>
<div id="7abf3a26-6250-4af7-bd8e-a9424c6f65f1" class="cell" data-execution_count="1308">
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a>G.add_nodes_from(node_list)</span></code></pre></div>
</div>
<div id="a1501f7b-f0f7-431d-abfc-89491cc9db45" class="cell" data-execution_count="1313">
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a>edge_list<span class="op">=</span>[]</span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">17463</span>):</span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data[<span class="dv">0</span>][<span class="dv">1</span>].edge_index[<span class="dv">0</span>])):</span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a>        edge_list.append([data[i][<span class="dv">1</span>].edge_index[<span class="dv">0</span>][j].tolist(),data[i][<span class="dv">1</span>].edge_index[<span class="dv">1</span>][j].tolist()])</span></code></pre></div>
</div>
<div id="7cd228a7-acbe-42d0-b2b3-8fde1b883a07" class="cell" data-execution_count="1314">
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a>G.add_edges_from(edge_list)</span></code></pre></div>
</div>
<div id="92b4b5de-05ff-498c-8d7a-e66bb28ab1c7" class="cell" data-execution_count="1315">
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>G.number_of_nodes(),G.number_of_edges()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1315">
<pre><code>(11, 66)</code></pre>
</div>
</div>
<div id="dd0769bb-ae05-449b-b8f2-7f15a1d213b8" class="cell" data-execution_count="1316">
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a>nx.draw(G,with_labels<span class="op">=</span><span class="va">True</span>,font_weight<span class="op">=</span><span class="st">'bold'</span>,node_color<span class="op">=</span><span class="st">'green'</span>,node_size<span class="op">=</span><span class="dv">350</span>,font_color<span class="op">=</span><span class="st">'white'</span>,width<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2022-12-21-ST-GCN_Dataset_files/figure-html/cell-157-output-1.png" class="img-fluid"></p>
</div>
</div>
<hr>
<p>timeÎ≥Ñ Í∞ôÏùÄ edge Ï†ïÎ≥¥Î•º Í∞ÄÏßÄÍ≥† ÏûàÎÇò ÌôïÏù∏</p>
<div id="7523218c-0ab8-4845-9fe6-80792d85fb9f" class="cell" data-execution_count="1574">
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a>np.where(data[<span class="dv">0</span>][<span class="dv">1</span>].edge_index <span class="op">!=</span> data[<span class="dv">10</span>][<span class="dv">1</span>].edge_index)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1574">
<pre><code>(array([], dtype=int64), array([], dtype=int64))</code></pre>
</div>
</div>
<hr>
<div id="705448a7-d215-455a-a2cc-05db86f913bf" class="cell" data-execution_count="256">
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.dataset <span class="im">import</span> WindmillOutputSmallDatasetLoader</span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> WindmillOutputSmallDatasetLoader()</span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> loader.get_dataset(lags<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb250-5"><a href="#cb250-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-6"><a href="#cb250-6" aria-hidden="true" tabindex="-1"></a>train_dataset, test_dataset <span class="op">=</span> temporal_signal_split(dataset, train_ratio<span class="op">=</span><span class="fl">0.5</span>)</span></code></pre></div>
</div>
<div id="fdcf2ca8-5aef-4742-b7c9-ccff00008657" class="cell" data-tags="[]" data-execution_count="257">
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>[]</span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a>    data.append([time,snapshot])</span></code></pre></div>
</div>
<div id="419b9bfd-eb07-40ca-9f7f-ff9f89ef2a9e" class="cell" data-execution_count="258">
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">0</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>], (data[<span class="dv">0</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="258">
<pre><code>(tensor([ 0.8199, -0.4972,  0.4923, -0.8299]), tensor(-0.6885))</code></pre>
</div>
</div>
<p><span class="math inline">\(t=0\)</span>ÏóêÏÑú <span class="math inline">\(X\)</span>ÏôÄ <span class="math inline">\(y\)</span>Î•º Ï†ïÎ¶¨ÌïòÎ©¥ ÏïÑÎûòÏôÄ Í∞ôÏùå.</p>
<ul>
<li>X:= <span class="math inline">\(x_0,x_1,x_2,x_3\)</span></li>
<li>y:= <span class="math inline">\(x_4\)</span></li>
</ul>
<div id="4bf64604-ee19-47db-806a-9e2fadd57959" class="cell" data-execution_count="260">
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">1</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>],(data[<span class="dv">1</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="260">
<pre><code>(tensor([-0.4972,  0.4923, -0.8299, -0.6885]), tensor(0.7092))</code></pre>
</div>
</div>
<ul>
<li>X:= <span class="math inline">\(x_1,x_2,x_3,x_4\)</span></li>
<li>y:= <span class="math inline">\(x_5\)</span></li>
</ul>
<div id="317cc694-c337-4006-8a05-04861a996624" class="cell" data-execution_count="261">
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">2</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>],(data[<span class="dv">2</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="261">
<pre><code>(tensor([ 0.4923, -0.8299, -0.6885,  0.7092]), tensor(-0.9356))</code></pre>
</div>
</div>
<ul>
<li>X:=<span class="math inline">\(x_2,x_3,x_4,x_5\)</span></li>
<li>y:=<span class="math inline">\(x_6\)</span></li>
</ul>
<p>ÌïòÎÇòÏùò ÎÖ∏ÎìúÏóê Í∏∏Ïù¥Í∞Ä <span class="math inline">\(T\)</span>Ïù∏ ÏãúÍ≥ÑÏó¥Ïù¥ ÎßµÌïëÎêòÏñ¥ ÏûàÏùå. (ÎÖ∏ÎìúÎäî Ï¥ù 11Í∞ú)</p>
<p>Í∞Å ÎÖ∏ÎìúÎßàÎã§ ÏïÑÎûòÏôÄ Í∞ôÏùÄ Í≥ºÏ†ïÏúºÎ°ú ÏòàÏ∏°Ïù¥ Îê®</p>
<ul>
<li><span class="math inline">\((x_0,x_1,x_2,x_3) \to (x_4)\)</span></li>
<li><span class="math inline">\((x_1,x_2,x_3,x_4) \to (x_5)\)</span></li>
</ul>
<p><span class="math inline">\(f(v,t), v \in \{v_1,\dots,v_{11}\}, t=1,2,\dots,17463\)</span></p>
<p><span class="math display">\[{\bf X}_{t=1} = \begin{bmatrix}
f(v_1,t=1) &amp; f(v_1,t=2) &amp; f(v_1,t=3)&amp;  f(v_1,t=4) \\
f(v_2,t=1) &amp; f(v_2,t=2) &amp; f(v_2,t=3)&amp;  f(v_2,t=4) \\
\dots &amp; \dots  &amp; \dots &amp; \dots  \\
f(v_{20},t=1) &amp; f(v_{20},t=2) &amp; f(v_{20},t=3)&amp;  f(v_{20},t=4)
\end{bmatrix}\]</span></p>
<p><span class="math display">\[{\bf y}_{t=1} = \begin{bmatrix}
f(v_1,t=5) \\
f(v_2,t=5) \\
\dots  \\
f(v_{20},t=5)
\end{bmatrix}\]</span></p>
<section id="learn-5" class="level4">
<h4 class="anchored" data-anchor-id="learn-5">Learn</h4>
<div id="a30ecf77-b59b-4d2b-9aa1-09de3d8c3fb3" class="cell" data-execution_count="174">
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> RecurrentGCN(node_features<span class="op">=</span><span class="dv">4</span>, filters<span class="op">=</span><span class="dv">32</span>)</span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> torch.optim.Adam(model.parameters(), lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a>model.train()</span>
<span id="cb258-6"><a href="#cb258-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-7"><a href="#cb258-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> tqdm(<span class="bu">range</span>(<span class="dv">5</span>)):</span>
<span id="cb258-8"><a href="#cb258-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb258-9"><a href="#cb258-9" aria-hidden="true" tabindex="-1"></a>        y_hat <span class="op">=</span> model(snapshot.x, snapshot.edge_index, snapshot.edge_attr)</span>
<span id="cb258-10"><a href="#cb258-10" aria-hidden="true" tabindex="-1"></a>        cost <span class="op">=</span> torch.mean((y_hat<span class="op">-</span>snapshot.y)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb258-11"><a href="#cb258-11" aria-hidden="true" tabindex="-1"></a>        cost.backward()</span>
<span id="cb258-12"><a href="#cb258-12" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb258-13"><a href="#cb258-13" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 5/5 [02:55&lt;00:00, 35.01s/it]</code></pre>
</div>
</div>
<div id="bbd7579b-709b-48a0-8a7d-bb247a537d5c" class="cell" data-execution_count="175">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>    _x <span class="op">=</span> snapshot.x </span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>    _edge_index <span class="op">=</span> snapshot.edge_index </span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a>    _edge_attr <span class="op">=</span> snapshot.edge_attr</span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a>    _y <span class="op">=</span> snapshot.y</span>
<span id="cb260-6"><a href="#cb260-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span></code></pre></div>
</div>
<div id="3abe7234-01ab-4622-b208-9bdb868c0890" class="cell" data-execution_count="176">
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a>_x.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="176">
<pre><code>torch.Size([11, 4])</code></pre>
</div>
</div>
<div id="46c4138c-c750-4129-9ea5-099e47cb6f3b" class="cell" data-execution_count="177">
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a>_edge_index.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="177">
<pre><code>torch.Size([2, 121])</code></pre>
</div>
</div>
<div id="7a18d3dd-b2a6-487d-a72c-d07b560ba33f" class="cell" data-execution_count="178">
<div class="sourceCode cell-code" id="cb265"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a>_edge_attr.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="178">
<pre><code>torch.Size([121])</code></pre>
</div>
</div>
<div id="ff3aa017-a8ad-4fa2-a192-01ce27307b58" class="cell" data-execution_count="179">
<div class="sourceCode cell-code" id="cb267"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a>_y.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="179">
<pre><code>torch.Size([11])</code></pre>
</div>
</div>
<div id="00c25af9-d518-4d90-92ce-2d28e295d40c" class="cell" data-execution_count="180">
<div class="sourceCode cell-code" id="cb269"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a>_x.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="180">
<pre><code>torch.Size([11, 4])</code></pre>
</div>
</div>
<p>x</p>
<ul>
<li></li>
</ul>
<p>y</p>
<ul>
<li>The target variable allows for regression tasks.</li>
</ul>
<div id="ad7cf98c-69d2-4881-bff5-36e3bc8bb430" class="cell" data-execution_count="181">
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a>_x[<span class="dv">0</span>:<span class="dv">3</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="181">
<pre><code>tensor([[ 0.8199, -0.4972,  0.4923, -0.8299],
        [ 1.1377, -0.3742,  0.3668, -0.8333],
        [ 0.9979, -0.5643,  0.4070, -0.8918]])</code></pre>
</div>
</div>
<div id="b1b19456-64c8-4f62-9585-2577fbde07ba" class="cell" data-execution_count="211">
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a>_y</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="211">
<pre><code>tensor([-0.6885, -0.6594, -0.6303, -0.6983, -0.5416, -0.6186, -0.6031, -0.7580,
        -0.6659, -0.5948, -0.5088])</code></pre>
</div>
</div>
</section>
</section>
<section id="metrladatasetloader_real-world-traffic-dataset" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="metrladatasetloader_real-world-traffic-dataset">METRLADatasetLoader_real world traffic dataset</h2>
<p>A traffic forecasting dataset based on Los Angeles Metropolitan traffic conditions. The dataset contains traffic readings collected from 207 loop detectors on highways in Los Angeles County in aggregated 5 minute intervals for 4 months between March 2012 to June 2012.</p>
<p>Îç∞Ïù¥ÌÑ∞Ï†ïÎ¶¨</p>
<ul>
<li>T = 33</li>
<li>V = Íµ¨Ïó≠</li>
<li>N = 207 # number of nodes</li>
<li>E = 225</li>
<li><span class="math inline">\(f(v,t)\)</span>Ïùò Ï∞®Ïõê? (3,) # Hourly energy output</li>
<li>ÏãúÍ∞ÑÏóê Îî∞ÎùºÏÑú NÏù¥ Î≥ÄÌïòÎäîÏßÄ? False</li>
<li>ÏãúÍ∞ÑÏóê Îî∞ÎùºÏÑú EÍ∞Ä Î≥ÄÌïòÎäîÏßÄ? False</li>
<li>X: (207,4) (N,2,12), <span class="math inline">\(x_0,x_1,x_2,x_3,x_4,x_5,x_6,x_7,x_8,x_9,x_{10},x_{11},z_0,z_1,z_2,z_3,z_4,z_5,z_6,z_7,z_8,z_9,z_{10},z_{11}\)</span></li>
<li>y: (207,) (N,), <span class="math inline">\((x_{12})\)</span></li>
<li>ÏòàÏ†úÏΩîÎìúÏ†ÅÏö©Í∞ÄÎä•Ïó¨Î∂Ä: No</li>
</ul>
<p>https://arxiv.org/pdf/1707.01926.pdf</p>
<p><code>-</code> Nodes : <code>207</code></p>
<ul>
<li>vertices are localities</li>
</ul>
<p><code>-</code>Edges : <code>225</code></p>
<ul>
<li>edges are spatial_connections</li>
</ul>
<p><code>-</code> Time : <code>33</code></p>
<ul>
<li>between 2020 and 2021</li>
<li>per weeks</li>
</ul>
<div id="0f7894e7-cb8b-493a-9150-687532a031f3" class="cell" data-tags="[]" data-execution_count="1575">
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.dataset <span class="im">import</span> METRLADatasetLoader</span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.signal <span class="im">import</span> temporal_signal_split</span>
<span id="cb275-3"><a href="#cb275-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-4"><a href="#cb275-4" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> METRLADatasetLoader()</span>
<span id="cb275-5"><a href="#cb275-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-6"><a href="#cb275-6" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> loader.get_dataset()</span>
<span id="cb275-7"><a href="#cb275-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-8"><a href="#cb275-8" aria-hidden="true" tabindex="-1"></a>train_dataset, test_dataset <span class="op">=</span> temporal_signal_split(dataset, train_ratio<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="a652a649-907e-4c7e-81cc-968685492480" class="cell" data-execution_count="1576">
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>[]</span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a>    data.append([time,snapshot])</span></code></pre></div>
</div>
<div id="b3efa5b2-816e-4c7e-8f8d-cd07b124cb4a" class="cell" data-execution_count="1331">
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a>time</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1331">
<pre><code>34248</code></pre>
</div>
</div>
<div id="8bb2bbac-3728-47ea-b7f9-c9cdd6cb4b02" class="cell" data-execution_count="1332">
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">0</span>][<span class="dv">1</span>]).x.shape,(data[<span class="dv">0</span>][<span class="dv">1</span>]).edge_index.shape,(data[<span class="dv">0</span>][<span class="dv">1</span>]).edge_attr.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1332">
<pre><code>(torch.Size([207, 2, 12]), torch.Size([2, 1722]), torch.Size([1722]))</code></pre>
</div>
</div>
<div id="640e624d-f5e6-4a05-bd5f-afe2e6755867" class="cell" data-execution_count="1334">
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a>data[<span class="op">-</span><span class="dv">1</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1334">
<pre><code>[34248,
 Data(x=[207, 2, 12], edge_index=[2, 1722], edge_attr=[1722], y=[207, 12])]</code></pre>
</div>
</div>
<div id="0b71feb8-05cc-4976-8e55-ffa0b7e25510" class="cell" data-execution_count="1335">
<div class="sourceCode cell-code" id="cb283"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> nx.Graph()</span></code></pre></div>
</div>
<div id="ef6e7b7e-5835-40f7-99a4-673c264010a7" class="cell" data-execution_count="1336">
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a>node_list <span class="op">=</span> torch.tensor(<span class="bu">range</span>(<span class="dv">20</span>)).tolist()</span></code></pre></div>
</div>
<div id="f6794bfa-5597-4bf7-bd38-b53b8a71bcb8" class="cell" data-execution_count="1337">
<div class="sourceCode cell-code" id="cb285"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a>G.add_nodes_from(node_list)</span></code></pre></div>
</div>
<div id="ed3d8b75-15fc-46ae-a5f7-69112bd7be45" class="cell" data-execution_count="1341">
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a>edge_list<span class="op">=</span>[]</span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data[<span class="dv">0</span>][<span class="dv">1</span>].edge_index[<span class="dv">0</span>])):</span>
<span id="cb286-4"><a href="#cb286-4" aria-hidden="true" tabindex="-1"></a>        edge_list.append([data[i][<span class="dv">1</span>].edge_index[<span class="dv">0</span>][j].tolist(),data[i][<span class="dv">1</span>].edge_index[<span class="dv">1</span>][j].tolist()])</span></code></pre></div>
</div>
<div id="2710746d-cb1b-4bc9-9aa1-5c51c1bb33f3" class="cell" data-execution_count="1342">
<div class="sourceCode cell-code" id="cb287"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a>G.add_edges_from(edge_list)</span></code></pre></div>
</div>
<div id="5c73dada-a610-42c6-b185-3498fe7750a6" class="cell" data-execution_count="1343">
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a>G.number_of_nodes(),G.number_of_edges()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1343">
<pre><code>(207, 1520)</code></pre>
</div>
</div>
<div id="c05e373c-7c38-44cb-b5ba-cf96f4b2daf2" class="cell" data-execution_count="1345">
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a>nx.draw(G,with_labels<span class="op">=</span><span class="va">True</span>,font_weight<span class="op">=</span><span class="st">'bold'</span>,node_color<span class="op">=</span><span class="st">'green'</span>,node_size<span class="op">=</span><span class="dv">350</span>,font_color<span class="op">=</span><span class="st">'white'</span>,width<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2022-12-21-ST-GCN_Dataset_files/figure-html/cell-184-output-1.png" class="img-fluid"></p>
</div>
</div>
<hr>
<p>timeÎ≥Ñ Í∞ôÏùÄ edge Ï†ïÎ≥¥Î•º Í∞ÄÏßÄÍ≥† ÏûàÎÇò ÌôïÏù∏</p>
<div id="1ead947a-3a32-46be-8d87-6bfc8040c64f" class="cell" data-execution_count="1577">
<div class="sourceCode cell-code" id="cb291"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a>np.where(data[<span class="dv">0</span>][<span class="dv">1</span>].edge_index <span class="op">!=</span> data[<span class="dv">10</span>][<span class="dv">1</span>].edge_index)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1577">
<pre><code>(array([], dtype=int64), array([], dtype=int64))</code></pre>
</div>
</div>
<hr>
<p>ÎÖºÎ¨∏ ÎÇ¥Ïö© Ï§ë</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="2022-12-21-ST-GCN_Dataset_files/figure-html/37a3da87-4414-4f4a-9e56-e4844a164c58-1-11ce66b1-dc5e-45b1-9309-a4b44c38de95.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption margin-caption">image.png</figcaption>
</figure>
</div>
<div id="79f7e613-ee73-481d-bb93-56ec038bf080" class="cell" data-execution_count="262">
<div class="sourceCode cell-code" id="cb293"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.dataset <span class="im">import</span> METRLADatasetLoader</span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> METRLADatasetLoader()</span>
<span id="cb293-3"><a href="#cb293-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-4"><a href="#cb293-4" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> loader.get_dataset()</span>
<span id="cb293-5"><a href="#cb293-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-6"><a href="#cb293-6" aria-hidden="true" tabindex="-1"></a>train_dataset, test_dataset <span class="op">=</span> temporal_signal_split(dataset, train_ratio<span class="op">=</span><span class="fl">0.5</span>)</span></code></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>lags option ÏóÜÏñ¥ÏÑú error Îú∏</code> : get_dataset() got an unexpected keyword argument ‚Äòlags‚Äô</p>
</div>
</div>
<div id="03d2a13e-cb70-4659-8aa5-37bff5541da8" class="cell" data-tags="[]" data-execution_count="263">
<div class="sourceCode cell-code" id="cb294"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>[]</span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb294-3"><a href="#cb294-3" aria-hidden="true" tabindex="-1"></a>    data.append([time,snapshot])</span></code></pre></div>
</div>
<div id="793a0344-14fd-4956-8a51-bca19d85186b" class="cell" data-execution_count="264">
<div class="sourceCode cell-code" id="cb295"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">0</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>], (data[<span class="dv">0</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="264">
<pre><code>(tensor([[ 0.5332,  0.4486,  0.5146, -2.6522, -2.6522,  0.1847,  0.6383,  0.4961,
           0.7497,  0.4899,  0.5751,  0.4280],
         [-1.7292, -1.7171, -1.7051, -1.6930, -1.6810, -1.6689, -1.6569, -1.6448,
          -1.6328, -1.6207, -1.6087, -1.5966]]),
 tensor([0.3724, 0.2452, 0.4961, 0.6521, 0.1126, 0.5311, 0.5091, 0.4713, 0.4218,
         0.3909, 0.4761, 0.5641]))</code></pre>
</div>
</div>
<p><span class="math inline">\(t=0\)</span>ÏóêÏÑú <span class="math inline">\(X,Z\)</span>ÏôÄ <span class="math inline">\(y\)</span>Î•º Ï†ïÎ¶¨ÌïòÎ©¥ ÏïÑÎûòÏôÄ Í∞ôÏùå.</p>
<ul>
<li>X:= <span class="math inline">\(x_0,x_1,x_2,x_3,x_4,x_5,x_6,x_7,x_8,x_9,x_{10},x_{11}\)</span></li>
<li>Z:= <span class="math inline">\(z_0,z_1,z_2,z_3,z_4,z_5,z_6,z_7,z_8,z_9,z_{10},z_{11}\)</span></li>
<li>y:= <span class="math inline">\(x_{12}\)</span></li>
</ul>
<div id="0abe11a4-0770-4b45-8198-840b1bddea0d" class="cell" data-execution_count="266">
<div class="sourceCode cell-code" id="cb297"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">1</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>],(data[<span class="dv">1</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="266">
<pre><code>(tensor([[ 0.4486,  0.5146, -2.6522, -2.6522,  0.1847,  0.6383,  0.4961,  0.7497,
           0.4899,  0.5751,  0.4280,  0.3724],
         [-1.7171, -1.7051, -1.6930, -1.6810, -1.6689, -1.6569, -1.6448, -1.6328,
          -1.6207, -1.6087, -1.5966, -1.5846]]),
 tensor([ 0.2452,  0.4961,  0.6521,  0.1126,  0.5311,  0.5091,  0.4713,  0.4218,
          0.3909,  0.4761,  0.5641, -0.0022]))</code></pre>
</div>
</div>
<ul>
<li>X:= <span class="math inline">\(x_1,x_2,x_3,x_4,x_5,x_6,x_7,x_8,x_9,x_{10},x_{11},x_{12}\)</span></li>
<li>Z:= <span class="math inline">\(z_1,z_2,z_3,z_4,z_5,z_6,z_7,z_8,z_9,z_{10},z_{11},z_{12}\)</span></li>
<li>y:= <span class="math inline">\(x_{13}\)</span></li>
</ul>
<div id="c3882440-1c22-47f1-b16a-9bc8edba994f" class="cell" data-execution_count="267">
<div class="sourceCode cell-code" id="cb299"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">2</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>],(data[<span class="dv">2</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="267">
<pre><code>(tensor([[ 0.5146, -2.6522, -2.6522,  0.1847,  0.6383,  0.4961,  0.7497,  0.4899,
           0.5751,  0.4280,  0.3724,  0.2452],
         [-1.7051, -1.6930, -1.6810, -1.6689, -1.6569, -1.6448, -1.6328, -1.6207,
          -1.6087, -1.5966, -1.5846, -1.5725]]),
 tensor([ 0.4961,  0.6521,  0.1126,  0.5311,  0.5091,  0.4713,  0.4218,  0.3909,
          0.4761,  0.5641, -0.0022,  0.4218]))</code></pre>
</div>
</div>
<ul>
<li>X:= <span class="math inline">\(x_2,x_3,x_4,x_5,x_6,x_7,x_8,x_9,x_{10},x_{11},x_{12},x_{13}\)</span></li>
<li>Z:= <span class="math inline">\(z_2,z_3,z_4,z_5,z_6,z_7,z_8,z_9,z_{10},z_{11},z_{12},z_{13}\)</span></li>
<li>y:= <span class="math inline">\(x_{14}\)</span></li>
</ul>
<p>ÌïòÎÇòÏùò ÎÖ∏ÎìúÏóê Í∏∏Ïù¥Í∞Ä <span class="math inline">\(T\)</span>Ïù∏ ÏãúÍ≥ÑÏó¥Ïù¥ ÎßµÌïëÎêòÏñ¥ ÏûàÏùå. (ÎÖ∏ÎìúÎäî Ï¥ù 207Í∞ú)</p>
<p>Í∞Å ÎÖ∏ÎìúÎßàÎã§ ÏïÑÎûòÏôÄ Í∞ôÏùÄ Í≥ºÏ†ïÏúºÎ°ú ÏòàÏ∏°Ïù¥ Îê®</p>
<ul>
<li><span class="math inline">\(x_0,x_1,x_2,x_3,x_4,x_5,x_6,x_7,x_8,x_9,x_{10},x_{11},z_0,z_1,z_2,z_3,z_4,z_5,z_6,z_7,z_8,z_9,z_{10},z_{11} \to (x_{12})\)</span></li>
<li><span class="math inline">\(x_1,x_2,x_3,x_4,x_5,x_6,x_7,x_8,x_9,x_{10},x_{11},x_{12},z_1,z_2,z_3,z_4,z_5,z_6,z_7,z_8,z_9,z_{10},z_{11},z_{12} \to (x_{13})\)</span></li>
</ul>
<p><span class="math inline">\(f(v,t), v \in \{v_1,\dots,v_{207}\}, t=1,2,\dots,34248\)</span></p>
<p><span class="math display">\[{\bf X}_{t=1} = \begin{bmatrix}
f(v_1,t=1) &amp; f(v_1,t=2) &amp; f(v_1,t=3)&amp;  f(v_1,t=4) \\
f(v_2,t=1) &amp; f(v_2,t=2) &amp; f(v_2,t=3)&amp;  f(v_2,t=4) \\
\dots &amp; \dots  &amp; \dots &amp; \dots  \\
f(v_{20},t=1) &amp; f(v_{20},t=2) &amp; f(v_{20},t=3)&amp;  f(v_{20},t=4)
\end{bmatrix}\]</span></p>
<p><span class="math display">\[{\bf y}_{t=1} = \begin{bmatrix}
f(v_1,t=5) \\
f(v_2,t=5) \\
\dots  \\
f(v_{20},t=5)
\end{bmatrix}\]</span></p>
<section id="learn-6" class="level4">
<h4 class="anchored" data-anchor-id="learn-6">Learn</h4>
<div id="30819e5f-4303-4d18-9aec-511a01a8fd90" class="cell">
<div class="sourceCode cell-code" id="cb301"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> RecurrentGCN(node_features<span class="op">=</span><span class="dv">1</span>, filters<span class="op">=</span><span class="dv">32</span>)</span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-3"><a href="#cb301-3" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> torch.optim.Adam(model.parameters(), lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb301-4"><a href="#cb301-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-5"><a href="#cb301-5" aria-hidden="true" tabindex="-1"></a>model.train()</span>
<span id="cb301-6"><a href="#cb301-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-7"><a href="#cb301-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> tqdm(<span class="bu">range</span>(<span class="dv">50</span>)):</span>
<span id="cb301-8"><a href="#cb301-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb301-9"><a href="#cb301-9" aria-hidden="true" tabindex="-1"></a>        y_hat <span class="op">=</span> model(snapshot.x, snapshot.edge_index, snapshot.edge_attr)</span>
<span id="cb301-10"><a href="#cb301-10" aria-hidden="true" tabindex="-1"></a>        cost <span class="op">=</span> torch.mean((y_hat<span class="op">-</span>snapshot.y)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb301-11"><a href="#cb301-11" aria-hidden="true" tabindex="-1"></a>        cost.backward()</span>
<span id="cb301-12"><a href="#cb301-12" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb301-13"><a href="#cb301-13" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span></code></pre></div>
</div>
<div id="03d2215e-9252-4efe-a0e4-e36bc1804ca7" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a>    _x <span class="op">=</span> snapshot.x </span>
<span id="cb302-3"><a href="#cb302-3" aria-hidden="true" tabindex="-1"></a>    _edge_index <span class="op">=</span> snapshot.edge_index </span>
<span id="cb302-4"><a href="#cb302-4" aria-hidden="true" tabindex="-1"></a>    _edge_attr <span class="op">=</span> snapshot.edge_attr</span>
<span id="cb302-5"><a href="#cb302-5" aria-hidden="true" tabindex="-1"></a>    _y <span class="op">=</span> snapshot.y</span>
<span id="cb302-6"><a href="#cb302-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span></code></pre></div>
</div>
<div id="6930be35-a1ea-416b-9079-3d7bb2cabb8e" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb303"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true" tabindex="-1"></a>_x.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>torch.Size([207, 2, 12])</code></pre>
</div>
</div>
<ul>
<li>node 207Í∞ú, traffic sensor 2Í∞ú</li>
</ul>
<div id="24cea284-ed34-42d7-aa0a-6220a735606e" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb305"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a>_edge_index.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>torch.Size([2, 1722])</code></pre>
</div>
</div>
<div id="a37e38dd-9fe7-4da9-b828-de6a973b82f6" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb307"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a>_edge_attr.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>torch.Size([1722])</code></pre>
</div>
</div>
<div id="0695fc91-89fe-426b-bc4a-4c884b129c4e" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb309"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a>_y.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>torch.Size([207, 12])</code></pre>
</div>
</div>
<div id="77192f92-38b3-4e0b-a355-622685a041f3" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb311"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a>_x.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>torch.Size([207, 2, 12])</code></pre>
</div>
</div>
<p>y</p>
<ul>
<li>traffic speed</li>
</ul>
<div id="5c8117c9-9be1-400d-850d-7e9e640d2500" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb313"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a>_x[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>tensor([[ 0.5332,  0.4486,  0.5146, -2.6522, -2.6522,  0.1847,  0.6383,  0.4961,
          0.7497,  0.4899,  0.5751,  0.4280],
        [-1.7292, -1.7171, -1.7051, -1.6930, -1.6810, -1.6689, -1.6569, -1.6448,
         -1.6328, -1.6207, -1.6087, -1.5966]])</code></pre>
</div>
</div>
<div id="2929102d-e5d4-43c7-a877-861ee1e712aa" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb315"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a>_y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<pre><code>tensor([0.3724, 0.2452, 0.4961, 0.6521, 0.1126, 0.5311, 0.5091, 0.4713, 0.4218,
        0.3909, 0.4761, 0.5641])</code></pre>
</div>
</div>
</section>
</section>
<section id="pemsbaydatasetloader" class="level2">
<h2 class="anchored" data-anchor-id="pemsbaydatasetloader">PemsBayDatasetLoader</h2>
<p>https://onlinelibrary.wiley.com/doi/pdf/10.1111/tgis.12644</p>
<p>A traffic forecasting dataset as described in Diffusion Convolution Layer Paper.</p>
<p>This traffic dataset is collected by California Transportation Agencies (CalTrans) Performance Measurement System (PeMS). It is represented by a network of 325 traffic sensors in the Bay Area with 6 months of traffic readings ranging from Jan 1st 2017 to May 31th 2017 in 5 minute intervals.</p>
<p>Îç∞Ïù¥ÌÑ∞Ï†ïÎ¶¨</p>
<ul>
<li>T = 17470</li>
<li>V = ÌíçÎ†•Î∞úÏ†ÑÏÜå</li>
<li>N = 325 # number of nodes</li>
<li>E = 101761 = N^2 # edges</li>
<li><span class="math inline">\(f(v,t)\)</span>Ïùò Ï∞®Ïõê? (1,) # Hourly energy output</li>
<li>ÏãúÍ∞ÑÏóê Îî∞ÎùºÏÑú NÏù¥ Î≥ÄÌïòÎäîÏßÄ? False</li>
<li>ÏãúÍ∞ÑÏóê Îî∞ÎùºÏÑú EÍ∞Ä Î≥ÄÌïòÎäîÏßÄ? False</li>
<li>X: (325,2,12) (N,2,12),
<ul>
<li><span class="math inline">\(x_0,x_1,x_2,x_3,x_4,x_5,x_6,x_7,x_8,x_9,x_{10},x_{11}\)</span></li>
<li><span class="math inline">\(z_0,z_1,z_2,z_3,z_4,z_5,z_6,z_7,z_8,z_9,z_{10},z_{11}\)</span></li>
</ul></li>
<li>y: (325,) (N,2,12),
<ul>
<li><span class="math inline">\(x_{13},x_{14},x_{15},x_{16},x_{17},x_{18},x_{19},x_{20},x_{21},x_{22},x_{23},x_{24}\)</span></li>
<li><span class="math inline">\(z_{13},z_{14},z_{15},z_{16},z_{17},z_{18},z_{19},z_{20},z_{21},z_{22},z_{23},z_{24}\)</span></li>
</ul></li>
<li>ÏòàÏ†úÏΩîÎìúÏ†ÅÏö©Í∞ÄÎä•Ïó¨Î∂Ä: No</li>
</ul>
<p><code>-</code> Nodes : <code>325</code></p>
<ul>
<li>vertices are sensors</li>
</ul>
<p><code>-</code>Edges : <code>2694</code></p>
<ul>
<li>weighted edges are between seonsor paris measured by the road nretwork distance</li>
</ul>
<p><code>-</code> Time : <code>52081</code></p>
<ul>
<li>6 months of traffic readings ranging from Jan 1st 2017 to May 31th 2017 in 5 minute intervals</li>
</ul>
<div id="dfebd554-0aac-4daa-86df-b09ae31ff541" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb317"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.dataset <span class="im">import</span> PemsBayDatasetLoader</span>
<span id="cb317-2"><a href="#cb317-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.signal <span class="im">import</span> temporal_signal_split</span>
<span id="cb317-3"><a href="#cb317-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-4"><a href="#cb317-4" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> PemsBayDatasetLoader()</span>
<span id="cb317-5"><a href="#cb317-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-6"><a href="#cb317-6" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> loader.get_dataset()</span>
<span id="cb317-7"><a href="#cb317-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-8"><a href="#cb317-8" aria-hidden="true" tabindex="-1"></a>train_dataset, test_dataset <span class="op">=</span> temporal_signal_split(dataset, train_ratio<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="9cc73813-a7a5-4599-8935-bd3561a833f3" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb318"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>[]</span>
<span id="cb318-2"><a href="#cb318-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb318-3"><a href="#cb318-3" aria-hidden="true" tabindex="-1"></a>    data.append([time,snapshot])</span></code></pre></div>
</div>
<div id="1abae4cd-a23f-46d2-a799-a20ca776c9ec" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb319"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true" tabindex="-1"></a>time</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>52081</code></pre>
</div>
</div>
<div id="e4cbd91d-0a31-44a4-80eb-a78ad1ef0d77" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb321"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">0</span>][<span class="dv">1</span>]).x.shape,(data[<span class="dv">0</span>][<span class="dv">1</span>]).edge_index.shape,(data[<span class="dv">0</span>][<span class="dv">1</span>]).edge_attr.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>(torch.Size([325, 2, 12]), torch.Size([2, 2694]), torch.Size([2694]))</code></pre>
</div>
</div>
<div id="73bc848a-7ba0-4495-9d57-8e9f14ad086e" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb323"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> nx.Graph()</span></code></pre></div>
</div>
<div id="d1b3c59d-ce84-496e-8275-119bba16cd25" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb324"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a>node_list <span class="op">=</span> torch.tensor(<span class="bu">range</span>(<span class="dv">325</span>)).tolist()</span></code></pre></div>
</div>
<div id="4622d304-5e38-42ef-a813-f52e4d9ece03" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb325"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a>data[<span class="op">-</span><span class="dv">1</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>[52081,
 Data(x=[325, 2, 12], edge_index=[2, 2694], edge_attr=[2694], y=[325, 2, 12])]</code></pre>
</div>
</div>
<div id="1399196d-4ae5-4eee-9697-5dc18530943a" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb327"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a>G.add_nodes_from(node_list)</span></code></pre></div>
</div>
<div id="62f804d9-3861-4f4a-ae44-d1c7d913fcec" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb328"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a>edge_list<span class="op">=</span>[]</span>
<span id="cb328-2"><a href="#cb328-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb328-3"><a href="#cb328-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data[<span class="dv">0</span>][<span class="dv">1</span>].edge_index[<span class="dv">0</span>])):</span>
<span id="cb328-4"><a href="#cb328-4" aria-hidden="true" tabindex="-1"></a>        edge_list.append([data[i][<span class="dv">1</span>].edge_index[<span class="dv">0</span>][j].tolist(),data[i][<span class="dv">1</span>].edge_index[<span class="dv">1</span>][j].tolist()])</span></code></pre></div>
</div>
<div id="41b51a23-e4cd-4e3e-9e67-752020f1f7dd" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb329"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a>G.add_edges_from(edge_list)</span></code></pre></div>
</div>
<div id="c6358cd1-21c1-458d-970e-5fb6e64bc3ca" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb330"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a>G.number_of_nodes(),G.number_of_edges()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>(325, 2404)</code></pre>
</div>
</div>
<div id="31b83dff-6210-4f90-a1d1-f8d54457d531" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb332"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a>nx.draw(G,node_color<span class="op">=</span><span class="st">'green'</span>,node_size<span class="op">=</span><span class="dv">50</span>,font_color<span class="op">=</span><span class="st">'white'</span>,width<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2022-12-21-ST-GCN_Dataset_files/figure-html/cell-211-output-1.png" class="img-fluid"></p>
</div>
</div>
<hr>
<p>timeÎ≥Ñ Í∞ôÏùÄ edge Ï†ïÎ≥¥Î•º Í∞ÄÏßÄÍ≥† ÏûàÎÇò ÌôïÏù∏</p>
<div id="c85393ab-4514-49e6-a970-3ec76e8cfaf5" class="cell" data-execution_count="1580">
<div class="sourceCode cell-code" id="cb333"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a>np.where(data[<span class="dv">0</span>][<span class="dv">1</span>].edge_index <span class="op">!=</span> data[<span class="dv">10</span>][<span class="dv">1</span>].edge_index)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1580">
<pre><code>(array([], dtype=int64), array([], dtype=int64))</code></pre>
</div>
</div>
<hr>
<div id="01e927f4-d63f-4c75-93d9-c12bfcf404a3" class="cell" data-execution_count="268">
<div class="sourceCode cell-code" id="cb335"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.dataset <span class="im">import</span> PemsBayDatasetLoader</span>
<span id="cb335-2"><a href="#cb335-2" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> PemsBayDatasetLoader()</span>
<span id="cb335-3"><a href="#cb335-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb335-4"><a href="#cb335-4" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> loader.get_dataset()</span>
<span id="cb335-5"><a href="#cb335-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb335-6"><a href="#cb335-6" aria-hidden="true" tabindex="-1"></a>train_dataset, test_dataset <span class="op">=</span> temporal_signal_split(dataset, train_ratio<span class="op">=</span><span class="fl">0.5</span>)</span></code></pre></div>
</div>
<div id="c5530c08-b2a2-4081-afa4-b236afa0b95b" class="cell" data-tags="[]" data-execution_count="269">
<div class="sourceCode cell-code" id="cb336"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>[]</span>
<span id="cb336-2"><a href="#cb336-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb336-3"><a href="#cb336-3" aria-hidden="true" tabindex="-1"></a>    data.append([time,snapshot])</span></code></pre></div>
</div>
<div id="fd039bb6-f7e1-4083-89c0-142255c82102" class="cell" data-execution_count="270">
<div class="sourceCode cell-code" id="cb337"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">0</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>], (data[<span class="dv">0</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="270">
<pre><code>(tensor([[ 0.9821,  0.9928,  1.0251,  1.0574,  1.0466,  1.0681,  0.9821,  1.0251,
           1.0143,  0.9928,  0.9498,  0.9821],
         [-1.6127, -1.6005, -1.5883, -1.5762, -1.5640, -1.5518, -1.5397, -1.5275,
          -1.5153, -1.5032, -1.4910, -1.4788]]),
 tensor([[ 1.0143,  0.9821,  0.9821,  1.0036,  1.0143,  0.9605,  0.9498,  1.0251,
           0.9928,  0.9928,  0.9498,  0.9928],
         [-1.4667, -1.4545, -1.4423, -1.4302, -1.4180, -1.4058, -1.3937, -1.3815,
          -1.3694, -1.3572, -1.3450, -1.3329]]))</code></pre>
</div>
</div>
<p><span class="math inline">\(t=0\)</span>ÏóêÏÑú <span class="math inline">\(X,Z\)</span>ÏôÄ <span class="math inline">\(y,s\)</span>Î•º Ï†ïÎ¶¨ÌïòÎ©¥ ÏïÑÎûòÏôÄ Í∞ôÏùå.</p>
<ul>
<li>X:= <span class="math inline">\(x_0,x_1,x_2,x_3,x_4,x_5,x_6,x_7,x_8,x_9,x_{10},x_{11}\)</span></li>
<li>Z:= <span class="math inline">\(z_0,z_1,z_2,z_3,z_4,z_5,z_6,z_7,z_8,z_9,z_{10},z_{11}\)</span></li>
<li>y:= <span class="math inline">\(x_{12},x_{13},x_{14},x_{15},x_{16},x_{17},x_{18},x_{19},x_{20},x_{21},x_{22},x_{23}\)</span></li>
<li>s:= <span class="math inline">\(z_{12},z_{13},z_{14},z_{15},z_{16},z_{17},z_{18},z_{19},z_{20},z_{21},z_{22},z_{23}\)</span></li>
</ul>
<div id="88f90480-c65a-4e2b-981f-35a73e92d729" class="cell" data-execution_count="272">
<div class="sourceCode cell-code" id="cb339"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">1</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>],(data[<span class="dv">1</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="272">
<pre><code>(tensor([[ 0.9928,  1.0251,  1.0574,  1.0466,  1.0681,  0.9821,  1.0251,  1.0143,
           0.9928,  0.9498,  0.9821,  1.0143],
         [-1.6005, -1.5883, -1.5762, -1.5640, -1.5518, -1.5397, -1.5275, -1.5153,
          -1.5032, -1.4910, -1.4788, -1.4667]]),
 tensor([[ 0.9821,  0.9821,  1.0036,  1.0143,  0.9605,  0.9498,  1.0251,  0.9928,
           0.9928,  0.9498,  0.9928,  0.9821],
         [-1.4545, -1.4423, -1.4302, -1.4180, -1.4058, -1.3937, -1.3815, -1.3694,
          -1.3572, -1.3450, -1.3329, -1.3207]]))</code></pre>
</div>
</div>
<ul>
<li>X:= <span class="math inline">\(x_1,x_2,x_3,x_4,x_5,x_6,x_7,x_8,x_9,x_{10},x_{11},x_{12}\)</span></li>
<li>Z:= <span class="math inline">\(z_1,z_2,z_3,z_4,z_5,z_6,z_7,z_8,z_9,z_{10},z_{11},z_{12}\)</span></li>
<li>y:= <span class="math inline">\(x_{13},x_{14},x_{15},x_{16},x_{17},x_{18},x_{19},x_{20},x_{21},x_{22},x_{23},x_{24}\)</span></li>
<li>s:= <span class="math inline">\(z_{13},z_{14},z_{15},z_{16},z_{17},z_{18},z_{19},z_{20},z_{21},z_{22},z_{23},z_{24}\)</span></li>
</ul>
<div id="6b9a73e5-8384-44d9-b616-cfade81991d6" class="cell" data-execution_count="273">
<div class="sourceCode cell-code" id="cb341"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb341-1"><a href="#cb341-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">2</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>],(data[<span class="dv">2</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="273">
<pre><code>(tensor([[ 1.0251,  1.0574,  1.0466,  1.0681,  0.9821,  1.0251,  1.0143,  0.9928,
           0.9498,  0.9821,  1.0143,  0.9821],
         [-1.5883, -1.5762, -1.5640, -1.5518, -1.5397, -1.5275, -1.5153, -1.5032,
          -1.4910, -1.4788, -1.4667, -1.4545]]),
 tensor([[ 0.9821,  1.0036,  1.0143,  0.9605,  0.9498,  1.0251,  0.9928,  0.9928,
           0.9498,  0.9928,  0.9821,  1.0143],
         [-1.4423, -1.4302, -1.4180, -1.4058, -1.3937, -1.3815, -1.3694, -1.3572,
          -1.3450, -1.3329, -1.3207, -1.3085]]))</code></pre>
</div>
</div>
<ul>
<li>X:= <span class="math inline">\(x_2,x_3,x_4,x_5,x_6,x_7,x_8,x_9,x_{10},x_{11},x_{12},x_{13}\)</span></li>
<li>Z:= <span class="math inline">\(z_2,z_3,z_4,z_5,z_6,z_7,z_8,z_9,z_{10},z_{11},z_{12},z_{13}\)</span></li>
<li>y:= <span class="math inline">\(x_{14},x_{15},x_{16},x_{17},x_{18},x_{19},x_{20},x_{21},x_{22},x_{23},x_{24},x_{25}\)</span></li>
<li>s:= <span class="math inline">\(z_{14},z_{15},z_{16},z_{17},z_{18},z_{19},z_{20},z_{21},z_{22},z_{23},z_{24},z_{25}\)</span></li>
</ul>
<p>ÌïòÎÇòÏùò ÎÖ∏ÎìúÏóê Í∏∏Ïù¥Í∞Ä <span class="math inline">\(T\)</span>Ïù∏ ÏãúÍ≥ÑÏó¥Ïù¥ ÎßµÌïëÎêòÏñ¥ ÏûàÏùå. (ÎÖ∏ÎìúÎäî Ï¥ù 325Í∞ú)</p>
<p>Í∞Å ÎÖ∏ÎìúÎßàÎã§ ÏïÑÎûòÏôÄ Í∞ôÏùÄ Í≥ºÏ†ïÏúºÎ°ú ÏòàÏ∏°Ïù¥ Îê®</p>
<ul>
<li><span class="math inline">\(x_0,x_1,x_2,x_3,x_4,x_5,x_6,x_7,x_8,x_9,x_{10},x_{11} \to x_{12},x_{13},x_{14},x_{15},x_{16},x_{17},x_{18},x_{19},x_{20},x_{21},x_{22},x_{23}\)</span></li>
<li><span class="math inline">\(z_0,z_1,z_2,z_3,z_4,z_5,z_6,z_7,z_8,z_9,z_{10},z_{11} \to z_{12},z_{13},z_{14},z_{15},z_{16},z_{17},z_{18},z_{19},z_{20},z_{21},z_{22},z_{23}\)</span></li>
<li><span class="math inline">\(x_1,x_2,x_3,x_4,x_5,x_6,x_7,x_8,x_9,x_{10},x_{11},x_{12} \to x_{13},x_{14},x_{15},x_{16},x_{17},x_{18},x_{19},x_{20},x_{21},x_{22},x_{23},x_{24}\)</span></li>
<li><span class="math inline">\(z_1,z_2,z_3,z_4,z_5,z_6,z_7,z_8,z_9,z_{10},z_{11},z_{12} \to z_{13},z_{14},z_{15},z_{16},z_{17},z_{18},z_{19},z_{20},z_{21},z_{22},z_{23},z_{24}\)</span></li>
</ul>
<p><span class="math inline">\(f(v,t), v \in \{v_1,\dots,v_{325}\}, t=1,2,\dots,52081\)</span></p>
<p><span class="math display">\[{\bf X}_{t=1} = \begin{bmatrix}
f(v_1,t=1) &amp; f(v_1,t=2) &amp; f(v_1,t=3)&amp;  f(v_1,t=4) \\
f(v_2,t=1) &amp; f(v_2,t=2) &amp; f(v_2,t=3)&amp;  f(v_2,t=4) \\
\dots &amp; \dots  &amp; \dots &amp; \dots  \\
f(v_{20},t=1) &amp; f(v_{20},t=2) &amp; f(v_{20},t=3)&amp;  f(v_{20},t=4)
\end{bmatrix}\]</span></p>
<p><span class="math display">\[{\bf y}_{t=1} = \begin{bmatrix}
f(v_1,t=5) \\
f(v_2,t=5) \\
\dots  \\
f(v_{20},t=5)
\end{bmatrix}\]</span></p>
<section id="learn-7" class="level4">
<h4 class="anchored" data-anchor-id="learn-7">Learn</h4>
<div id="6d181941-40ed-4055-9747-ac865d0d4fdc" class="cell">
<div class="sourceCode cell-code" id="cb343"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> RecurrentGCN(node_features<span class="op">=</span><span class="dv">4</span>, filters<span class="op">=</span><span class="dv">32</span>)</span>
<span id="cb343-2"><a href="#cb343-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-3"><a href="#cb343-3" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> torch.optim.Adam(model.parameters(), lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb343-4"><a href="#cb343-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-5"><a href="#cb343-5" aria-hidden="true" tabindex="-1"></a>model.train()</span>
<span id="cb343-6"><a href="#cb343-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-7"><a href="#cb343-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> tqdm(<span class="bu">range</span>(<span class="dv">50</span>)):</span>
<span id="cb343-8"><a href="#cb343-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb343-9"><a href="#cb343-9" aria-hidden="true" tabindex="-1"></a>        y_hat <span class="op">=</span> model(snapshot.x, snapshot.edge_index, snapshot.edge_attr)</span>
<span id="cb343-10"><a href="#cb343-10" aria-hidden="true" tabindex="-1"></a>        cost <span class="op">=</span> torch.mean((y_hat<span class="op">-</span>snapshot.y)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb343-11"><a href="#cb343-11" aria-hidden="true" tabindex="-1"></a>        cost.backward()</span>
<span id="cb343-12"><a href="#cb343-12" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb343-13"><a href="#cb343-13" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span></code></pre></div>
</div>
<div id="15a7b717-44ab-4c39-82d3-0cbc623a921f" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb344"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb344-2"><a href="#cb344-2" aria-hidden="true" tabindex="-1"></a>    _x <span class="op">=</span> snapshot.x </span>
<span id="cb344-3"><a href="#cb344-3" aria-hidden="true" tabindex="-1"></a>    _edge_index <span class="op">=</span> snapshot.edge_index </span>
<span id="cb344-4"><a href="#cb344-4" aria-hidden="true" tabindex="-1"></a>    _edge_attr <span class="op">=</span> snapshot.edge_attr</span>
<span id="cb344-5"><a href="#cb344-5" aria-hidden="true" tabindex="-1"></a>    _y <span class="op">=</span> snapshot.y</span>
<span id="cb344-6"><a href="#cb344-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span></code></pre></div>
</div>
<div id="cbc52cd4-b84d-4d02-8085-f276e7343196" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb345"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true" tabindex="-1"></a>_x.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<pre><code>torch.Size([325, 2, 12])</code></pre>
</div>
</div>
<div id="451b8bdc-b156-409f-85c9-af9b8aa861e6" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb347"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb347-1"><a href="#cb347-1" aria-hidden="true" tabindex="-1"></a>_edge_index.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>torch.Size([2, 2694])</code></pre>
</div>
</div>
<div id="246cd945-c8cc-434f-8c29-967027c88609" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb349"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb349-1"><a href="#cb349-1" aria-hidden="true" tabindex="-1"></a>_edge_attr.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<pre><code>torch.Size([2694])</code></pre>
</div>
</div>
<div id="b0b57b6a-e6b6-4afe-b629-5858303fec21" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb351"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb351-1"><a href="#cb351-1" aria-hidden="true" tabindex="-1"></a>_y.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<pre><code>torch.Size([325, 2, 12])</code></pre>
</div>
</div>
<div id="d2451710-9d95-49df-8be2-dd57228c88dc" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb353"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a>_x.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="65">
<pre><code>torch.Size([325, 2, 12])</code></pre>
</div>
</div>
<p>x</p>
<ul>
<li>.!</li>
</ul>
<p>y</p>
<ul>
<li>capturing temporal dependencies..?</li>
</ul>
<p>edges connect sensors</p>
<p>For instance, the traffic conditions on one road on Wednesday at 3:00 p.m. are similar to the traffic conditions on Thursday at the same time.</p>
<div id="18a9a8bc-9f62-4296-9df2-cd9f21d1c788" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb355"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true" tabindex="-1"></a>_x[<span class="dv">0</span>:<span class="dv">3</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="66">
<pre><code>tensor([[[ 0.9821,  0.9928,  1.0251,  1.0574,  1.0466,  1.0681,  0.9821,
           1.0251,  1.0143,  0.9928,  0.9498,  0.9821],
         [-1.6127, -1.6005, -1.5883, -1.5762, -1.5640, -1.5518, -1.5397,
          -1.5275, -1.5153, -1.5032, -1.4910, -1.4788]],

        [[ 0.6054,  0.5839,  0.6592,  0.6269,  0.6808,  0.6377,  0.6700,
           0.6054,  0.6162,  0.6162,  0.5839,  0.5947],
         [-1.6127, -1.6005, -1.5883, -1.5762, -1.5640, -1.5518, -1.5397,
          -1.5275, -1.5153, -1.5032, -1.4910, -1.4788]],

        [[ 0.9390,  0.9175,  0.8960,  0.9175,  0.9067,  0.9175,  0.9175,
           0.8852,  0.9283,  0.8960,  0.9067,  0.8960],
         [-1.6127, -1.6005, -1.5883, -1.5762, -1.5640, -1.5518, -1.5397,
          -1.5275, -1.5153, -1.5032, -1.4910, -1.4788]]])</code></pre>
</div>
</div>
<div id="675e2f37-b0b8-435f-b143-92aadb75da79" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb357"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb357-1"><a href="#cb357-1" aria-hidden="true" tabindex="-1"></a>_y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="68">
<pre><code>tensor([[ 1.0143,  0.9821,  0.9821,  1.0036,  1.0143,  0.9605,  0.9498,  1.0251,
          0.9928,  0.9928,  0.9498,  0.9928],
        [-1.4667, -1.4545, -1.4423, -1.4302, -1.4180, -1.4058, -1.3937, -1.3815,
         -1.3694, -1.3572, -1.3450, -1.3329]])</code></pre>
</div>
</div>
</section>
</section>
<section id="englandcoviddatasetloader" class="level2">
<h2 class="anchored" data-anchor-id="englandcoviddatasetloader">EnglandCovidDatasetLoader</h2>
<p>Covid19 England</p>
<ul>
<li>A dataset about mass mobility between regions in England and the number of confirmed COVID-19 cases from March to May 2020 [38]. Each day contains a different mobility graph and node features corresponding to the number of cases in the previous days. Mobility stems from Facebook Data For Good 1 and cases from gov.uk 2</li>
</ul>
<p>https://arxiv.org/pdf/2009.08388.pdf</p>
<p>Îç∞Ïù¥ÌÑ∞Ï†ïÎ¶¨</p>
<ul>
<li>T = 52</li>
<li>V = ÏßÄÏó≠</li>
<li>N = 129 # number of nodes</li>
<li>E = 2158</li>
<li><span class="math inline">\(f(v,t)\)</span>Ïùò Ï∞®Ïõê? (1,) # ÏΩîÎ°úÎÇòÌôïÏßÑÏûêÏàò</li>
<li>ÏãúÍ∞ÑÏóê Îî∞ÎùºÏÑú Number of nodesÍ∞Ä Î≥ÄÌïòÎäîÏßÄ? False</li>
<li>ÏãúÍ∞ÑÏóê Îî∞ÎùºÏÑú Number of nodesÍ∞Ä Î≥ÄÌïòÎäîÏßÄ? False</li>
<li>X: (20,4) (N,4), <span class="math inline">\(f(v,t_0),f(v,t_1),f(v,t_2),f(v,t_3)\)</span></li>
<li>y: (20,) (N,), <span class="math inline">\(f(v,t_4)\)</span></li>
<li>ÏòàÏ†úÏΩîÎìúÏ†ÅÏö©Í∞ÄÎä•Ïó¨Î∂Ä: Yes</li>
</ul>
<p><code>-</code> Nodes : <code>129</code></p>
<ul>
<li>vertices are correspond to the number of COVID-19 cases in the region in the past window days.</li>
</ul>
<p><code>-</code>Edges : <code>2158</code></p>
<ul>
<li>the spatial edges capture county-to-county movement at a specific date, and a county is connected to a number of past instances of itself with temporal edges.</li>
</ul>
<p><code>-</code> Time : <code>52</code></p>
<ul>
<li>from 3 March to 12 of May</li>
</ul>
<div id="ef24b09c-6bd8-4f9e-977b-7ab709359e02" class="cell" data-execution_count="1581">
<div class="sourceCode cell-code" id="cb359"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb359-1"><a href="#cb359-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.dataset <span class="im">import</span> EnglandCovidDatasetLoader</span>
<span id="cb359-2"><a href="#cb359-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.signal <span class="im">import</span> temporal_signal_split</span>
<span id="cb359-3"><a href="#cb359-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-4"><a href="#cb359-4" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> EnglandCovidDatasetLoader()</span>
<span id="cb359-5"><a href="#cb359-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-6"><a href="#cb359-6" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> loader.get_dataset()</span>
<span id="cb359-7"><a href="#cb359-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-8"><a href="#cb359-8" aria-hidden="true" tabindex="-1"></a>train_dataset, test_dataset <span class="op">=</span> temporal_signal_split(dataset, train_ratio<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="4ceedd34-be26-4aaf-87d4-303948045f5b" class="cell" data-execution_count="1582">
<div class="sourceCode cell-code" id="cb360"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb360-1"><a href="#cb360-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>[]</span>
<span id="cb360-2"><a href="#cb360-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb360-3"><a href="#cb360-3" aria-hidden="true" tabindex="-1"></a>    data.append([time,snapshot])</span></code></pre></div>
</div>
<div id="cd4ad0bd-7791-4c02-b859-fc7552f544e4" class="cell" data-execution_count="1366">
<div class="sourceCode cell-code" id="cb361"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb361-1"><a href="#cb361-1" aria-hidden="true" tabindex="-1"></a>time</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1377">
<pre><code>52</code></pre>
</div>
</div>
<div id="e1f66443-a819-42dc-8b5e-44b710fd4506" class="cell" data-execution_count="1367">
<div class="sourceCode cell-code" id="cb363"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb363-1"><a href="#cb363-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">0</span>][<span class="dv">1</span>]).x.shape,(data[<span class="dv">0</span>][<span class="dv">1</span>]).edge_index.shape,(data[<span class="dv">0</span>][<span class="dv">1</span>]).edge_attr.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1378">
<pre><code>(torch.Size([129, 8]), torch.Size([2, 2158]), torch.Size([2158]))</code></pre>
</div>
</div>
<div id="7a03134c-6b8b-40a8-bdf8-2a5d67c82d6a" class="cell" data-execution_count="1368">
<div class="sourceCode cell-code" id="cb365"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb365-1"><a href="#cb365-1" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> nx.Graph()</span></code></pre></div>
</div>
<div id="b60e8aa3-bc3a-47ec-a6ba-9a0b18d48f9a" class="cell" data-execution_count="1369">
<div class="sourceCode cell-code" id="cb366"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb366-1"><a href="#cb366-1" aria-hidden="true" tabindex="-1"></a>node_list <span class="op">=</span> torch.tensor(<span class="bu">range</span>(<span class="dv">129</span>)).tolist()</span></code></pre></div>
</div>
<div id="dbd9dcec-4017-46c2-b3a0-3a3b2fb9c4fe" class="cell" data-execution_count="1370">
<div class="sourceCode cell-code" id="cb367"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb367-1"><a href="#cb367-1" aria-hidden="true" tabindex="-1"></a>G.add_nodes_from(node_list)</span></code></pre></div>
</div>
<div id="9f4a64fb-c78d-4581-942d-50fc734d5501" class="cell" data-execution_count="1371">
<div class="sourceCode cell-code" id="cb368"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb368-1"><a href="#cb368-1" aria-hidden="true" tabindex="-1"></a>data[<span class="op">-</span><span class="dv">1</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1382">
<pre><code>[52, Data(x=[129, 8], edge_index=[2, 1424], edge_attr=[1424], y=[129])]</code></pre>
</div>
</div>
<div id="ac96fa5a-8f36-4ae6-b29c-961750e6ae1e" class="cell" data-execution_count="1387">
<div class="sourceCode cell-code" id="cb370"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb370-1"><a href="#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(data[<span class="dv">0</span>][<span class="dv">1</span>].edge_index[<span class="dv">0</span>])</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1387">
<pre><code>2158</code></pre>
</div>
</div>
<div id="c2ba8036-935a-4032-8eff-34758bc35260" class="cell" data-execution_count="1392">
<div class="sourceCode cell-code" id="cb372"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb372-1"><a href="#cb372-1" aria-hidden="true" tabindex="-1"></a>edge_list<span class="op">=</span>[]</span>
<span id="cb372-2"><a href="#cb372-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">52</span>):</span>
<span id="cb372-3"><a href="#cb372-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>):</span>
<span id="cb372-4"><a href="#cb372-4" aria-hidden="true" tabindex="-1"></a>        edge_list.append([data[i][<span class="dv">1</span>].edge_index[<span class="dv">0</span>][j].tolist(),data[i][<span class="dv">1</span>].edge_index[<span class="dv">1</span>][j].tolist()])</span></code></pre></div>
</div>
<div id="cbc9869b-5f78-47e7-a498-8a84edab1bae" class="cell" data-execution_count="1393">
<div class="sourceCode cell-code" id="cb373"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb373-1"><a href="#cb373-1" aria-hidden="true" tabindex="-1"></a>G.add_edges_from(edge_list)</span></code></pre></div>
</div>
<div id="c00ab06c-40b4-4ce0-a299-c934b86be7a5" class="cell" data-execution_count="1394">
<div class="sourceCode cell-code" id="cb374"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb374-1"><a href="#cb374-1" aria-hidden="true" tabindex="-1"></a>G.number_of_nodes(),G.number_of_edges()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1394">
<pre><code>(129, 1230)</code></pre>
</div>
</div>
<div id="a3c9f724-c931-49f9-a7e5-a841436df51f" class="cell" data-execution_count="1396">
<div class="sourceCode cell-code" id="cb376"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb376-1"><a href="#cb376-1" aria-hidden="true" tabindex="-1"></a>nx.draw(G,with_labels<span class="op">=</span><span class="va">True</span>,font_weight<span class="op">=</span><span class="st">'bold'</span>,node_color<span class="op">=</span><span class="st">'green'</span>,node_size<span class="op">=</span><span class="dv">350</span>,font_color<span class="op">=</span><span class="st">'white'</span>,width<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2022-12-21-ST-GCN_Dataset_files/figure-html/cell-239-output-1.png" class="img-fluid"></p>
</div>
</div>
<hr>
<p>timeÎ≥Ñ Í∞ôÏùÄ edge Ï†ïÎ≥¥Î•º Í∞ÄÏßÄÍ≥† ÏûàÎÇò ÌôïÏù∏</p>
<div id="ff43d127-3efc-43b1-ac49-48ad494d1830" class="cell" data-execution_count="1590">
<div class="sourceCode cell-code" id="cb377"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb377-1"><a href="#cb377-1" aria-hidden="true" tabindex="-1"></a>np.where(data[<span class="dv">2</span>][<span class="dv">1</span>].edge_index <span class="op">!=</span>data[<span class="dv">2</span>][<span class="dv">1</span>].edge_index)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1590">
<pre><code>(array([], dtype=int64), array([], dtype=int64))</code></pre>
</div>
</div>
<hr>
<div id="4bcd84af-304f-41e1-b72b-f79b5e66a715" class="cell" data-execution_count="274">
<div class="sourceCode cell-code" id="cb379"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb379-1"><a href="#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.dataset <span class="im">import</span> EnglandCovidDatasetLoader</span>
<span id="cb379-2"><a href="#cb379-2" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> EnglandCovidDatasetLoader()</span>
<span id="cb379-3"><a href="#cb379-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb379-4"><a href="#cb379-4" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> loader.get_dataset(lags<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb379-5"><a href="#cb379-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb379-6"><a href="#cb379-6" aria-hidden="true" tabindex="-1"></a>train_dataset, test_dataset <span class="op">=</span> temporal_signal_split(dataset, train_ratio<span class="op">=</span><span class="fl">0.5</span>)</span></code></pre></div>
</div>
<div id="d25b8950-bfdc-48fa-809f-5ad698165fde" class="cell" data-tags="[]" data-execution_count="275">
<div class="sourceCode cell-code" id="cb380"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb380-1"><a href="#cb380-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>[]</span>
<span id="cb380-2"><a href="#cb380-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb380-3"><a href="#cb380-3" aria-hidden="true" tabindex="-1"></a>    data.append([time,snapshot])</span></code></pre></div>
</div>
<div id="f362ccc7-8bd8-4bf3-b97a-f4287bf3404f" class="cell" data-execution_count="276">
<div class="sourceCode cell-code" id="cb381"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb381-1"><a href="#cb381-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">0</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>], (data[<span class="dv">0</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="276">
<pre><code>(tensor([-1.4697, -1.9283, -1.6990, -1.8137]), tensor(-1.8137))</code></pre>
</div>
</div>
<p><span class="math inline">\(t=0\)</span>ÏóêÏÑú <span class="math inline">\(X\)</span>ÏôÄ <span class="math inline">\(y\)</span>Î•º Ï†ïÎ¶¨ÌïòÎ©¥ ÏïÑÎûòÏôÄ Í∞ôÏùå.</p>
<ul>
<li>X:= <span class="math inline">\(x_0,x_1,x_2,x_3\)</span></li>
<li>y:= <span class="math inline">\(x_4\)</span></li>
</ul>
<div id="1b38186c-b222-4255-8013-0a1097623c9e" class="cell" data-execution_count="279">
<div class="sourceCode cell-code" id="cb383"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb383-1"><a href="#cb383-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">1</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>],(data[<span class="dv">1</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="279">
<pre><code>(tensor([-1.9283, -1.6990, -1.8137, -1.8137]), tensor(-0.8965))</code></pre>
</div>
</div>
<ul>
<li>X:= <span class="math inline">\(x_1,x_2,x_3,x_4\)</span></li>
<li>y:= <span class="math inline">\(x_5\)</span></li>
</ul>
<div id="29387dce-0f2f-47d8-b413-fc8b52ae5c82" class="cell" data-execution_count="280">
<div class="sourceCode cell-code" id="cb385"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb385-1"><a href="#cb385-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">2</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>],(data[<span class="dv">2</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="280">
<pre><code>(tensor([-1.6990, -1.8137, -1.8137, -0.8965]), tensor(-1.1258))</code></pre>
</div>
</div>
<ul>
<li>X:=<span class="math inline">\(x_2,x_3,x_4,x_5\)</span></li>
<li>y:=<span class="math inline">\(x_6\)</span></li>
</ul>
<p>ÌïòÎÇòÏùò ÎÖ∏ÎìúÏóê Í∏∏Ïù¥Í∞Ä <span class="math inline">\(T\)</span>Ïù∏ ÏãúÍ≥ÑÏó¥Ïù¥ ÎßµÌïëÎêòÏñ¥ ÏûàÏùå. (ÎÖ∏ÎìúÎäî Ï¥ù 129Í∞ú)</p>
<p>Í∞Å ÎÖ∏ÎìúÎßàÎã§ ÏïÑÎûòÏôÄ Í∞ôÏùÄ Í≥ºÏ†ïÏúºÎ°ú ÏòàÏ∏°Ïù¥ Îê®</p>
<ul>
<li><span class="math inline">\((x_0,x_1,x_2,x_3) \to (x_4)\)</span></li>
<li><span class="math inline">\((x_1,x_2,x_3,x_4) \to (x_5)\)</span></li>
</ul>
<p><span class="math inline">\(f(v,t), v \in \{v_1,\dots,v_{129}\}, t=1,2,\dots,52\)</span></p>
<p><span class="math display">\[{\bf X}_{t=1} = \begin{bmatrix}
f(v_1,t=1) &amp; f(v_1,t=2) &amp; f(v_1,t=3)&amp;  f(v_1,t=4) \\
f(v_2,t=1) &amp; f(v_2,t=2) &amp; f(v_2,t=3)&amp;  f(v_2,t=4) \\
\dots &amp; \dots  &amp; \dots &amp; \dots  \\
f(v_{20},t=1) &amp; f(v_{20},t=2) &amp; f(v_{20},t=3)&amp;  f(v_{20},t=4)
\end{bmatrix}\]</span></p>
<p><span class="math display">\[{\bf y}_{t=1} = \begin{bmatrix}
f(v_1,t=5) \\
f(v_2,t=5) \\
\dots  \\
f(v_{20},t=5)
\end{bmatrix}\]</span></p>
<section id="learn-8" class="level4">
<h4 class="anchored" data-anchor-id="learn-8">Learn</h4>
<div id="06e21770-4118-4972-80a6-23f3b25390e3" class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb387"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb387-1"><a href="#cb387-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> RecurrentGCN(node_features<span class="op">=</span><span class="dv">4</span>, filters<span class="op">=</span><span class="dv">32</span>)</span>
<span id="cb387-2"><a href="#cb387-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-3"><a href="#cb387-3" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> torch.optim.Adam(model.parameters(), lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb387-4"><a href="#cb387-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-5"><a href="#cb387-5" aria-hidden="true" tabindex="-1"></a>model.train()</span>
<span id="cb387-6"><a href="#cb387-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-7"><a href="#cb387-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> tqdm(<span class="bu">range</span>(<span class="dv">50</span>)):</span>
<span id="cb387-8"><a href="#cb387-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb387-9"><a href="#cb387-9" aria-hidden="true" tabindex="-1"></a>        y_hat <span class="op">=</span> model(snapshot.x, snapshot.edge_index, snapshot.edge_attr)</span>
<span id="cb387-10"><a href="#cb387-10" aria-hidden="true" tabindex="-1"></a>        cost <span class="op">=</span> torch.mean((y_hat<span class="op">-</span>snapshot.y)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb387-11"><a href="#cb387-11" aria-hidden="true" tabindex="-1"></a>        cost.backward()</span>
<span id="cb387-12"><a href="#cb387-12" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb387-13"><a href="#cb387-13" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 50/50 [00:07&lt;00:00,  6.30it/s]</code></pre>
</div>
</div>
<div id="fbd9e66a-7d73-447a-9602-26a92fbd0803" class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb389"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb389-1"><a href="#cb389-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb389-2"><a href="#cb389-2" aria-hidden="true" tabindex="-1"></a>    _x <span class="op">=</span> snapshot.x </span>
<span id="cb389-3"><a href="#cb389-3" aria-hidden="true" tabindex="-1"></a>    _edge_index <span class="op">=</span> snapshot.edge_index </span>
<span id="cb389-4"><a href="#cb389-4" aria-hidden="true" tabindex="-1"></a>    _edge_attr <span class="op">=</span> snapshot.edge_attr</span>
<span id="cb389-5"><a href="#cb389-5" aria-hidden="true" tabindex="-1"></a>    _y <span class="op">=</span> snapshot.y</span>
<span id="cb389-6"><a href="#cb389-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span></code></pre></div>
</div>
<div id="ccfa96f3-fd58-4a8c-a223-851860f8efea" class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb390"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb390-1"><a href="#cb390-1" aria-hidden="true" tabindex="-1"></a>_x.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="83">
<pre><code>torch.Size([129, 4])</code></pre>
</div>
</div>
<div id="81bec8f7-acf8-453c-91ea-82b712c2bc9d" class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb392"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb392-1"><a href="#cb392-1" aria-hidden="true" tabindex="-1"></a>_edge_index.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="84">
<pre><code>torch.Size([2, 2158])</code></pre>
</div>
</div>
<div id="3fac2f89-ebee-42cc-9cad-7412d02326f9" class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb394"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb394-1"><a href="#cb394-1" aria-hidden="true" tabindex="-1"></a>_edge_attr.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="85">
<pre><code>torch.Size([2158])</code></pre>
</div>
</div>
<div id="efe2c13c-2e34-41b1-9609-1499e0860e56" class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb396"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb396-1"><a href="#cb396-1" aria-hidden="true" tabindex="-1"></a>_y.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="86">
<pre><code>torch.Size([129])</code></pre>
</div>
</div>
<div id="9d4d7dea-e037-4250-833a-d00ddd5f6fe9" class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb398"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb398-1"><a href="#cb398-1" aria-hidden="true" tabindex="-1"></a>y_hat.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="97">
<pre><code>torch.Size([129, 1])</code></pre>
</div>
</div>
<div id="8fed3f10-1d61-4414-9e49-392bb734db4d" class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb400"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb400-1"><a href="#cb400-1" aria-hidden="true" tabindex="-1"></a>_x.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="87">
<pre><code>torch.Size([129, 4])</code></pre>
</div>
</div>
<p>x</p>
<ul>
<li></li>
</ul>
<p>y</p>
<ul>
<li></li>
</ul>
<p>The node features correspond to the number of COVID-19 cases in the region in the past window days.</p>
<p>The task is to predict the number of cases in each node after 1 day</p>
<div id="ad683b6b-77a5-4e4f-9cb6-0743d6f4f8df" class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb402"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb402-1"><a href="#cb402-1" aria-hidden="true" tabindex="-1"></a>_x[<span class="dv">0</span>:<span class="dv">3</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="88">
<pre><code>tensor([[-1.4697, -1.9283, -1.6990, -1.8137],
        [-1.2510, -1.1812, -1.3208, -1.1812],
        [-1.0934, -1.0934, -1.0934, -1.0934]])</code></pre>
</div>
</div>
<div id="10c673b8-5554-4132-9f6c-84340356909c" class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb404"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb404-1"><a href="#cb404-1" aria-hidden="true" tabindex="-1"></a>_y[:<span class="dv">3</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="90">
<pre><code>tensor([-1.8137, -1.3208, -1.0934])</code></pre>
</div>
</div>
</section>
</section>
<section id="montevideobusdatasetloader" class="level2">
<h2 class="anchored" data-anchor-id="montevideobusdatasetloader">MontevideoBusDatasetLoader</h2>
<p>https://www.fing.edu.uy/~renzom/msc/uploads/msc-thesis.pdf</p>
<p>Montevideo Buses</p>
<ul>
<li>A dataset about the hourly passenger inflow at bus stop level for eleven bus lines from the city of Montevideo. Nodes are bus stops and edges represent connections between the stops; the dataset covers a whole month of traffic patterns.</li>
</ul>
<p>Îç∞Ïù¥ÌÑ∞Ï†ïÎ¶¨</p>
<ul>
<li>T = 739</li>
<li>V = Î≤ÑÏä§Ï†ïÎ•òÏû•</li>
<li>N = 675 # number of nodes</li>
<li>E = 101761 = N^2 # edges</li>
<li><span class="math inline">\(f(v,t)\)</span>Ïùò Ï∞®Ïõê? (1,) # passenger inflow</li>
<li>ÏãúÍ∞ÑÏóê Îî∞ÎùºÏÑú Number of nodesÍ∞Ä Î≥ÄÌïòÎäîÏßÄ? False</li>
<li>ÏãúÍ∞ÑÏóê Îî∞ÎùºÏÑú Number of nodesÍ∞Ä Î≥ÄÌïòÎäîÏßÄ? False</li>
<li>X: (675,4) (N,4), <span class="math inline">\(f(v,t_0),f(v,t_1),f(v,t_2),f(v,t_3)\)</span></li>
<li>y: (675,,) (N,), <span class="math inline">\(f(v,t_4)\)</span></li>
<li>ÏòàÏ†úÏΩîÎìúÏ†ÅÏö©Í∞ÄÎä•Ïó¨Î∂Ä: Yes</li>
</ul>
<p><code>-</code> Nodes : <code>675</code></p>
<ul>
<li>vertices are bus stops</li>
</ul>
<p><code>-</code>Edges : <code>690</code></p>
<ul>
<li>edges are links between bus stops when a bus line connects them and the weight represent the road distance</li>
</ul>
<p><code>-</code> Time : <code>739</code></p>
<ul>
<li>hourly inflow passenger data at bus stop level for 11 bus lines during October 2020 from Montevideo city (Uruguay).</li>
</ul>
<div id="cf8faecc-cc6e-498a-ad25-f00c02ee51ef" class="cell" data-execution_count="1591">
<div class="sourceCode cell-code" id="cb406"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb406-1"><a href="#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.dataset <span class="im">import</span> MontevideoBusDatasetLoader</span>
<span id="cb406-2"><a href="#cb406-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.signal <span class="im">import</span> temporal_signal_split</span>
<span id="cb406-3"><a href="#cb406-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-4"><a href="#cb406-4" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> MontevideoBusDatasetLoader()</span>
<span id="cb406-5"><a href="#cb406-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-6"><a href="#cb406-6" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> loader.get_dataset()</span>
<span id="cb406-7"><a href="#cb406-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-8"><a href="#cb406-8" aria-hidden="true" tabindex="-1"></a>train_dataset, test_dataset <span class="op">=</span> temporal_signal_split(dataset, train_ratio<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="246d0392-4a65-45fe-8533-6b29b4f99a1e" class="cell" data-execution_count="1592">
<div class="sourceCode cell-code" id="cb407"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb407-1"><a href="#cb407-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>[]</span>
<span id="cb407-2"><a href="#cb407-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb407-3"><a href="#cb407-3" aria-hidden="true" tabindex="-1"></a>    data.append([time,snapshot])</span></code></pre></div>
</div>
<div id="015fc2bb-25fb-428f-b860-fda6ce96c63c" class="cell" data-execution_count="1399">
<div class="sourceCode cell-code" id="cb408"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb408-1"><a href="#cb408-1" aria-hidden="true" tabindex="-1"></a>time</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1399">
<pre><code>739</code></pre>
</div>
</div>
<div id="b126e881-ba75-45a7-98c8-9cb1f399c3b3" class="cell" data-execution_count="1400">
<div class="sourceCode cell-code" id="cb410"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb410-1"><a href="#cb410-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">0</span>][<span class="dv">1</span>]).x.shape,(data[<span class="dv">0</span>][<span class="dv">1</span>]).edge_index.shape,(data[<span class="dv">0</span>][<span class="dv">1</span>]).edge_attr.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1400">
<pre><code>(torch.Size([675, 4]), torch.Size([2, 690]), torch.Size([690]))</code></pre>
</div>
</div>
<div id="65ecde78-e690-434e-9ff3-0564a994fbc7" class="cell" data-execution_count="1401">
<div class="sourceCode cell-code" id="cb412"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb412-1"><a href="#cb412-1" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> nx.Graph()</span></code></pre></div>
</div>
<div id="5fbcfb0e-c77c-4208-ba68-17882a2664c3" class="cell" data-execution_count="1402">
<div class="sourceCode cell-code" id="cb413"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb413-1"><a href="#cb413-1" aria-hidden="true" tabindex="-1"></a>node_list <span class="op">=</span> torch.tensor(<span class="bu">range</span>(<span class="dv">675</span>)).tolist()</span></code></pre></div>
</div>
<div id="be87ad74-df93-4085-81d8-d657887efa12" class="cell" data-execution_count="1403">
<div class="sourceCode cell-code" id="cb414"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb414-1"><a href="#cb414-1" aria-hidden="true" tabindex="-1"></a>G.add_nodes_from(node_list)</span></code></pre></div>
</div>
<div id="f5382d25-cfc3-4200-9e2f-aec320b17efd" class="cell" data-execution_count="1404">
<div class="sourceCode cell-code" id="cb415"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb415-1"><a href="#cb415-1" aria-hidden="true" tabindex="-1"></a>edge_list<span class="op">=</span>[]</span>
<span id="cb415-2"><a href="#cb415-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">739</span>):</span>
<span id="cb415-3"><a href="#cb415-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data[<span class="dv">0</span>][<span class="dv">1</span>].edge_index[<span class="dv">0</span>])):</span>
<span id="cb415-4"><a href="#cb415-4" aria-hidden="true" tabindex="-1"></a>        edge_list.append([data[i][<span class="dv">1</span>].edge_index[<span class="dv">0</span>][j].tolist(),data[i][<span class="dv">1</span>].edge_index[<span class="dv">1</span>][j].tolist()])</span></code></pre></div>
</div>
<div id="000cff82-2492-4503-b6cf-c91199b4e538" class="cell" data-execution_count="1405">
<div class="sourceCode cell-code" id="cb416"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb416-1"><a href="#cb416-1" aria-hidden="true" tabindex="-1"></a>G.add_edges_from(edge_list)</span></code></pre></div>
</div>
<div id="1737c19f-37c4-4b1e-af4b-b54ad02a0784" class="cell" data-execution_count="1406">
<div class="sourceCode cell-code" id="cb417"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb417-1"><a href="#cb417-1" aria-hidden="true" tabindex="-1"></a>G.number_of_nodes(),G.number_of_edges()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1406">
<pre><code>(675, 690)</code></pre>
</div>
</div>
<div id="97b04214-d253-49a9-a1da-13ec0fe8ba03" class="cell" data-execution_count="1410">
<div class="sourceCode cell-code" id="cb419"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb419-1"><a href="#cb419-1" aria-hidden="true" tabindex="-1"></a>nx.draw(G,node_color<span class="op">=</span><span class="st">'green'</span>,node_size<span class="op">=</span><span class="dv">50</span>,font_color<span class="op">=</span><span class="st">'white'</span>,width<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2022-12-21-ST-GCN_Dataset_files/figure-html/cell-266-output-1.png" class="img-fluid"></p>
</div>
</div>
<hr>
<p>timeÎ≥Ñ Í∞ôÏùÄ edge Ï†ïÎ≥¥Î•º Í∞ÄÏßÄÍ≥† ÏûàÎÇò ÌôïÏù∏</p>
<div id="b9743a72-5a24-4d64-a192-1fed9e5c1f33" class="cell" data-execution_count="1593">
<div class="sourceCode cell-code" id="cb420"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb420-1"><a href="#cb420-1" aria-hidden="true" tabindex="-1"></a>np.where(data[<span class="dv">0</span>][<span class="dv">1</span>].edge_index <span class="op">!=</span> data[<span class="dv">10</span>][<span class="dv">1</span>].edge_index)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1593">
<pre><code>(array([], dtype=int64), array([], dtype=int64))</code></pre>
</div>
</div>
<hr>
<div id="e52d27b5-e22c-4197-8e1e-c3f5645a590f" class="cell" data-execution_count="281">
<div class="sourceCode cell-code" id="cb422"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb422-1"><a href="#cb422-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.dataset <span class="im">import</span> MontevideoBusDatasetLoader</span>
<span id="cb422-2"><a href="#cb422-2" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> MontevideoBusDatasetLoader()</span>
<span id="cb422-3"><a href="#cb422-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-4"><a href="#cb422-4" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> loader.get_dataset(lags<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb422-5"><a href="#cb422-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-6"><a href="#cb422-6" aria-hidden="true" tabindex="-1"></a>train_dataset, test_dataset <span class="op">=</span> temporal_signal_split(dataset, train_ratio<span class="op">=</span><span class="fl">0.5</span>)</span></code></pre></div>
</div>
<div id="50927dcd-d8eb-48ef-8e5e-894579e6a4a1" class="cell" data-tags="[]" data-execution_count="282">
<div class="sourceCode cell-code" id="cb423"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb423-1"><a href="#cb423-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>[]</span>
<span id="cb423-2"><a href="#cb423-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb423-3"><a href="#cb423-3" aria-hidden="true" tabindex="-1"></a>    data.append([time,snapshot])</span></code></pre></div>
</div>
<div id="6f6dd313-c58b-4b64-bfd0-8d90ca4c142e" class="cell" data-execution_count="283">
<div class="sourceCode cell-code" id="cb424"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb424-1"><a href="#cb424-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">0</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>], (data[<span class="dv">0</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="283">
<pre><code>(tensor([-0.4200, -0.4200, -0.4200, -0.4200]), tensor(-0.4200))</code></pre>
</div>
</div>
<p><span class="math inline">\(t=0\)</span>ÏóêÏÑú <span class="math inline">\(X\)</span>ÏôÄ <span class="math inline">\(y\)</span>Î•º Ï†ïÎ¶¨ÌïòÎ©¥ ÏïÑÎûòÏôÄ Í∞ôÏùå.</p>
<ul>
<li>X:= <span class="math inline">\(x_0,x_1,x_2,x_3\)</span></li>
<li>y:= <span class="math inline">\(x_4\)</span></li>
</ul>
<div id="13443b21-9e4c-4d80-abc3-9f0829607d63" class="cell" data-execution_count="284">
<div class="sourceCode cell-code" id="cb426"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb426-1"><a href="#cb426-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">1</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>],(data[<span class="dv">1</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="284">
<pre><code>(tensor([-0.4200, -0.4200, -0.4200, -0.4200]), tensor(-0.4200))</code></pre>
</div>
</div>
<ul>
<li>X:= <span class="math inline">\(x_1,x_2,x_3,x_4\)</span></li>
<li>y:= <span class="math inline">\(x_5\)</span></li>
</ul>
<div id="882532d3-a32d-4143-ba77-b756cda2d272" class="cell" data-execution_count="285">
<div class="sourceCode cell-code" id="cb428"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb428-1"><a href="#cb428-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">2</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>],(data[<span class="dv">2</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="285">
<pre><code>(tensor([-0.4200, -0.4200, -0.4200, -0.4200]), tensor(-0.4200))</code></pre>
</div>
</div>
<ul>
<li>X:=<span class="math inline">\(x_2,x_3,x_4,x_5\)</span></li>
<li>y:=<span class="math inline">\(x_6\)</span></li>
</ul>
<p>ÌïòÎÇòÏùò ÎÖ∏ÎìúÏóê Í∏∏Ïù¥Í∞Ä <span class="math inline">\(T\)</span>Ïù∏ ÏãúÍ≥ÑÏó¥Ïù¥ ÎßµÌïëÎêòÏñ¥ ÏûàÏùå. (ÎÖ∏ÎìúÎäî Ï¥ù 675Í∞ú)</p>
<p>Í∞Å ÎÖ∏ÎìúÎßàÎã§ ÏïÑÎûòÏôÄ Í∞ôÏùÄ Í≥ºÏ†ïÏúºÎ°ú ÏòàÏ∏°Ïù¥ Îê®</p>
<ul>
<li><span class="math inline">\((x_0,x_1,x_2,x_3) \to (x_4)\)</span></li>
<li><span class="math inline">\((x_1,x_2,x_3,x_4) \to (x_5)\)</span></li>
</ul>
<p><span class="math inline">\(f(v,t), v \in \{v_1,\dots,v_{675}\}, t=1,2,\dots,739\)</span></p>
<p><span class="math display">\[{\bf X}_{t=1} = \begin{bmatrix}
f(v_1,t=1) &amp; f(v_1,t=2) &amp; f(v_1,t=3)&amp;  f(v_1,t=4) \\
f(v_2,t=1) &amp; f(v_2,t=2) &amp; f(v_2,t=3)&amp;  f(v_2,t=4) \\
\dots &amp; \dots  &amp; \dots &amp; \dots  \\
f(v_{20},t=1) &amp; f(v_{20},t=2) &amp; f(v_{20},t=3)&amp;  f(v_{20},t=4)
\end{bmatrix}\]</span></p>
<p><span class="math display">\[{\bf y}_{t=1} = \begin{bmatrix}
f(v_1,t=5) \\
f(v_2,t=5) \\
\dots  \\
f(v_{20},t=5)
\end{bmatrix}\]</span></p>
<section id="learn-9" class="level4">
<h4 class="anchored" data-anchor-id="learn-9">Learn</h4>
<div id="9b2aaf5d-f014-4fe3-9cf3-8e55c3b99745" class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb430"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb430-1"><a href="#cb430-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> RecurrentGCN(node_features<span class="op">=</span><span class="dv">4</span>, filters<span class="op">=</span><span class="dv">32</span>)</span>
<span id="cb430-2"><a href="#cb430-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-3"><a href="#cb430-3" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> torch.optim.Adam(model.parameters(), lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb430-4"><a href="#cb430-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-5"><a href="#cb430-5" aria-hidden="true" tabindex="-1"></a>model.train()</span>
<span id="cb430-6"><a href="#cb430-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-7"><a href="#cb430-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> tqdm(<span class="bu">range</span>(<span class="dv">50</span>)):</span>
<span id="cb430-8"><a href="#cb430-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb430-9"><a href="#cb430-9" aria-hidden="true" tabindex="-1"></a>        y_hat <span class="op">=</span> model(snapshot.x, snapshot.edge_index, snapshot.edge_attr)</span>
<span id="cb430-10"><a href="#cb430-10" aria-hidden="true" tabindex="-1"></a>        cost <span class="op">=</span> torch.mean((y_hat<span class="op">-</span>snapshot.y)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb430-11"><a href="#cb430-11" aria-hidden="true" tabindex="-1"></a>        cost.backward()</span>
<span id="cb430-12"><a href="#cb430-12" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb430-13"><a href="#cb430-13" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 50/50 [01:51&lt;00:00,  2.23s/it]</code></pre>
</div>
</div>
<div id="16fbaaa9-b50b-4f59-aad5-d44c64409b93" class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb432"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb432-1"><a href="#cb432-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb432-2"><a href="#cb432-2" aria-hidden="true" tabindex="-1"></a>    _x <span class="op">=</span> snapshot.x </span>
<span id="cb432-3"><a href="#cb432-3" aria-hidden="true" tabindex="-1"></a>    _edge_index <span class="op">=</span> snapshot.edge_index </span>
<span id="cb432-4"><a href="#cb432-4" aria-hidden="true" tabindex="-1"></a>    _edge_attr <span class="op">=</span> snapshot.edge_attr</span>
<span id="cb432-5"><a href="#cb432-5" aria-hidden="true" tabindex="-1"></a>    _y <span class="op">=</span> snapshot.y</span>
<span id="cb432-6"><a href="#cb432-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span></code></pre></div>
</div>
<div id="16b05dc0-33fd-49ed-b41c-ba598ad16037" class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb433"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb433-1"><a href="#cb433-1" aria-hidden="true" tabindex="-1"></a>_x.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="101">
<pre><code>torch.Size([675, 4])</code></pre>
</div>
</div>
<div id="4d61d344-f711-473d-a707-94bb6073ef4e" class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb435"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb435-1"><a href="#cb435-1" aria-hidden="true" tabindex="-1"></a>_edge_index.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="102">
<pre><code>torch.Size([2, 690])</code></pre>
</div>
</div>
<div id="c14de653-0e30-4feb-9e92-795563af812f" class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb437"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb437-1"><a href="#cb437-1" aria-hidden="true" tabindex="-1"></a>_edge_attr.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="103">
<pre><code>torch.Size([690])</code></pre>
</div>
</div>
<div id="75e8256b-6af0-4f7e-aea0-78cad0905ade" class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb439"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb439-1"><a href="#cb439-1" aria-hidden="true" tabindex="-1"></a>_y.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="104">
<pre><code>torch.Size([675])</code></pre>
</div>
</div>
<div id="98651b4d-a7d4-4512-aa0b-db665b7f136e" class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb441"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb441-1"><a href="#cb441-1" aria-hidden="true" tabindex="-1"></a>_x.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="105">
<pre><code>torch.Size([675, 4])</code></pre>
</div>
</div>
<p>x</p>
<ul>
<li></li>
</ul>
<p>y</p>
<ul>
<li>The target is the passenger inflow.</li>
<li>This is a curated dataset made from different data sources of the Metropolitan Transportation System (STM) of Montevide</li>
</ul>
<div id="6bd406ca-458f-4bbd-86ed-4d42fbaba004" class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb443"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb443-1"><a href="#cb443-1" aria-hidden="true" tabindex="-1"></a>_x[<span class="dv">0</span>:<span class="dv">3</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="106">
<pre><code>tensor([[-0.4200, -0.4200, -0.4200, -0.4200],
        [-0.0367, -0.0367, -0.0367, -0.0367],
        [-0.2655, -0.2655, -0.2655, -0.2655]])</code></pre>
</div>
</div>
<div id="4e8b5972-bf6d-4184-91a9-b5118ed1adf2" class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb445"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb445-1"><a href="#cb445-1" aria-hidden="true" tabindex="-1"></a>_y[:<span class="dv">3</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="109">
<pre><code>tensor([-0.4200, -0.0367, -0.2655])</code></pre>
</div>
</div>
</section>
</section>
<section id="twittertennisdatasetloader" class="level2">
<h2 class="anchored" data-anchor-id="twittertennisdatasetloader">TwitterTennisDatasetLoader</h2>
<p>https://appliednetsci.springeropen.com/articles/10.1007/s41109-018-0080-5?ref=https://githubhelp.com</p>
<p>Twitter Tennis RG and UO</p>
<ul>
<li>Twitter mention graphs of major tennis tournaments from 2017. Each snapshot contains the graph of popular player or sport news accounts and mentions between them [5, 6]. Node labels encode the number of mentions received and vertex features are structural properties</li>
</ul>
<p>Îç∞Ïù¥ÌÑ∞Ï†ïÎ¶¨</p>
<ul>
<li>T = 52081</li>
<li>V = Ìä∏ÏúÑÌÑ∞Í≥ÑÏ†ï<br>
</li>
<li>N = 1000 # number of nodes</li>
<li>E = 119 = N^2 # edges</li>
<li><span class="math inline">\(f(v,t)\)</span>Ïùò Ï∞®Ïõê? (1,) # passenger inflow</li>
<li>ÏãúÍ∞ÑÏóê Îî∞ÎùºÏÑú NÏù¥ Î≥ÄÌïòÎäîÏßÄ? ??</li>
<li>ÏãúÍ∞ÑÏóê Îî∞ÎùºÏÑú EÍ∞Ä Î≥ÄÌïòÎäîÏßÄ? True</li>
<li>X: ?</li>
<li>y: ?</li>
<li>ÏòàÏ†úÏΩîÎìúÏ†ÅÏö©Í∞ÄÎä•Ïó¨Î∂Ä: No</li>
</ul>
<p><code>-</code> Nodes : <code>1000</code></p>
<ul>
<li>vertices are Twitter accounts</li>
</ul>
<p><code>-</code>Edges : <code>119</code></p>
<ul>
<li>edges are mentions between them</li>
</ul>
<p><code>-</code> Time : <code>52081</code></p>
<ul>
<li>Twitter mention graphs related to major tennis tournaments from 2017</li>
</ul>
<div id="b824f1e8-4731-4f6c-9ddf-4c5bf76d8e15" class="cell" data-execution_count="1621">
<div class="sourceCode cell-code" id="cb447"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb447-1"><a href="#cb447-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.dataset <span class="im">import</span> TwitterTennisDatasetLoader</span>
<span id="cb447-2"><a href="#cb447-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.signal <span class="im">import</span> temporal_signal_split</span>
<span id="cb447-3"><a href="#cb447-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb447-4"><a href="#cb447-4" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> TwitterTennisDatasetLoader()</span>
<span id="cb447-5"><a href="#cb447-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb447-6"><a href="#cb447-6" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> loader.get_dataset()</span>
<span id="cb447-7"><a href="#cb447-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb447-8"><a href="#cb447-8" aria-hidden="true" tabindex="-1"></a>train_dataset, test_dataset <span class="op">=</span> temporal_signal_split(dataset, train_ratio<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="17d1a26a-c2a5-466e-8c56-568342c0929d" class="cell" data-execution_count="1622">
<div class="sourceCode cell-code" id="cb448"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb448-1"><a href="#cb448-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>[]</span>
<span id="cb448-2"><a href="#cb448-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb448-3"><a href="#cb448-3" aria-hidden="true" tabindex="-1"></a>    data.append([time,snapshot])</span></code></pre></div>
</div>
<div id="8f72fc6c-4bb6-4e4f-b696-b988dbc3275d" class="cell" data-execution_count="1623">
<div class="sourceCode cell-code" id="cb449"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb449-1"><a href="#cb449-1" aria-hidden="true" tabindex="-1"></a>time</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1623">
<pre><code>119</code></pre>
</div>
</div>
<div id="2997e627-9e66-4ea7-9aa3-0e3cba486753" class="cell" data-execution_count="1624">
<div class="sourceCode cell-code" id="cb451"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb451-1"><a href="#cb451-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">0</span>][<span class="dv">1</span>]).x.shape,(data[<span class="dv">0</span>][<span class="dv">1</span>]).edge_index.shape,(data[<span class="dv">0</span>][<span class="dv">1</span>]).edge_attr.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1624">
<pre><code>(torch.Size([1000, 16]), torch.Size([2, 89]), torch.Size([89]))</code></pre>
</div>
</div>
<div id="17485dc9-c4ff-4fd2-a174-2d545477add4" class="cell" data-execution_count="1630">
<div class="sourceCode cell-code" id="cb453"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb453-1"><a href="#cb453-1" aria-hidden="true" tabindex="-1"></a>data[<span class="dv">0</span>][<span class="dv">1</span>].x[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1630">
<pre><code>tensor([0., 0., 0., 0., 1., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.])</code></pre>
</div>
</div>
<div id="4e9b30fb-2779-4508-98e1-89ada19f22fb" class="cell" data-execution_count="1631">
<div class="sourceCode cell-code" id="cb455"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb455-1"><a href="#cb455-1" aria-hidden="true" tabindex="-1"></a>data[<span class="dv">0</span>][<span class="dv">1</span>].edge_index[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1631">
<pre><code>tensor([ 42, 909, 909, 909, 233, 233, 450, 256, 256, 256, 256, 256, 434, 434,
        434, 233, 233, 233, 233, 233, 233, 233,   9,   9, 355,  84,  84,  84,
         84, 140, 140, 140, 140,   0, 140, 238, 238, 238, 649, 875, 875, 234,
         73,  73, 341, 341, 341, 341, 341, 417, 293, 991,  74, 581, 282, 162,
        144, 383, 383, 135, 135, 910, 910, 910, 910, 910,  87,  87,  87,  87,
          9,   9, 934, 934, 162, 225,  42, 911, 911, 911, 911, 911, 911, 911,
        911, 498, 498,  64, 435])</code></pre>
</div>
</div>
<div id="998fe143-0ea6-4b06-a80d-b549b87313d4" class="cell" data-execution_count="1633">
<div class="sourceCode cell-code" id="cb457"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb457-1"><a href="#cb457-1" aria-hidden="true" tabindex="-1"></a>data[<span class="dv">0</span>][<span class="dv">1</span>].edge_attr</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1633">
<pre><code>tensor([2., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1.,
        1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1.,
        1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 2., 1., 1., 1., 1., 1.,
        1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 2., 2., 1., 1., 1., 1., 1., 1.,
        1., 1., 1., 1., 3., 2., 1., 1., 1., 1., 2., 2., 2., 1., 1., 1., 3.])</code></pre>
</div>
</div>
<div id="e8db2dcc-183e-4de4-a329-a9297c814202" class="cell" data-execution_count="1438">
<div class="sourceCode cell-code" id="cb459"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb459-1"><a href="#cb459-1" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> nx.Graph()</span></code></pre></div>
</div>
<div id="76df8944-10aa-49ca-bd83-51b81772a68d" class="cell" data-execution_count="1439">
<div class="sourceCode cell-code" id="cb460"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb460-1"><a href="#cb460-1" aria-hidden="true" tabindex="-1"></a>node_list <span class="op">=</span> torch.tensor(<span class="bu">range</span>(<span class="dv">1000</span>)).tolist()</span></code></pre></div>
</div>
<div id="183d5660-0659-4130-9719-42e64e23c017" class="cell" data-execution_count="1440">
<div class="sourceCode cell-code" id="cb461"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb461-1"><a href="#cb461-1" aria-hidden="true" tabindex="-1"></a>G.add_nodes_from(node_list)</span></code></pre></div>
</div>
<div id="473b84b5-5d84-4107-81be-93750cc1ef07" class="cell" data-execution_count="1441">
<div class="sourceCode cell-code" id="cb462"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb462-1"><a href="#cb462-1" aria-hidden="true" tabindex="-1"></a>edge_list<span class="op">=</span>[]</span>
<span id="cb462-2"><a href="#cb462-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">119</span>):</span>
<span id="cb462-3"><a href="#cb462-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">40</span>):</span>
<span id="cb462-4"><a href="#cb462-4" aria-hidden="true" tabindex="-1"></a>        edge_list.append([data[i][<span class="dv">1</span>].edge_index[<span class="dv">0</span>][j].tolist(),data[i][<span class="dv">1</span>].edge_index[<span class="dv">1</span>][j].tolist()])</span></code></pre></div>
</div>
<div id="7a072624-c874-4d46-8e91-9d5227e370a2" class="cell" data-execution_count="1442">
<div class="sourceCode cell-code" id="cb463"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb463-1"><a href="#cb463-1" aria-hidden="true" tabindex="-1"></a>G.add_edges_from(edge_list)</span></code></pre></div>
</div>
<div id="bb418682-f3ad-4433-b599-fec3ee95bf0d" class="cell" data-execution_count="1443">
<div class="sourceCode cell-code" id="cb464"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb464-1"><a href="#cb464-1" aria-hidden="true" tabindex="-1"></a>G.number_of_nodes(),G.number_of_edges()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1443">
<pre><code>(1000, 2819)</code></pre>
</div>
</div>
<div id="4cd29fc1-aa38-4149-8416-b661d9207f2d" class="cell" data-execution_count="1444">
<div class="sourceCode cell-code" id="cb466"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb466-1"><a href="#cb466-1" aria-hidden="true" tabindex="-1"></a>nx.draw(G,node_color<span class="op">=</span><span class="st">'green'</span>,node_size<span class="op">=</span><span class="dv">50</span>,width<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2022-12-21-ST-GCN_Dataset_files/figure-html/cell-295-output-1.png" class="img-fluid"></p>
</div>
</div>
<hr>
<p>timeÎ≥Ñ Í∞ôÏùÄ edge Ï†ïÎ≥¥Î•º Í∞ÄÏßÄÍ≥† ÏûàÎÇò ÌôïÏù∏</p>
<div id="0a40565c-90f5-4426-b799-e1f297ee0261" class="cell" data-execution_count="1603">
<div class="sourceCode cell-code" id="cb467"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb467-1"><a href="#cb467-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(data[<span class="dv">2</span>][<span class="dv">1</span>].edge_index[<span class="dv">0</span>])</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1603">
<pre><code>67</code></pre>
</div>
</div>
<div id="66d39960-c9ef-4a63-a9eb-fa549d89151b" class="cell" data-execution_count="1606">
<div class="sourceCode cell-code" id="cb469"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb469-1"><a href="#cb469-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(data[<span class="dv">0</span>][<span class="dv">1</span>].edge_index[<span class="dv">0</span>])</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1606">
<pre><code>89</code></pre>
</div>
</div>
<p>Îã§Î¶Ñ..</p>
<hr>
<div id="65629378-d7d2-4f73-a1a1-7d000db16ae3" class="cell" data-execution_count="296">
<div class="sourceCode cell-code" id="cb471"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb471-1"><a href="#cb471-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.dataset <span class="im">import</span> TwitterTennisDatasetLoader</span>
<span id="cb471-2"><a href="#cb471-2" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> TwitterTennisDatasetLoader()</span>
<span id="cb471-3"><a href="#cb471-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb471-4"><a href="#cb471-4" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> loader.get_dataset()</span>
<span id="cb471-5"><a href="#cb471-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb471-6"><a href="#cb471-6" aria-hidden="true" tabindex="-1"></a>train_dataset, test_dataset <span class="op">=</span> temporal_signal_split(dataset, train_ratio<span class="op">=</span><span class="fl">0.5</span>)</span></code></pre></div>
</div>
<div id="d8b352d7-2739-4cbe-82d1-673a08fb31fa" class="cell" data-tags="[]" data-execution_count="297">
<div class="sourceCode cell-code" id="cb472"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb472-1"><a href="#cb472-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>[]</span>
<span id="cb472-2"><a href="#cb472-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb472-3"><a href="#cb472-3" aria-hidden="true" tabindex="-1"></a>    data.append([time,snapshot])</span></code></pre></div>
</div>
<div id="43290d27-e40b-4756-8f49-c1ac5f31ddba" class="cell" data-execution_count="298">
<div class="sourceCode cell-code" id="cb473"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb473-1"><a href="#cb473-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">0</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>], (data[<span class="dv">0</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="298">
<pre><code>(tensor([0., 0., 0., 0., 1., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]),
 tensor(4.8363))</code></pre>
</div>
</div>
<div id="1111c9f2-8123-4bc7-92f0-810f61eaf0b1" class="cell" data-execution_count="299">
<div class="sourceCode cell-code" id="cb475"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb475-1"><a href="#cb475-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">1</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>],(data[<span class="dv">1</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="299">
<pre><code>(tensor([0., 0., 0., 1., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]),
 tensor(4.9200))</code></pre>
</div>
</div>
<div id="bc57904f-343c-4ef0-b0f7-2de54c2f899e" class="cell" data-execution_count="300">
<div class="sourceCode cell-code" id="cb477"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb477-1"><a href="#cb477-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">2</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>],(data[<span class="dv">2</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="300">
<pre><code>(tensor([0., 0., 0., 0., 1., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]),
 tensor(6.5539))</code></pre>
</div>
</div>
<div id="3f97c6a2-083d-4dc4-8806-092dffe541b3" class="cell" data-execution_count="301">
<div class="sourceCode cell-code" id="cb479"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb479-1"><a href="#cb479-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">3</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>],(data[<span class="dv">3</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="301">
<pre><code>(tensor([0., 0., 0., 0., 1., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]),
 tensor(6.9651))</code></pre>
</div>
</div>
<div id="c73c819d-b34c-49fb-a8e0-3d1125328705" class="cell" data-execution_count="117">
<div class="sourceCode cell-code" id="cb481"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb481-1"><a href="#cb481-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb481-2"><a href="#cb481-2" aria-hidden="true" tabindex="-1"></a>    _x <span class="op">=</span> snapshot.x </span>
<span id="cb481-3"><a href="#cb481-3" aria-hidden="true" tabindex="-1"></a>    _edge_index <span class="op">=</span> snapshot.edge_index </span>
<span id="cb481-4"><a href="#cb481-4" aria-hidden="true" tabindex="-1"></a>    _edge_attr <span class="op">=</span> snapshot.edge_attr</span>
<span id="cb481-5"><a href="#cb481-5" aria-hidden="true" tabindex="-1"></a>    _y <span class="op">=</span> snapshot.y</span>
<span id="cb481-6"><a href="#cb481-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span></code></pre></div>
</div>
<div id="34a0ee20-c1ff-47e2-9117-b48070cf57ec" class="cell" data-execution_count="118">
<div class="sourceCode cell-code" id="cb482"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb482-1"><a href="#cb482-1" aria-hidden="true" tabindex="-1"></a>_x.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="118">
<pre><code>torch.Size([1000, 16])</code></pre>
</div>
</div>
<div id="d610edb6-6fd9-4937-b2ae-68a504fc95f9" class="cell" data-execution_count="119">
<div class="sourceCode cell-code" id="cb484"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb484-1"><a href="#cb484-1" aria-hidden="true" tabindex="-1"></a>_edge_index.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="119">
<pre><code>torch.Size([2, 89])</code></pre>
</div>
</div>
<div id="31b82e27-1a6a-4f6a-be1a-e3ccdf6032ce" class="cell" data-execution_count="120">
<div class="sourceCode cell-code" id="cb486"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb486-1"><a href="#cb486-1" aria-hidden="true" tabindex="-1"></a>_edge_attr.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="120">
<pre><code>torch.Size([89])</code></pre>
</div>
</div>
<div id="ede40048-8e5e-414c-9f81-24f7303dbf0e" class="cell" data-execution_count="121">
<div class="sourceCode cell-code" id="cb488"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb488-1"><a href="#cb488-1" aria-hidden="true" tabindex="-1"></a>_y.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="121">
<pre><code>torch.Size([1000])</code></pre>
</div>
</div>
<div id="3708f8f4-0216-4965-ad3c-fa15a458f1ef" class="cell" data-execution_count="122">
<div class="sourceCode cell-code" id="cb490"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb490-1"><a href="#cb490-1" aria-hidden="true" tabindex="-1"></a>_x.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="122">
<pre><code>torch.Size([1000, 16])</code></pre>
</div>
</div>
<p>x</p>
<ul>
<li></li>
</ul>
<p>y</p>
<ul>
<li></li>
</ul>
<div id="eea847a2-467c-491c-a573-634aa38b11a7" class="cell" data-execution_count="123">
<div class="sourceCode cell-code" id="cb492"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb492-1"><a href="#cb492-1" aria-hidden="true" tabindex="-1"></a>_x[<span class="dv">0</span>:<span class="dv">3</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="123">
<pre><code>tensor([[0., 0., 0., 0., 1., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 1., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 1., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]])</code></pre>
</div>
</div>
<div id="fec0a0c2-3859-4c95-a20d-db29fa327775" class="cell" data-execution_count="125">
<div class="sourceCode cell-code" id="cb494"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb494-1"><a href="#cb494-1" aria-hidden="true" tabindex="-1"></a>_y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="125">
<pre><code>tensor(4.8363)</code></pre>
</div>
</div>
</section>
<section id="mtmdatasetloader" class="level2">
<h2 class="anchored" data-anchor-id="mtmdatasetloader">MTMDatasetLoader</h2>
<p>MTM-1 Hand Motions</p>
<ul>
<li>A temporal dataset of MethodsTime Measurement-1 [36] motions, signalled as consecutive graph frames of 21 3D hand key points that were acquired via MediaPipe Hands [64] from original RGB-Video material. Node features encode the normalized xyz-coordinates of each finger joint and the vertices are connected according to the human hand structure.</li>
</ul>
<p>Îç∞Ïù¥ÌÑ∞Ï†ïÎ¶¨</p>
<ul>
<li>T = 14452</li>
<li>V = ÏÜêÏùò shapeÏóê ÎåÄÏùëÌïòÎäî dot<br>
</li>
<li>N = 325 # number of nodes</li>
<li>E = 19 = N^2 # edges</li>
<li><span class="math inline">\(f(v,t)\)</span>Ïùò Ï∞®Ïõê? (Grasp, Release, Move, Reach, Poision, -1)</li>
<li>ÏãúÍ∞ÑÏóê Îî∞ÎùºÏÑú NÏù¥ Î≥ÄÌïòÎäîÏßÄ? ??</li>
<li>ÏãúÍ∞ÑÏóê Îî∞ÎùºÏÑú EÍ∞Ä Î≥ÄÌïòÎäîÏßÄ? ??</li>
<li>X: ?</li>
<li>y: ?</li>
<li>ÏòàÏ†úÏΩîÎìúÏ†ÅÏö©Í∞ÄÎä•Ïó¨Î∂Ä: No</li>
</ul>
<p><code>-</code> Nodes : <code>325</code></p>
<ul>
<li>vertices are are the finger joints of the human hand</li>
</ul>
<p><code>-</code>Edges : <code>19</code></p>
<ul>
<li>edges are the bones connecting them</li>
</ul>
<p><code>-</code> Time : <code>14452</code></p>
<div id="cc6bed7a-1c09-48ec-86af-03634c60f8e1" class="cell" data-execution_count="1607">
<div class="sourceCode cell-code" id="cb496"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb496-1"><a href="#cb496-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.dataset <span class="im">import</span> MTMDatasetLoader</span>
<span id="cb496-2"><a href="#cb496-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.signal <span class="im">import</span> temporal_signal_split</span>
<span id="cb496-3"><a href="#cb496-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb496-4"><a href="#cb496-4" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> MTMDatasetLoader()</span>
<span id="cb496-5"><a href="#cb496-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb496-6"><a href="#cb496-6" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> loader.get_dataset()</span>
<span id="cb496-7"><a href="#cb496-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb496-8"><a href="#cb496-8" aria-hidden="true" tabindex="-1"></a>train_dataset, test_dataset <span class="op">=</span> temporal_signal_split(dataset, train_ratio<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="d25db929-6d9a-4fb4-86a8-a045a028ca86" class="cell" data-execution_count="1608">
<div class="sourceCode cell-code" id="cb497"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb497-1"><a href="#cb497-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>[]</span>
<span id="cb497-2"><a href="#cb497-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb497-3"><a href="#cb497-3" aria-hidden="true" tabindex="-1"></a>    data.append([time,snapshot])</span></code></pre></div>
</div>
<div id="0a2011d1-db19-4021-b26d-a4f043856b62" class="cell" data-execution_count="1609">
<div class="sourceCode cell-code" id="cb498"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb498-1"><a href="#cb498-1" aria-hidden="true" tabindex="-1"></a>time</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1609">
<pre><code>14452</code></pre>
</div>
</div>
<div id="d3955c49-9116-49ee-bb40-404f866a8e79" class="cell" data-execution_count="1448">
<div class="sourceCode cell-code" id="cb500"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb500-1"><a href="#cb500-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">0</span>][<span class="dv">1</span>]).x.shape,(data[<span class="dv">0</span>][<span class="dv">1</span>]).edge_index.shape,(data[<span class="dv">0</span>][<span class="dv">1</span>]).edge_attr.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1448">
<pre><code>(torch.Size([3, 21, 16]), torch.Size([2, 19]), torch.Size([19]))</code></pre>
</div>
</div>
<div id="5169a9f6-9627-441b-b2ca-3349cdac41b7" class="cell" data-execution_count="1449">
<div class="sourceCode cell-code" id="cb502"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb502-1"><a href="#cb502-1" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> nx.Graph()</span></code></pre></div>
</div>
<div id="82a1edde-506b-4769-a949-a2603d553414" class="cell" data-execution_count="1450">
<div class="sourceCode cell-code" id="cb503"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb503-1"><a href="#cb503-1" aria-hidden="true" tabindex="-1"></a>node_list <span class="op">=</span> torch.tensor(<span class="bu">range</span>(<span class="dv">21</span>)).tolist()</span></code></pre></div>
</div>
<div id="9cc74ac7-ecfb-4d2c-b0a7-1862479e16d4" class="cell" data-execution_count="1451">
<div class="sourceCode cell-code" id="cb504"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb504-1"><a href="#cb504-1" aria-hidden="true" tabindex="-1"></a>G.add_nodes_from(node_list)</span></code></pre></div>
</div>
<div id="8cce1eca-e439-4b52-a3ba-285fd15229fe" class="cell" data-execution_count="1453">
<div class="sourceCode cell-code" id="cb505"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb505-1"><a href="#cb505-1" aria-hidden="true" tabindex="-1"></a>edge_list<span class="op">=</span>[]</span>
<span id="cb505-2"><a href="#cb505-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">14452</span>):</span>
<span id="cb505-3"><a href="#cb505-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data[<span class="dv">0</span>][<span class="dv">1</span>].edge_index[<span class="dv">0</span>])):</span>
<span id="cb505-4"><a href="#cb505-4" aria-hidden="true" tabindex="-1"></a>        edge_list.append([data[i][<span class="dv">1</span>].edge_index[<span class="dv">0</span>][j].tolist(),data[i][<span class="dv">1</span>].edge_index[<span class="dv">1</span>][j].tolist()])</span></code></pre></div>
</div>
<div id="2b6b71bf-aa55-4ef0-9b44-836dc03a672f" class="cell" data-execution_count="1454">
<div class="sourceCode cell-code" id="cb506"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb506-1"><a href="#cb506-1" aria-hidden="true" tabindex="-1"></a>G.add_edges_from(edge_list)</span></code></pre></div>
</div>
<div id="9c0a8428-22be-4ddc-8462-204bece097fd" class="cell" data-execution_count="1455">
<div class="sourceCode cell-code" id="cb507"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb507-1"><a href="#cb507-1" aria-hidden="true" tabindex="-1"></a>G.number_of_nodes(),G.number_of_edges()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1455">
<pre><code>(21, 19)</code></pre>
</div>
</div>
<div id="55a3efce-b519-4410-830f-e613671e2260" class="cell" data-execution_count="1457">
<div class="sourceCode cell-code" id="cb509"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb509-1"><a href="#cb509-1" aria-hidden="true" tabindex="-1"></a>nx.draw(G,with_labels<span class="op">=</span><span class="va">True</span>,font_weight<span class="op">=</span><span class="st">'bold'</span>,node_color<span class="op">=</span><span class="st">'green'</span>,node_size<span class="op">=</span><span class="dv">350</span>,font_color<span class="op">=</span><span class="st">'white'</span>,width<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2022-12-21-ST-GCN_Dataset_files/figure-html/cell-322-output-1.png" class="img-fluid"></p>
</div>
</div>
<hr>
<p>timeÎ≥Ñ Í∞ôÏùÄ edge Ï†ïÎ≥¥Î•º Í∞ÄÏßÄÍ≥† ÏûàÎÇò ÌôïÏù∏</p>
<div id="68bbc0e4-da60-4fdd-92fd-38f3adfe4360" class="cell" data-execution_count="1611">
<div class="sourceCode cell-code" id="cb510"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb510-1"><a href="#cb510-1" aria-hidden="true" tabindex="-1"></a>np.where(data[<span class="dv">0</span>][<span class="dv">1</span>].edge_index <span class="op">!=</span> data[<span class="dv">12</span>][<span class="dv">1</span>].edge_index)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1611">
<pre><code>(array([], dtype=int64), array([], dtype=int64))</code></pre>
</div>
</div>
<hr>
<div id="c001180b-c42d-4cbe-b8a8-7e4e5e0e394e" class="cell" data-execution_count="303">
<div class="sourceCode cell-code" id="cb512"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb512-1"><a href="#cb512-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch_geometric_temporal.dataset <span class="im">import</span> MTMDatasetLoader</span>
<span id="cb512-2"><a href="#cb512-2" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> MTMDatasetLoader()</span>
<span id="cb512-3"><a href="#cb512-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-4"><a href="#cb512-4" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> loader.get_dataset()</span>
<span id="cb512-5"><a href="#cb512-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-6"><a href="#cb512-6" aria-hidden="true" tabindex="-1"></a>train_dataset, test_dataset <span class="op">=</span> temporal_signal_split(dataset, train_ratio<span class="op">=</span><span class="fl">0.5</span>)</span></code></pre></div>
</div>
<div id="ef20d811-8082-49a4-b4ea-edc485687bbc" class="cell" data-tags="[]" data-execution_count="304">
<div class="sourceCode cell-code" id="cb513"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb513-1"><a href="#cb513-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>[]</span>
<span id="cb513-2"><a href="#cb513-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb513-3"><a href="#cb513-3" aria-hidden="true" tabindex="-1"></a>    data.append([time,snapshot])</span></code></pre></div>
</div>
<div id="3fb6072b-3b3c-4d7a-aad3-5d9eb12201ff" class="cell" data-execution_count="305">
<div class="sourceCode cell-code" id="cb514"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb514-1"><a href="#cb514-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">0</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>], (data[<span class="dv">0</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="305">
<pre><code>(tensor([[0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]]),
 tensor([0., 0., 1., 0., 0., 0.]))</code></pre>
</div>
</div>
<div id="d3ffe995-578d-4f9f-925c-8d06d13d6e96" class="cell" data-execution_count="306">
<div class="sourceCode cell-code" id="cb516"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb516-1"><a href="#cb516-1" aria-hidden="true" tabindex="-1"></a>(data[<span class="dv">1</span>][<span class="dv">1</span>]).x[<span class="dv">0</span>],(data[<span class="dv">1</span>][<span class="dv">1</span>]).y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="306">
<pre><code>(tensor([[0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
         [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]]),
 tensor([0., 0., 1., 0., 0., 0.]))</code></pre>
</div>
</div>
<div id="ab3ad2b8-37ec-4a78-bfa6-9cceaae712b6" class="cell" data-execution_count="129">
<div class="sourceCode cell-code" id="cb518"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb518-1"><a href="#cb518-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> time, snapshot <span class="kw">in</span> <span class="bu">enumerate</span>(train_dataset):</span>
<span id="cb518-2"><a href="#cb518-2" aria-hidden="true" tabindex="-1"></a>    _x <span class="op">=</span> snapshot.x </span>
<span id="cb518-3"><a href="#cb518-3" aria-hidden="true" tabindex="-1"></a>    _edge_index <span class="op">=</span> snapshot.edge_index </span>
<span id="cb518-4"><a href="#cb518-4" aria-hidden="true" tabindex="-1"></a>    _edge_attr <span class="op">=</span> snapshot.edge_attr</span>
<span id="cb518-5"><a href="#cb518-5" aria-hidden="true" tabindex="-1"></a>    _y <span class="op">=</span> snapshot.y</span>
<span id="cb518-6"><a href="#cb518-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span></code></pre></div>
</div>
<div id="b8211903-94a5-4685-bf52-bd06413e65cb" class="cell" data-execution_count="130">
<div class="sourceCode cell-code" id="cb519"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb519-1"><a href="#cb519-1" aria-hidden="true" tabindex="-1"></a>_x.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="130">
<pre><code>torch.Size([3, 21, 16])</code></pre>
</div>
</div>
<div id="daf9ef23-4d80-4caa-9efe-9350448ed7fa" class="cell" data-execution_count="131">
<div class="sourceCode cell-code" id="cb521"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb521-1"><a href="#cb521-1" aria-hidden="true" tabindex="-1"></a>_edge_index.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="131">
<pre><code>torch.Size([2, 19])</code></pre>
</div>
</div>
<div id="ff3fb6a8-2851-4795-aa1c-4b2dbbeb9d7a" class="cell" data-execution_count="132">
<div class="sourceCode cell-code" id="cb523"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb523-1"><a href="#cb523-1" aria-hidden="true" tabindex="-1"></a>_edge_attr.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="132">
<pre><code>torch.Size([19])</code></pre>
</div>
</div>
<div id="3d0dd2d0-b347-4c2a-b34a-6524440982f5" class="cell" data-execution_count="133">
<div class="sourceCode cell-code" id="cb525"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb525-1"><a href="#cb525-1" aria-hidden="true" tabindex="-1"></a>_y.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="133">
<pre><code>torch.Size([16, 6])</code></pre>
</div>
</div>
<div id="1cd3d13e-e114-4371-b29c-cbf82a091cca" class="cell" data-execution_count="134">
<div class="sourceCode cell-code" id="cb527"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb527-1"><a href="#cb527-1" aria-hidden="true" tabindex="-1"></a>_x.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="134">
<pre><code>torch.Size([3, 21, 16])</code></pre>
</div>
</div>
<p>x</p>
<ul>
<li>The data x is returned in shape (3, 21, T),</li>
</ul>
<p>y</p>
<ul>
<li>The targets are manually labeled for each frame, according to one of the five MTM-1 motions (classes ): Grasp, Release, Move, Reach, Position plus a negative class for frames without graph signals (no hand present).</li>
<li>the target is returned one-hot-encoded in shape (T, 6).</li>
</ul>
<div id="984fbe8f-722f-4a5e-8202-5d1d444d32ae" class="cell" data-execution_count="143">
<div class="sourceCode cell-code" id="cb529"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb529-1"><a href="#cb529-1" aria-hidden="true" tabindex="-1"></a>_x[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="143">
<pre><code>tensor([[0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]])</code></pre>
</div>
</div>
<div id="e8963aa9-e08b-49d5-bdbd-9108c74e7e1f" class="cell" data-execution_count="137">
<div class="sourceCode cell-code" id="cb531"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb531-1"><a href="#cb531-1" aria-hidden="true" tabindex="-1"></a>_y[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="137">
<pre><code>tensor([0., 0., 1., 0., 0., 0.])</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        console.log("RESIZE");
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="seoyeonc/blog" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->




</body></html>